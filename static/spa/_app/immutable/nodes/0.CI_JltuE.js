var Ms=Object.defineProperty;var Ar=s=>{throw TypeError(s)};var Fs=(s,e,t)=>e in s?Ms(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var f=(s,e,t)=>Fs(s,typeof e!="symbol"?e+"":e,t),Ls=(s,e,t)=>e.has(s)||Ar("Cannot "+t);var a=(s,e,t)=>(Ls(s,e,"read from private field"),t?t.call(s):e.get(s)),m=(s,e,t)=>e.has(s)?Ar("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t);import{b as Er,e as As,t as $,a as H}from"../chunks/C0QaH9dC.js";import{s as Dt,h as q,I as we,M as Es,a as rr,b as Ps,w as h,a6 as Os,c as Ds,r as Pr,d as Kt,g as ne,Z as Ns,e as Qr,f as Gr,p as Rs,a1 as Xr,R as Bs,ab as Us,am as Or,an as Wt,L as Ie,ao as Hs,ap as $s,aq as js,a0 as zs,ar as qs,as as Vs,at as Ys,au as Qs,X as Jr,C as Q,av as Gs,_ as Xs,Y as Js,aw as Ks,ax as Ws,ay as Zs,az as ei,aA as ti,E as ri,aB as si,aC as ii,i as ir,u as Kr,aD as ai,aE as oi,q as li,aF as pe,N as Dr,O as Nr,P as ni,aG as di,j as ci,aH as hi,aI as ui,aJ as gi,aj as p,aa as y,a9 as te,k as vi,o as fi,l as mi,D as v,G as S,F as u,aK as At,B as pi}from"../chunks/D4KI4Ps9.js";import{a as yi,b as wi,w as ki,l as Wr,d as Ii,s as z,c as Rr,e as Br,r as _i}from"../chunks/CkaAntYN.js";import{i as Y,b as Si}from"../chunks/COqvbv4a.js";import{r as Ur,a as ye}from"../chunks/G9U9jTfR.js";function bi(s,e,t,r){for(var i=[],l=e.length,o=0;o<l;o++)js(e[o].e,i,!0);var d=l>0&&i.length===0&&t!==null;if(d){var c=t.parentNode;zs(c),c.append(t),r.clear(),se(s,e[0].prev,e[l-1].next)}qs(i,()=>{for(var k=0;k<l;k++){var n=e[k];d||(r.delete(n.k),se(s,n.prev,n.next)),Vs(n.e,!d)}})}function Hr(s,e,t,r,i,l=null){var o=s,d={flags:e,items:new Map,first:null};{var c=s;o=q?Dt(we(c)):c.appendChild(Es())}q&&rr();var k=null,n=!1,C=Os(()=>{var b=t();return Bs(b)?b:b==null?[]:Xr(b)});Ps(()=>{var b=h(C),x=b.length;if(n&&x===0)return;n=x===0;let w=!1;if(q){var I=o.data===Ds;I!==(x===0)&&(o=Pr(),Dt(o),Kt(!1),w=!0)}if(q){for(var g=null,_,T=0;T<x;T++){if(ne.nodeType===8&&ne.data===Ns){o=ne,w=!0,Kt(!1);break}var D=b[T],B=r(D,T);_=Zr(ne,d,g,null,D,B,T,i,e,t),d.items.set(B,_),g=_}x>0&&Dt(Pr())}q||xi(b,d,o,i,e,r,t),l!==null&&(x===0?k?Qr(k):k=Gr(()=>l(o)):k!==null&&Rs(k,()=>{k=null})),w&&Kt(!0),h(C)}),q&&(o=ne)}function xi(s,e,t,r,i,l,o){var d=s.length,c=e.items,k=e.first,n=k,C,b=null,x=[],w=[],I,g,_,T;for(T=0;T<d;T+=1){if(I=s[T],g=l(I,T),_=c.get(g),_===void 0){var D=n?n.e.nodes_start:t;b=Zr(D,e,b,b===null?e.first:b.next,I,g,T,r,i,o),c.set(g,b),x=[],w=[],n=b.next;continue}if(Ci(_,I,T),(_.e.f&Wt)!==0&&Qr(_.e),_!==n){if(C!==void 0&&C.has(_)){if(x.length<w.length){var B=w[0],R;b=B.prev;var j=x[0],L=x[x.length-1];for(R=0;R<x.length;R+=1)$r(x[R],B,t);for(R=0;R<w.length;R+=1)C.delete(w[R]);se(e,j.prev,L.next),se(e,b,j),se(e,L,B),n=B,b=L,T-=1,x=[],w=[]}else C.delete(_),$r(_,n,t),se(e,_.prev,_.next),se(e,_,b===null?e.first:b.next),se(e,b,_),b=_;continue}for(x=[],w=[];n!==null&&n.k!==g;)(n.e.f&Wt)===0&&(C??(C=new Set)).add(n),w.push(n),n=n.next;if(n===null)continue;_=n}x.push(_),b=_,n=_.next}if(n!==null||C!==void 0){for(var E=C===void 0?[]:Xr(C);n!==null;)(n.e.f&Wt)===0&&E.push(n),n=n.next;var N=E.length;if(N>0){var V=d===0?t:null;bi(e,E,V,c)}}Ie.first=e.first&&e.first.e,Ie.last=b&&b.e}function Ci(s,e,t,r){$s(s.v,e),s.i=t}function Zr(s,e,t,r,i,l,o,d,c,k){var n=(c&Ys)!==0,C=(c&Qs)===0,b=n?C?Us(i):Or(i):i,x=(c&Hs)===0?o:Or(o),w={i:x,v:b,k:l,a:null,e:null,prev:t,next:r};try{return w.e=Gr(()=>d(s,b,x,k),q),w.e.prev=t&&t.e,w.e.next=r&&r.e,t===null?e.first=w:(t.next=w,t.e.next=w.e),r!==null&&(r.prev=w,r.e.prev=w.e),w}finally{}}function $r(s,e,t){for(var r=s.next?s.next.e.nodes_start:t,i=e?e.e.nodes_start:t,l=s.e.nodes_start;l!==r;){var o=Jr(l);i.before(l),l=o}}function se(s,e,t){e===null?s.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Ti(s,e,t=!1,r=!1,i=!1){var l=s,o="";Q(()=>{var d=Ie;if(o===(o=e()??"")){q&&rr();return}if(d.nodes_start!==null&&(Gs(d.nodes_start,d.nodes_end),d.nodes_start=d.nodes_end=null),o!==""){if(q){ne.data;for(var c=rr(),k=c;c!==null&&(c.nodeType!==8||c.data!=="");)k=c,c=Jr(c);if(c===null)throw Xs(),Js;Er(ne,k),l=Dt(c);return}var n=o+"";t?n=`<svg>${n}</svg>`:r&&(n=`<math>${n}</math>`);var C=As(n);if((t||r)&&(C=we(C)),Er(we(C),C.lastChild),t||r)for(;we(C);)l.before(we(C));else l.before(C)}})}const jr=[...` 	
\r\fÂ \v\uFEFF`];function Mi(s,e,t){var r=s==null?"":""+s;if(e&&(r=r?r+" "+e:e),t){for(var i in t)if(t[i])r=r?r+" "+i:i;else if(r.length)for(var l=i.length,o=0;(o=r.indexOf(i,o))>=0;){var d=o+l;(o===0||jr.includes(r[o-1]))&&(d===r.length||jr.includes(r[d]))?r=(o===0?"":r.substring(0,o))+r.substring(d+1):o=d}}return r===""?null:r}function P(s,e,t,r,i,l){var o=s.__className;if(q||o!==t||o===void 0){var d=Mi(t,r,l);(!q||d!==s.getAttribute("class"))&&(d==null?s.removeAttribute("class"):e?s.className=d:s.setAttribute("class",d)),s.__className=t}else if(l&&i!==l)for(var c in l){var k=!!l[c];(i==null||k!==!!i[c])&&s.classList.toggle(c,k)}return l}const Fi=Symbol("is custom element"),Li=Symbol("is html");function Zt(s){if(q){var e=!1,t=()=>{if(!e){if(e=!0,s.hasAttribute("value")){var r=s.value;K(s,"value",null),s.value=r}if(s.hasAttribute("checked")){var i=s.checked;K(s,"checked",null),s.checked=i}}};s.__on_r=t,Ks(t),yi()}}function Ai(s,e){var t=es(s);t.checked!==(t.checked=e??void 0)&&(s.checked=e)}function Ei(s,e){e?s.hasAttribute("selected")||s.setAttribute("selected",""):s.removeAttribute("selected")}function K(s,e,t,r){var i=es(s);q&&(i[e]=s.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&s.nodeName==="LINK")||i[e]!==(i[e]=t)&&(e==="loading"&&(s[Ws]=t),t==null?s.removeAttribute(e):typeof t!="string"&&Pi(s).includes(e)?s[e]=t:s.setAttribute(e,t))}function es(s){return s.__attributes??(s.__attributes={[Fi]:s.nodeName.includes("-"),[Li]:s.namespaceURI===Zs})}var zr=new Map;function Pi(s){var e=zr.get(s.nodeName);if(e)return e;zr.set(s.nodeName,e=[]);for(var t,r=s,i=Element.prototype;i!==r;){t=ti(r);for(var l in t)t[l].set&&e.push(l);r=ei(r)}return e}const Oi=()=>performance.now(),ee={tick:s=>requestAnimationFrame(s),now:()=>Oi(),tasks:new Set};function ts(){const s=ee.now();ee.tasks.forEach(e=>{e.c(s)||(ee.tasks.delete(e),e.f())}),ee.tasks.size!==0&&ee.tick(ts)}function Di(s){let e;return ee.tasks.size===0&&ee.tick(ts),{promise:new Promise(t=>{ee.tasks.add(e={c:s,f:t})}),abort(){ee.tasks.delete(e)}}}function Et(s,e){ki(()=>{s.dispatchEvent(new CustomEvent(e))})}function Ni(s){if(s==="float")return"cssFloat";if(s==="offset")return"cssOffset";if(s.startsWith("--"))return s;const e=s.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function qr(s){const e={},t=s.split(";");for(const r of t){const[i,l]=r.split(":");if(!i||l===void 0)break;const o=Ni(i.trim());e[o]=l.trim()}return e}const Ri=s=>s;function Pt(s,e,t,r){var i=(s&ai)!==0,l="both",o,d=e.inert,c=e.style.overflow,k,n;function C(){var g=ni,_=Ie;Dr(null),Nr(null);try{return o??(o=t()(e,(r==null?void 0:r())??{},{direction:l}))}finally{Dr(g),Nr(_)}}var b={is_global:i,in(){e.inert=d,Et(e,"introstart"),k=sr(e,C(),n,1,()=>{Et(e,"introend"),k==null||k.abort(),k=o=void 0,e.style.overflow=c})},out(g){e.inert=!0,Et(e,"outrostart"),n=sr(e,C(),k,0,()=>{Et(e,"outroend"),g==null||g()})},stop:()=>{k==null||k.abort(),n==null||n.abort()}},x=Ie;if((x.transitions??(x.transitions=[])).push(b),wi){var w=i;if(!w){for(var I=x.parent;I&&(I.f&ri)!==0;)for(;(I=I.parent)&&(I.f&si)===0;);w=!I||(I.f&ii)!==0}w&&ir(()=>{Kr(()=>b.in())})}}function sr(s,e,t,r,i){var l=r===1;if(oi(e)){var o,d=!1;return li(()=>{if(!d){var g=e({direction:l?"in":"out"});o=sr(s,g,t,r,i)}}),{abort:()=>{d=!0,o==null||o.abort()},deactivate:()=>o.deactivate(),reset:()=>o.reset(),t:()=>o.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return i(),{abort:pe,deactivate:pe,reset:pe,t:()=>r};const{delay:c=0,css:k,tick:n,easing:C=Ri}=e;var b=[];if(l&&t===void 0&&(n&&n(0,1),k)){var x=qr(k(0,1));b.push(x,x)}var w=()=>1-r,I=s.animate(b,{duration:c});return I.onfinish=()=>{var g=(t==null?void 0:t.t())??1-r;t==null||t.abort();var _=r-g,T=e.duration*Math.abs(_),D=[];if(T>0){var B=!1;if(k)for(var R=Math.ceil(T/16.666666666666668),j=0;j<=R;j+=1){var L=g+_*C(j/R),E=qr(k(L,1-L));D.push(E),B||(B=E.overflow==="hidden")}B&&(s.style.overflow="hidden"),w=()=>{var N=I.currentTime;return g+_*C(N/T)},n&&Di(()=>{if(I.playState!=="running")return!1;var N=w();return n(N,1-N),!0})}I=s.animate(D,{duration:T,fill:"forwards"}),I.onfinish=()=>{w=()=>r,n==null||n(r,1-r),i()}},{abort:()=>{I&&(I.cancel(),I.effect=null,I.onfinish=pe)},deactivate:()=>{i=pe},reset:()=>{r===0&&(n==null||n(1,0))},t:()=>w()}}function Vr(s,e,t=e){var r=di();Wr(s,"input",i=>{var l=i?s.defaultValue:s.value;if(l=er(s)?tr(l):l,t(l),r&&l!==(l=e())){var o=s.selectionStart,d=s.selectionEnd;s.value=l??"",d!==null&&(s.selectionStart=o,s.selectionEnd=Math.min(d,s.value.length))}}),(q&&s.defaultValue!==s.value||Kr(e)==null&&s.value)&&t(er(s)?tr(s.value):s.value),ci(()=>{var i=e();er(s)&&i===tr(s.value)||s.type==="date"&&!i&&!s.value||i!==s.value&&(s.value=i??"")})}function er(s){var e=s.type;return e==="number"||e==="range"}function tr(s){return s===""?null:+s}function rs(s,e,t){if(s.multiple)return Ui(s,e);for(var r of s.options){var i=ke(r);if(hi(i,e)){r.selected=!0;return}}(!t||e!==void 0)&&(s.selectedIndex=-1)}function Bi(s,e){ir(()=>{var t=new MutationObserver(()=>{var r=s.__value;rs(s,r)});return t.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function Yr(s,e,t=e){var r=!0;Wr(s,"change",i=>{var l=i?"[selected]":":checked",o;if(s.multiple)o=[].map.call(s.querySelectorAll(l),ke);else{var d=s.querySelector(l)??s.querySelector("option:not([disabled])");o=d&&ke(d)}t(o)}),ir(()=>{var i=e();if(rs(s,i,r),r&&i===void 0){var l=s.querySelector(":checked");l!==null&&(i=ke(l),t(i))}s.__value=i,r=!1}),Bi(s)}function Ui(s,e){for(var t of s.options)t.selected=~e.indexOf(ke(t))}function ke(s){return"__value"in s?s.__value:s.value}const Hi=s=>s;function Ot(s,{delay:e=0,duration:t=400,easing:r=Hi}={}){const i=+getComputedStyle(s).opacity;return{delay:e,duration:t,easing:r,css:l=>`opacity: ${l*i}`}}const re="favorites",le="liked",O="bijukaru_all_sources";var _e,Se,be,xe,Ce,Te,Me,Fe,Le,Ae,Ee,Pe,Oe,De,Ne,Re,Be,Ue,He,$e,je,ze,qe,Ve,Ye,Qe,Ge,Xe,Je,Ke,We,Ze,et,tt,rt,st,it,at,ot,lt,nt,dt,ct,ht,ut,gt,vt,ft,mt,pt,yt,wt,kt,It,_t,St,bt;class $i{constructor(){m(this,_e,p(!0));m(this,Se,p(null));m(this,be,p(te([])));m(this,xe,p(0));m(this,Ce,p(null));m(this,Te,p(1e4));m(this,Me,p(1e4));m(this,Fe,p(!1));m(this,Le,p(!1));m(this,Ae,p("next"));m(this,Ee,p(!0));m(this,Pe,p(""));m(this,Oe,p(!1));m(this,De,p(!1));m(this,Ne,p(null));m(this,Re,p(null));m(this,Be,p(te([])));m(this,Ue,p(0));m(this,He,p(null));m(this,$e,p(te(new Set)));m(this,je,p(2));m(this,ze,p(te([])));m(this,qe,p("apod"));m(this,Ve,p(!1));m(this,Ye,p(!1));m(this,Qe,p(null));m(this,Ge,p(null));m(this,Xe,p(300));m(this,Je,p(!1));m(this,Ke,p(!1));m(this,We,p(!1));m(this,Ze,p(""));m(this,et,p(null));m(this,tt,p(null));m(this,rt,p(0));m(this,st,p(0));m(this,it,p(te(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))));m(this,at,p(""));m(this,ot,p(!1));m(this,lt,p(""));m(this,nt,p(!1));m(this,dt,p(null));m(this,ct,p(""));m(this,ht,p(!1));m(this,ut,p(null));m(this,gt,p(null));m(this,vt,p(null));m(this,ft,p(null));m(this,mt,p(null));m(this,pt,p(void 0));m(this,yt,p(te(new Map)));m(this,wt,p(!1));m(this,kt,p(te([])));m(this,It,p(!1));m(this,_t,p(null));m(this,St,p(null));m(this,bt,p(te([])));f(this,"init",async()=>{this.applyTheme(),this.loadFavorites(),this.loadArchivedCuratedFeeds(),this.mouseX=0,this.mouseY=0,document.addEventListener("mousemove",g=>{this.mouseX=g.clientX,this.mouseY=g.clientY,document.querySelectorAll(".nav-button").forEach(T=>{T.classList.add("visible")}),this.resetInactivityTimer()});const e=new URLSearchParams(window.location.search),t=localStorage.getItem("bijukaru_message");t&&(this.showUrlMessage(t),localStorage.removeItem("bijukaru_message"));const r=e.get("message");if(r){this.showUrlMessage(decodeURIComponent(r)),e.delete("message");const g=window.location.pathname+(e.toString()?"?"+e.toString():"");Ur(g.toString(),{})}await this.loadMediaSources();const i=e.get("media_source");i&&(this.selectedMediaSource=i),await this.loadCategories(),e.get("favorites")==="true"&&(this.showFavorites=!0);const o=e.get("category");if(o)this.selectedCategory=o,this.categoryIndex=Math.max(0,this.categories.findIndex(g=>g.id===o));else if(this.categories.length>0&&this.categories[0].id){this.selectedCategory=this.categories[0].id,this.categoryIndex=0;const g=new URL(window.location.href);g.searchParams.set("category",this.selectedCategory),Ur(g.toString(),{})}this.targetImageId=e.get("image_id");const d=e.get("interval");if(d&&!isNaN(Number(d))){const g=parseInt(d);this.slideInterval=g>0?g*1e3:0,this.originalInterval=this.slideInterval}const c=e.get("paused");(c==="true"||c==="1")&&(this.isPaused=!0,this.originalInterval=this.slideInterval,this.slideInterval=0);const k=e.get("hd");(k==="true"||k==="1")&&(this.isHD=!0);const n=e.get("prefetch");n&&!isNaN(Number(n))&&(this.nToPrefetch=Math.min(10,Math.max(0,parseInt(n))));const C=e.get("fullscreen");(C==="true"||C==="1")&&(this.hideToolbar=!0);const b=e.get("showDescription");(b==="true"||b==="1")&&(this.showDescription=!0),document.addEventListener("keydown",g=>{if(this.showSearchOverlay){g.key==="Escape"&&this.closeSearchOverlay();return}this.handleKeyDown(g)});const x=document.querySelector(".gallery-image");x&&(x.addEventListener("touchstart",()=>{this.mediaSourceOverlayTimeoutId&&clearTimeout(this.mediaSourceOverlayTimeoutId),this.mediaSourceOverlayTransitionId&&clearTimeout(this.mediaSourceOverlayTransitionId),this.showMediaSourceOverlay=!1,this.showControls(),this.resetInactivityTimer()}),x.addEventListener("click",()=>{this.resetInactivityTimer()}),x.addEventListener("mouseenter",()=>{this.showControls()}),x.addEventListener("mouseleave",g=>{const T=g.relatedTarget;T&&(T.classList.contains("category-nav-button")||T.closest(".category-nav-button"))||setTimeout(this.hideControls,1e3)}),x.addEventListener("touchstart",()=>{this.isPaused||(this.wasPlayingBeforeTouch=!0,this.togglePause())}),x.addEventListener("touchend",()=>{this.wasPlayingBeforeTouch&&(this.wasPlayingBeforeTouch=!1,this.togglePause())})),document.querySelectorAll(".category-nav-button").forEach(g=>{g.addEventListener("mouseenter",()=>{this.showControls()}),g.addEventListener("mouseleave",_=>{const D=_.relatedTarget;D&&(D.classList.contains("category-nav-button")||D.classList.contains("nav-button")||D.closest(".nav-button")||D.closest(".category-nav-button"))||setTimeout(this.hideControls,1e3)})}),await this.loadCategory();const w=e.get("token");if(w)this.verifyAndStoreToken(w);else{const g=localStorage.getItem("searchToken");g&&(this.searchToken=g,this.verifyToken(!1))}this.loadLikedImages(),this.loadArchivedCuratedFeeds(),e.get("liked")==="true"&&(this.showLikedImages=!0)});f(this,"handleImageError",e=>{e.target.src="https://placehold.co/600x400?text=Image+Not+Available"});f(this,"updateDocumentTitle",()=>{let e="Bijukaru picture carousel";const t=this.mediaSources.find(r=>r.id===this.selectedMediaSource);t&&(e=`${t.name} - ${e}`),this.showFavorites?e=`â­ Favorites - ${e}`:this.showLikedImages?e=`â¤ï¸ Liked Images - ${e}`:this.currentItem&&(e=`${this.currentItem.title} - ${e}`),document.title=e});f(this,"updateURL",()=>{var e,t;try{const r=new URL(window.location.href);r.searchParams.set("media_source",this.selectedMediaSource),!this.showFavorites&&this.selectedCategory?r.searchParams.set("category",this.selectedCategory):r.searchParams.delete("category"),(e=this.currentItem)!=null&&e.id?r.searchParams.set("image_id",this.currentItem.id):r.searchParams.delete("image_id"),this.slideInterval!==1e4?r.searchParams.set("interval",String(this.slideInterval/1e3)):r.searchParams.delete("interval"),this.isHD?r.searchParams.set("hd","true"):r.searchParams.delete("hd"),this.hideToolbar?r.searchParams.set("fullscreen","true"):r.searchParams.delete("fullscreen"),this.showDescription?r.searchParams.set("showDescription","true"):r.searchParams.delete("showDescription"),this.showFavorites?r.searchParams.set("favorites","true"):r.searchParams.delete("favorites"),this.showLikedImages?r.searchParams.set("liked","true"):r.searchParams.delete("liked"),ye(r.toString(),{mediaSource:this.selectedMediaSource,category:this.selectedCategory,imageId:(t=this.currentItem)==null?void 0:t.id})}catch(r){console.error("Error updating URL:",r)}});f(this,"getPrevCategoryName",()=>{var t;if(this.categories.length===0)return"";const e=(this.categoryIndex-1+this.categories.length)%this.categories.length;return((t=this.categories[e])==null?void 0:t.name)||""});f(this,"getNextCategoryName",()=>{var t;if(this.categories.length===0)return"";const e=(this.categoryIndex+1)%this.categories.length;return((t=this.categories[e])==null?void 0:t.name)||""});f(this,"getCurrentCategoryName",()=>{var t;if(this.showFavorites&&((t=this.currentItem)!=null&&t.sourceCategory))return this.currentItem.sourceCategory;if(this.category)return this.category.name;if(!this.selectedCategory||this.categories.length===0)return"";const e=this.categories.find(r=>r.id===this.selectedCategory);return e?e.name:""});f(this,"nextItem",()=>{this.direction="next",this.currentIndex=(this.currentIndex+1)%this.items.length,document.querySelectorAll(".category-nav-button").forEach(t=>{t.classList.remove("visible")}),this.showMediaSourceOverlay=!1,this.updateDocumentTitle(),this.updateURL(),this.prefetchNextImages(),this.stopAutoSlide(),this.startAutoSlide()});f(this,"prevItem",()=>{this.stopAutoSlide(),this.direction="prev",this.currentIndex=(this.currentIndex-1+this.items.length)%this.items.length,document.querySelectorAll(".category-nav-button").forEach(t=>{t.classList.remove("visible")}),this.showMediaSourceOverlay=!1,this.updateDocumentTitle(),this.updateURL(),this.prefetchNextImages(),this.startAutoSlide()});f(this,"startAutoSlide",()=>{if(this.autoSlideIntervalId&&(clearInterval(this.autoSlideIntervalId),this.autoSlideIntervalId=null),this.isPaused||this.slideInterval===0){this.progressBar&&(this.progressBar.style.width="0%",this.progressAnimation&&(cancelAnimationFrame(this.progressAnimation),this.progressAnimation=null));return}this.autoSlideIntervalId=setInterval(()=>{this.nextItem()},this.slideInterval),this.animateProgressBar()});f(this,"stopAutoSlide",()=>{this.autoSlideIntervalId&&(clearInterval(this.autoSlideIntervalId),this.autoSlideIntervalId=null),this.progressBar&&(this.progressBar.style.width="0%",this.progressAnimation&&(cancelAnimationFrame(this.progressAnimation),this.progressAnimation=null))});f(this,"animateProgressBar",()=>{if(this.progressBar){if(this.progressBar.style.width="0%",this.slideInterval===0)return;this.progressAnimation&&(cancelAnimationFrame(this.progressAnimation),this.progressAnimation=null);const e=performance.now(),t=this.slideInterval,r=i=>{const l=i-e,o=Math.min(l/t*100,100);this.progressBar&&(this.progressBar.style.width=`${o}%`),l<t&&(this.progressAnimation=requestAnimationFrame(r))};this.progressAnimation=requestAnimationFrame(r)}});f(this,"togglePause",()=>{this.isPaused=!this.isPaused,this.isPaused?(this.slideInterval>0&&(this.originalInterval=this.slideInterval),this.stopAutoSlide(),this.slideInterval=0):(this.slideInterval=this.originalInterval>0?this.originalInterval:1e4,this.startAutoSlide()),this.updateURL()});f(this,"toggleFullscreen",()=>{document.fullscreenElement?this.exitFullscreen():document.documentElement.requestFullscreen().then(()=>{this.isFullscreen=!0,this.hideToolbar=!0}).catch(e=>{console.error("Failed to enter fullscreen mode:",e),this.hideToolbar=!0}),this.updateURL()});f(this,"exitFullscreen",()=>{if(document.fullscreenElement&&document.exitFullscreen)try{document.exitFullscreen().then(()=>{this.isFullscreen=!1}).catch(e=>{console.error("Failed to exit fullscreen mode:",e),this.isFullscreen=!1})}catch(e){console.error("Error exiting fullscreen:",e),this.isFullscreen=!1}this.hideToolbar=!1,this.updateURL()});f(this,"prefetchNextImages",()=>{this.prefetchDebounceTimerId&&clearTimeout(this.prefetchDebounceTimerId),this.prefetchDebounceTimerId=setTimeout(()=>{if(this.items.length)for(let e=1;e<=this.nToPrefetch;e++){const t=(this.currentIndex+e)%this.items.length,r=this.items[t];if(r&&r.image_url&&!this.prefetchedImages.has(r.image_url)){const i=new Image;i.src=r.image_url,this.prefetchedImages.add(r.image_url),console.log("Prefetched image:",r.image_url)}}},this.prefetchDebounceDelay)});f(this,"toggleDarkMode",()=>{this.darkMode=!this.darkMode,this.applyTheme(!1),localStorage.setItem("darkMode",String(this.darkMode))});f(this,"applyTheme",(e=!0)=>{if(e){const t=localStorage.getItem("darkMode");t!==null&&(this.darkMode=t==="true")}this.darkMode?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")});f(this,"showControls",()=>{const e=document.querySelector(".exit-fullscreen-btn"),t=document.querySelectorAll(".nav-button");console.log("showControls called, found buttons:",t.length),this.isFullscreen&&e&&e.classList.add("visible"),t.forEach(r=>{r.classList.add("visible")}),this.resetInactivityTimer()});f(this,"hideControls",()=>{const e=document.querySelector(".exit-fullscreen-btn"),t=document.querySelectorAll(".nav-button");Array.from(t).some(i=>{const l=i.getBoundingClientRect(),o=this.mouseX,d=this.mouseY;return o>=l.left&&o<=l.right&&d>=l.top&&d<=l.bottom})||(e&&e.classList.remove("visible"),t.forEach(i=>{i.classList.remove("visible")}))});f(this,"resetInactivityTimer",()=>{this.inactivityTimeoutId&&clearTimeout(this.inactivityTimeoutId),this.inactivityTimeoutId=setTimeout(()=>{this.hideControls()},1e3)});f(this,"loadCategories",async()=>{this.error=null,this.loading=!0;try{if(this.selectedMediaSource===O){const e=[{id:re,name:"Favorites"},{id:le,name:"Liked Images"},...this.archivedCuratedFeeds.map(t=>({id:t.id,name:t.name}))];this.categories=e,!this.showFavorites&&!this.showLikedImages&&(!this.selectedCategory||!e.find(t=>t.id===this.selectedCategory))?this.selectedCategory=re:this.showFavorites?this.selectedCategory=re:this.showLikedImages&&(this.selectedCategory=le),this.categoryIndex=Math.max(0,this.categories.findIndex(t=>t.id===this.selectedCategory)),this.category=this.categories[this.categoryIndex]}else{const e=await fetch(`/api/${this.selectedMediaSource}/categories`);if(!e.ok)throw new Error("Failed to fetch categories");this.categories=await e.json(),this.categories.length>0&&(!this.selectedCategory||!this.categories.find(t=>t.id===this.selectedCategory))&&(this.selectedCategory=this.categories[0].id,this.categoryIndex=0,this.category=this.categories[0])}}catch(e){console.error("Error loading categories:",e),this.error=e.message||"Error loading categories",this.categories=[{id:"",name:"Error"}]}finally{this.loading=!1}});f(this,"loadCategory",async()=>{var e;if(this.error=null,this.selectedMediaSource===O){if(this.selectedCategory===re)return this.showFavorites=!0,this.showLikedImages=!1,this.loadAllFavorites();if(this.selectedCategory===le)return this.showLikedImages=!0,this.showFavorites=!1,this.loadLikedImagesView();if(this.items.length===0&&((e=this.category)==null?void 0:e.id)===this.selectedCategory){const t=this.archivedCuratedFeeds.find(r=>r.id===this.selectedCategory);if(t)return console.log(`Reloading curated feed: ${t.name}`),this._loadSpecificCuratedFeed(t);console.warn(`Selected category ${this.selectedCategory} looks like a curated feed ID, but not found in archive.`),this.error=`Cannot load curated feed: ${this.selectedCategory}`,this.loading=!1;return}else if(this.selectedMediaSource===O&&![re,le].includes(this.selectedCategory)){const t=this.archivedCuratedFeeds.find(r=>r.id===this.selectedCategory);if(t){console.log(`Loading archived curated feed: ${t.name}`),this._loadSpecificCuratedFeed(t);return}else{console.warn(`Selected category ${this.selectedCategory} not found in archived feeds.`),this.error=`Could not load archived feed: ${this.selectedCategory}`,this.items=[],this.loading=!1;return}}}this.loading=!0,this.stopAutoSlide(),this.prefetchedImages.clear(),this.progressBar&&(this.progressBar.style.width="0%"),this.selectedCategory||(this.selectedCategory=this.categories[0].id);try{let t=`/api/${this.selectedMediaSource}/feed`;this.selectedCategory&&(t+=`?category=${this.selectedCategory}`),this.isHD&&(t+=(t.includes("?")?"&":"?")+"hd=true");const r=await fetch(t);if(!r.ok)throw new Error("Failed to fetch RSS feed");const i=await r.json();if(this.items=i.items,this.category=i.category,["apod","reddit"].includes(this.selectedMediaSource)||this.shuffleArray(this.items),this.currentIndex=0,this.targetImageId&&this.items.length>0){const l=this.items.findIndex(o=>o.id===this.targetImageId);l!==-1&&(this.currentIndex=l),this.targetImageId=null}this.items.length===0?this.error="No images found in the feed":(this.showTemporaryMediaSourceOverlay(),this.updateDocumentTitle(),this.updateURL(),this.prefetchNextImages(),this.startAutoSlide())}catch(t){console.error("Error:",t),this.error="Failed to load gallery. Please try again later."}finally{this.loading=!1}});f(this,"showTemporaryMediaSourceOverlay",()=>{var e;this.isMobile||(this.mediaSourceOverlayTimeoutId&&clearTimeout(this.mediaSourceOverlayTimeoutId),this.mediaSourceOverlayTransitionId&&clearTimeout(this.mediaSourceOverlayTransitionId),(e=this.mediaSources.find(t=>t.id===this.selectedMediaSource))==null||e.name,this.getCurrentCategoryName(),this.mediaSourceOverlayText=`

                    `,this.showMediaSourceOverlay=!0,this.mediaSourceOverlayTimeoutId=setTimeout(()=>{this.mediaSourceOverlayTransitionId=setTimeout(()=>{this.showMediaSourceOverlay=!1},300)},2e3))});f(this,"shuffleArray",e=>{for(let t=e.length-1;t>0;t--){const r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e});f(this,"handleKeyDown",e=>{if(this.showSearchOverlay||document.activeElement&&["input","textarea","select"].includes(document.activeElement.tagName.toLowerCase())){e.key==="Escape"&&this.showSearchOverlay&&this.closeSearchOverlay();return}if(this.showHelp&&e.key==="Escape"){this.showHelp=!1;return}switch(e.key){case"ArrowRight":this.nextItem();break;case"ArrowLeft":this.prevItem();break;case"Enter":this.currentItem&&this.currentItem.link&&window.open(this.currentItem.link,"_blank");break;case"ArrowUp":this.prevCategory();break;case"ArrowDown":this.nextCategory();break;case"PageUp":this.prevMediaSource();break;case"PageDown":this.nextMediaSource();break;case"h":case"H":this.showHelp=!this.showHelp;break;case"p":case"P":this.togglePause();break;case"f":case"F":this.toggleFullscreen();break;case"d":case"D":this.showDescription=!this.showDescription;break;case"Escape":this.exitFullscreen();break;case"/":this.isSearchAuthorized&&(this.openSearchOverlay(),e.preventDefault());break;case"s":case"S":this.toggleFavorite();break;case"v":case"V":this.toggleShowFavorites();break;case"l":case"L":this.toggleLikeImage();break;case"i":case"I":this.toggleShowLikedImages();break}});f(this,"prevCategory",()=>{this.categories.length!==0&&(this.categoryIndex=(this.categoryIndex-1+this.categories.length)%this.categories.length,this.selectedCategory=this.categories[this.categoryIndex].id,this.loadCategory())});f(this,"nextCategory",()=>{this.categories.length!==0&&(this.categoryIndex=(this.categoryIndex+1)%this.categories.length,this.selectedCategory=this.categories[this.categoryIndex].id,this.loadCategory())});f(this,"showUrlMessage",e=>{this.overlayMessage=e,this.showMessageOverlay=!0,setTimeout(()=>{this.showMessageOverlay=!1},5e3)});f(this,"loadMediaSources",async()=>{var e,t,r;this.loading=!0,this.error=null;try{const i=await fetch("/api/media_sources");if(!i.ok)throw new Error(`Failed to load media sources: ${i.statusText}`);const l=await i.json();this.mediaSources=[...l,{id:O,name:"All Sources",hdSupported:!0}];const d=new URLSearchParams(window.location.search).get("media_source");if(d&&this.mediaSources.find(c=>c.id===d))this.selectedMediaSource=d;else if(this.mediaSources.length>0&&!this.mediaSources.find(c=>c.id===this.selectedMediaSource)){const c=this.mediaSources.find(k=>k.id!==O);this.selectedMediaSource=c?c.id:((e=this.mediaSources[0])==null?void 0:e.id)||""}else if(this.mediaSources.length>0&&this.selectedMediaSource===O&&!d){const c=this.mediaSources.find(k=>k.id!==O);this.selectedMediaSource=c?c.id:((t=this.mediaSources[0])==null?void 0:t.id)||""}this.hdSupported=((r=this.mediaSources.find(c=>c.id===this.selectedMediaSource))==null?void 0:r.hdSupported)||!1}catch(i){this.error=i.message,this.mediaSources=[{id:O,name:"All Sources",hdSupported:!0}]}finally{this.loading=!1}});f(this,"verifyAndStoreToken",async e=>{if(this.searchToken=e,await this.verifyToken(!0),this.isSearchAuthorized){localStorage.setItem("searchToken",e);const t=new URL(window.location.href);t.searchParams.delete("token"),window.history.replaceState({},"",t),this.overlayMessage="Search feature unlocked!",this.showMessageOverlay=!0,setTimeout(()=>{this.showMessageOverlay=!1},3e3)}});f(this,"verifyToken",async(e=!0)=>{if(!this.searchToken)return e&&(this.tokenError="Token is required"),!1;try{const t=await fetch(`/api/verify_token?token=${encodeURIComponent(this.searchToken)}`),r=await t.json();return t.ok&&r.authorized?(this.isSearchAuthorized=!0,this.tokenError=null,!0):(this.isSearchAuthorized=!1,e&&(this.tokenError=r.error||"Invalid token"),!1)}catch(t){return console.error("Token verification error:",t),this.isSearchAuthorized=!1,e&&(this.tokenError="Failed to verify token"),!1}});f(this,"openSearchOverlay",()=>{this.showSearchOverlay=!0,this.error=null,this.tokenError=null,setTimeout(()=>{const e=document.getElementById("search-input"),t=document.getElementById("token-input");this.isSearchAuthorized&&e?e.focus():t&&t.focus()},0)});f(this,"closeSearchOverlay",()=>{this.showSearchOverlay=!1,this.searchQuery="",this.error=null,this.tokenError=null});f(this,"nextMediaSource",()=>{if(this.mediaSources.length<=1)return;const t=(this.mediaSources.findIndex(r=>r.id===this.selectedMediaSource)+1)%this.mediaSources.length;this.selectedMediaSource=this.mediaSources[t].id,this.changeMediaSource()});f(this,"prevMediaSource",()=>{if(this.mediaSources.length<=1)return;const t=(this.mediaSources.findIndex(r=>r.id===this.selectedMediaSource)-1+this.mediaSources.length)%this.mediaSources.length;this.selectedMediaSource=this.mediaSources[t].id,this.changeMediaSource()});f(this,"performSearch",async()=>{if(!(!this.isSearchAuthorized&&!await this.verifyToken())&&this.searchQuery.trim()){this.loading=!0,this.error=null;try{const t=["story","narrative","curate","tell me about","life of","teach me about"].some(d=>this.searchQuery.toLowerCase().includes(d)),r=localStorage.getItem("searchToken")||this.searchToken;let i;t?(console.log("Performing curation query..."),i=`/api/curate?query=${encodeURIComponent(this.searchQuery)}&token=${encodeURIComponent(r)}`):(console.log("Performing standard search query..."),i=`/api/search?query=${encodeURIComponent(this.searchQuery)}&token=${encodeURIComponent(r)}`);const l=await fetch(i),o=await l.json();if(!l.ok)throw new Error(o.error||`HTTP error ${l.status}`);if(this.closeSearchOverlay(),t)if(console.log("Received curated feed:",o),o.items&&o.category){this.selectedMediaSource!==O&&(this.previousSelectedMediaSource=this.selectedMediaSource,this.previousSelectedCategory=this.selectedCategory),this.selectedMediaSource=O,this.items=o.items;const d=this.searchQuery,c={id:o.category.id,name:o.category.name};this.category=c,this.categories=[c],this.categoryIndex=0;const k=this.archivedCuratedFeeds.findIndex(C=>C.id===c.id),n={id:c.id,name:c.name,originalQuery:d,items:o.items,userfriendly_message:o.userfriendly_message};k>-1?this.archivedCuratedFeeds[k]=n:this.archivedCuratedFeeds.push(n),this.archivedCuratedFeeds=[...this.archivedCuratedFeeds],this.saveArchivedCuratedFeeds(),this.selectedCategory=c.id,this.showFavorites=!1,this.showLikedImages=!1,this.currentIndex=0,this.items.length===0?this.error="Curated feed is empty.":this.error=null,this.updateProgressBar(),o.userfriendly_message&&this.showUrlMessage(o.userfriendly_message),o.llm_thinking&&console.log("LLM Thinking:",o.llm_thinking),this.updateURL(),this.updateDocumentTitle(),this.prefetchNextImages(),this.startAutoSlide()}else throw new Error("Invalid curated feed response from server.");else if(console.log("Search successful, received URL:",o.url),o.url)o.userfriendly_message&&localStorage.setItem("bijukaru_message",o.userfriendly_message),window.location.href=o.url;else throw new Error("Invalid search response from server.")}catch(e){console.error("Search/Curation error:",e),this.error=e.message||"An error occurred during the search/curation."}finally{this.loading=!1}}});f(this,"changeMediaSource",async e=>{const t=e??this.selectedMediaSource,r=this.selectedMediaSource;if(r===O&&t!==O)if(console.log("Switching FROM custom source TO regular source:",t),this.showFavorites=!1,this.showLikedImages=!1,this.previousSelectedMediaSource&&this.previousSelectedCategory){console.log("Restoring previous state:",this.previousSelectedMediaSource,this.previousSelectedCategory),this.selectedMediaSource=this.previousSelectedMediaSource,this.selectedCategory=this.previousSelectedCategory,this.previousSelectedMediaSource=null,this.previousSelectedCategory=null,await this.loadCategory();return}else console.log("No previous state to restore, proceeding with target:",t),this.selectedMediaSource=t;else if(t===O&&r!==O){console.log("Switching TO custom source FROM regular source:",r),this.previousSelectedMediaSource=r,this.previousSelectedCategory=this.selectedCategory,this.selectedMediaSource=O,this.showFavorites=!1,this.showLikedImages=!1,await this.loadCategories(),await this.loadCategory(),this.updateURL();return}console.log("Proceeding with regular source change or fallthrough:",t),this.selectedMediaSource=t,this.loading=!0,this.error=null;try{const i=new URLSearchParams(window.location.search);i.delete("image_id"),i.delete("category"),i.delete("media_source"),this.selectedCategory="",this.categoryIndex=0,this.targetImageId=null;const l=this.mediaSources.find(c=>c.id===this.selectedMediaSource);this.hdSupported=(l==null?void 0:l.hdSupported)!==void 0?l.hdSupported:!1,this.slideInterval!==1e4&&i.set("interval",String(this.slideInterval/1e3)),this.isHD&&i.set("hd","true"),this.nToPrefetch!==2&&i.set("prefetch",String(this.nToPrefetch)),this.hideToolbar&&i.set("fullscreen","true"),this.showDescription&&i.set("showDescription","true");const o=`/?media_source=${t}&${i.toString()}`;ye(o,{mediaSource:this.selectedMediaSource});const d=this.mediaSources.find(c=>c.id===this.selectedMediaSource);d&&(document.title=`${d.name} - Bijukaru picture carousel`),await this.loadCategories(),await this.loadCategory(),this.updateURL()}catch(i){console.error("Error changing media source:",i),this.error="Failed to change media source. Please try again later."}finally{this.loading=!1}});f(this,"refreshRandomArtist",()=>{this.selectedCategory==="random-artist"&&this.loadCategory()});f(this,"toggleHD",()=>{var t;const e=(t=this.currentItem)==null?void 0:t.id;this.isHD=!this.isHD,this.loadCategory().then(()=>{if(e){const r=this.items.findIndex(i=>i.id===e);r!==-1&&(this.currentIndex=r,this.updateDocumentTitle(),this.updateURL())}}),this.updateURL()});f(this,"loadFavorites",()=>{try{const e=localStorage.getItem("galleryFavorites");if(e){const t=JSON.parse(e),r=new Map;Object.keys(t).forEach(i=>{r.set(i,new Set(t[i]))}),this.favorites=r}}catch(e){console.error("Error loading favorites:",e)}});f(this,"saveFavorites",()=>{try{const e={};this.favorites.forEach((t,r)=>{e[r]=Array.from(t)}),localStorage.setItem("galleryFavorites",JSON.stringify(e))}catch(e){console.error("Error saving favorites:",e)}});f(this,"toggleFavorite",(e,t)=>{var o,d;const r=t||this.showFavorites&&((o=this.currentItem)==null?void 0:o.media_source)||this.selectedMediaSource,i=e||this.showFavorites&&((d=this.currentItem)==null?void 0:d.category_id)||this.selectedCategory;if(!i||!r){console.warn("ToggleFavorite: category or mediaSource missing",i,r);return}this.favorites.has(r)||this.favorites.set(r,new Set);const l=this.favorites.get(r);if(l.has(i)){if(l.delete(i),this.showUrlMessage("Removed from favorites"),this.showFavorites){const c=i,k=r;if(this.items=this.items.filter(n=>!(n.category_id===c&&n.media_source===k)),this.items.length===0){let n=!0;if(this.favorites.forEach(C=>{C.size>0&&(n=!1)}),n){this.showFavorites=!1,this.showLikedImages=!1;const C=this.mediaSources.find(b=>b.id!==O);C?(this.selectedMediaSource=C.id,this.selectedCategory="",this.previousSelectedMediaSource=null,this.previousSelectedCategory=null,(async()=>(await this.loadCategories(),await this.loadCategory()))()):(this.items=[],this.error="No media sources available to display.",this.loading=!1,this.updateURL(),this.updateDocumentTitle(),this.stopAutoSlide());return}else{this.toggleShowFavorites();return}}else this.currentIndex=Math.max(0,Math.min(this.currentIndex,this.items.length-1)),this.updateDocumentTitle(),this.updateURL(),this.stopAutoSlide(),this.startAutoSlide()}}else l.add(i),this.showUrlMessage("Added to favorites");this.favorites=new Map(this.favorites),this.saveFavorites()});f(this,"isFavorite",(e,t)=>{var l,o;const r=t||this.showFavorites&&((l=this.currentItem)==null?void 0:l.media_source)||this.selectedMediaSource,i=e||this.showFavorites&&((o=this.currentItem)==null?void 0:o.category_id)||this.selectedCategory;return!i||!r?!1:this.favorites.has(r)&&this.favorites.get(r).has(i)});f(this,"loadFavoritesCategory",async()=>{var t;const e=this.showFavorites;this.showFavorites=!0,this.loading=!0,this.error=null,this.items=[];try{const r=this.selectedMediaSource;if(!this.favorites.has(r)||this.favorites.get(r).size===0)throw new Error("No favorites for this media source");const i=Array.from(this.favorites.get(r));let l=[];for(const d of i){const c=`/api/${r}/feed?category=${d}${this.isHD?"&hd=true":""}`,k=await fetch(c);if(!k.ok)throw new Error(`Failed to load favorites: ${k.statusText}`);const n=await k.json();if(n.items&&Array.isArray(n.items)){const C=((t=this.categories.find(x=>x.id===d))==null?void 0:t.name)||d,b=n.items.map(x=>({...x,sourceCategory:C}));l=[...l,...b]}}if(l.length===0)throw new Error("No items found in your favorites");this.items=this.shuffleArray(l),this.currentIndex=0;const o=new URL(window.location.href);o.searchParams.set("favorites","true"),ye(o.toString(),{}),this.isPaused||this.startAutoSlide(),this.updateDocumentTitle()}catch(r){console.error("Error loading favorites:",r),this.error=r.message||"Failed to load favorites",this.showFavorites=e}finally{this.loading=!1}});f(this,"loadAllFavorites",async()=>{var t,r;const e=this.showFavorites;this.showFavorites=!0,this.loading=!0,this.error=null,this.items=[];try{const i=Array.from(this.favorites.keys());if(i.length===0)throw new Error("No favorites found across any media sources");let l=[];for(const d of i){let c=[];try{const n=await fetch(`/api/${d}/categories`);n.ok?c=await n.json():console.warn(`Could not fetch categories for source ${d} during favorite loading. Status: ${n.status}`)}catch(n){console.warn(`Error fetching categories for source ${d} in loadAllFavorites:`,n)}const k=Array.from(this.favorites.get(d));for(const n of k){const C=`/api/${d}/feed?category=${n}${this.isHD?"&hd=true":""}`,b=await fetch(C);if(!b.ok){console.warn(`Failed to load favorites from ${d}/${n}: ${b.statusText}`);continue}const x=await b.json();if(x.items&&Array.isArray(x.items)){const w=((t=this.mediaSources.find(_=>_.id===d))==null?void 0:t.name)||d,I=((r=c.find(_=>_.id===n))==null?void 0:r.name)||n,g=x.items.map(_=>({..._,sourceCategory:`${w} - ${I}`,media_source:d,category_id:n}));l=[...l,...g]}}}if(l.length===0)throw new Error("No items found in your favorites");this.items=this.shuffleArray(l),this.currentIndex=0;const o=new URL(window.location.href);o.searchParams.set("favorites","true"),ye(o.toString(),{}),this.isPaused||this.startAutoSlide(),this.updateDocumentTitle()}catch(i){console.error("Error loading all favorites:",i),this.error=i.message||"Failed to load favorites",this.showFavorites=e}finally{this.loading=!1}});f(this,"toggleShowFavorites",()=>{var t,r;const e=!this.showFavorites;this.showFavorites=e,this.showLikedImages=!1,e?(this.selectedMediaSource!==O&&(this.previousSelectedMediaSource=this.selectedMediaSource,this.previousSelectedCategory=this.selectedCategory),this.selectedMediaSource=O,this.categories=[{id:re,name:"Favorites"}],this.selectedCategory=re,this.category=this.categories[0],this.categoryIndex=0,this.loadAllFavorites()):(this.selectedMediaSource=this.previousSelectedMediaSource||((t=this.mediaSources.find(i=>i.id!==O))==null?void 0:t.id)||((r=this.mediaSources[0])==null?void 0:r.id)||"",this.selectedCategory=this.previousSelectedCategory||"",this.previousSelectedMediaSource=null,this.previousSelectedCategory=null,this.loadCategory()),this.updateURL()});f(this,"loadLikedImages",()=>{try{const e=localStorage.getItem("galleryLikedImages");e&&(this.likedImages=JSON.parse(e))}catch(e){console.error("Error loading liked images:",e)}});f(this,"saveLikedImages",()=>{try{localStorage.setItem("galleryLikedImages",JSON.stringify(this.likedImages))}catch(e){console.error("Error saving liked images:",e)}});f(this,"toggleLikeImage",()=>{if(!this.currentItem)return;if(this.isImageLiked())this.likedImages=this.likedImages.filter(t=>{var r;return t.id!==((r=this.currentItem)==null?void 0:r.id)}),this.saveLikedImages(),this.showLikedImages&&(this.items=this.items.filter(t=>{var r;return t.id!==((r=this.currentItem)==null?void 0:r.id)}),this.items.length===0?(this.showLikedImages=!1,this.updateURL(),this.updateDocumentTitle()):this.currentIndex=Math.min(this.currentIndex,this.items.length-1));else if(this.currentItem){const t={...this.currentItem,sourceCategory:this.getCurrentCategoryName(),media_source:this.selectedMediaSource};this.likedImages.push(t),this.saveLikedImages()}});f(this,"isImageLiked",()=>this.currentItem?this.likedImages.some(e=>{var t;return e.id===((t=this.currentItem)==null?void 0:t.id)}):!1);f(this,"loadLikedImagesView",async()=>{const e=this.showLikedImages;this.showLikedImages=!0,this.loading=!0,this.error=null;try{if(this.likedImages.length===0)throw new Error("No liked images found");this.items=[...this.likedImages],this.currentIndex=0;const t=new URL(window.location.href);t.searchParams.set("liked","true"),ye(t.toString(),{}),this.isPaused||this.startAutoSlide(),this.updateDocumentTitle()}catch(t){console.error("Error loading liked images:",t),this.error=t.message||"Failed to load liked images",this.showLikedImages=e}finally{this.loading=!1}});f(this,"toggleShowLikedImages",()=>{var t,r;const e=!this.showLikedImages;this.showLikedImages=e,this.showFavorites=!1,e?(this.selectedMediaSource!==O&&(this.previousSelectedMediaSource=this.selectedMediaSource,this.previousSelectedCategory=this.selectedCategory),this.selectedMediaSource=O,this.categories=[{id:le,name:"Liked Images"}],this.selectedCategory=le,this.category=this.categories[0],this.categoryIndex=0,this.loadLikedImagesView()):(this.selectedMediaSource=this.previousSelectedMediaSource||((t=this.mediaSources.find(i=>i.id!==O))==null?void 0:t.id)||((r=this.mediaSources[0])==null?void 0:r.id)||"",this.selectedCategory=this.previousSelectedCategory||"",this.previousSelectedMediaSource=null,this.previousSelectedCategory=null,this.loadCategory()),this.updateURL()});f(this,"updateProgressBar",()=>{this.animateProgressBar()});f(this,"loadArchivedCuratedFeeds",()=>{try{const e=localStorage.getItem("galleryArchivedCuratedFeeds");e&&(this.archivedCuratedFeeds=JSON.parse(e))}catch(e){console.error("Error loading archived curated feeds:",e),this.archivedCuratedFeeds=[]}});f(this,"saveArchivedCuratedFeeds",()=>{try{localStorage.setItem("galleryArchivedCuratedFeeds",JSON.stringify(this.archivedCuratedFeeds))}catch(e){console.error("Error saving archived curatedFeeds:",e)}});f(this,"_loadSpecificCuratedFeed",e=>{console.log(`Loading archived curated feed: ${e.name} from stored items.`),this.loading=!0,this.error=null,this.items=[],this.showFavorites=!1,this.showLikedImages=!1;try{if(e.items&&e.id&&e.name){this.items=[...e.items],this.category={id:e.id,name:e.name},this.selectedCategory=this.category.id,this.currentIndex=0,this.items.length===0?this.error="Archived curated feed is empty.":this.error=null;const t=[{id:re,name:"Favorites"},{id:le,name:"Liked Images"},...this.archivedCuratedFeeds.map(r=>({id:r.id,name:r.name}))];this.categories=t,this.categoryIndex=Math.max(0,this.categories.findIndex(r=>r.id===this.selectedCategory)),this.updateProgressBar(),this.updateURL(),this.updateDocumentTitle(),this.prefetchNextImages(),this.startAutoSlide(),e.userfriendly_message&&this.showUrlMessage(e.userfriendly_message)}else throw new Error("Invalid archived curated feed data.")}catch(t){console.error("Error loading archived curated feed:",t),this.error=t.message||"An error occurred while loading the archived curated feed.",this.items=[]}finally{this.loading=!1}})}get loading(){return h(a(this,_e))}set loading(e){y(a(this,_e),e,!0)}get error(){return h(a(this,Se))}set error(e){y(a(this,Se),e,!0)}get items(){return h(a(this,be))}set items(e){y(a(this,be),e,!0)}get currentIndex(){return h(a(this,xe))}set currentIndex(e){y(a(this,xe),e,!0)}get autoSlideIntervalId(){return h(a(this,Ce))}set autoSlideIntervalId(e){y(a(this,Ce),e,!0)}get slideInterval(){return h(a(this,Te))}set slideInterval(e){y(a(this,Te),e,!0)}get originalInterval(){return h(a(this,Me))}set originalInterval(e){y(a(this,Me),e,!0)}get isPaused(){return h(a(this,Fe))}set isPaused(e){y(a(this,Fe),e,!0)}get isHD(){return h(a(this,Le))}set isHD(e){y(a(this,Le),e,!0)}get direction(){return h(a(this,Ae))}set direction(e){y(a(this,Ae),e,!0)}get darkMode(){return h(a(this,Ee))}set darkMode(e){y(a(this,Ee),e,!0)}get selectedCategory(){return h(a(this,Pe))}set selectedCategory(e){y(a(this,Pe),e,!0)}get isFullscreen(){return h(a(this,Oe))}set isFullscreen(e){y(a(this,Oe),e,!0)}get hideToolbar(){return h(a(this,De))}set hideToolbar(e){y(a(this,De),e,!0)}get exitBtnTimeoutId(){return h(a(this,Ne))}set exitBtnTimeoutId(e){y(a(this,Ne),e,!0)}get buttonsTimeoutId(){return h(a(this,Re))}set buttonsTimeoutId(e){y(a(this,Re),e,!0)}get categories(){return h(a(this,Be))}set categories(e){y(a(this,Be),e,!0)}get categoryIndex(){return h(a(this,Ue))}set categoryIndex(e){y(a(this,Ue),e,!0)}get inactivityTimeoutId(){return h(a(this,He))}set inactivityTimeoutId(e){y(a(this,He),e,!0)}get prefetchedImages(){return h(a(this,$e))}set prefetchedImages(e){y(a(this,$e),e,!0)}get nToPrefetch(){return h(a(this,je))}set nToPrefetch(e){y(a(this,je),e,!0)}get mediaSources(){return h(a(this,ze))}set mediaSources(e){y(a(this,ze),e,!0)}get selectedMediaSource(){return h(a(this,qe))}set selectedMediaSource(e){y(a(this,qe),e,!0)}get showHelp(){return h(a(this,Ve))}set showHelp(e){y(a(this,Ve),e,!0)}get showDescription(){return h(a(this,Ye))}set showDescription(e){y(a(this,Ye),e,!0)}get targetImageId(){return h(a(this,Qe))}set targetImageId(e){y(a(this,Qe),e,!0)}get prefetchDebounceTimerId(){return h(a(this,Ge))}set prefetchDebounceTimerId(e){y(a(this,Ge),e,!0)}get prefetchDebounceDelay(){return h(a(this,Xe))}set prefetchDebounceDelay(e){y(a(this,Xe),e,!0)}get wasPlayingBeforeTouch(){return h(a(this,Je))}set wasPlayingBeforeTouch(e){y(a(this,Je),e,!0)}get hdSupported(){return h(a(this,Ke))}set hdSupported(e){y(a(this,Ke),e,!0)}get showMediaSourceOverlay(){return h(a(this,We))}set showMediaSourceOverlay(e){y(a(this,We),e,!0)}get mediaSourceOverlayText(){return h(a(this,Ze))}set mediaSourceOverlayText(e){y(a(this,Ze),e,!0)}get mediaSourceOverlayTimeoutId(){return h(a(this,et))}set mediaSourceOverlayTimeoutId(e){y(a(this,et),e,!0)}get mediaSourceOverlayTransitionId(){return h(a(this,tt))}set mediaSourceOverlayTransitionId(e){y(a(this,tt),e,!0)}get mouseX(){return h(a(this,rt))}set mouseX(e){y(a(this,rt),e,!0)}get mouseY(){return h(a(this,st))}set mouseY(e){y(a(this,st),e,!0)}get isMobile(){return h(a(this,it))}set isMobile(e){y(a(this,it),e,!0)}get searchQuery(){return h(a(this,at))}set searchQuery(e){y(a(this,at),e,!0)}get showSearchOverlay(){return h(a(this,ot))}set showSearchOverlay(e){y(a(this,ot),e,!0)}get overlayMessage(){return h(a(this,lt))}set overlayMessage(e){y(a(this,lt),e,!0)}get showMessageOverlay(){return h(a(this,nt))}set showMessageOverlay(e){y(a(this,nt),e,!0)}get overlayTimeoutId(){return h(a(this,dt))}set overlayTimeoutId(e){y(a(this,dt),e,!0)}get searchToken(){return h(a(this,ct))}set searchToken(e){y(a(this,ct),e,!0)}get isSearchAuthorized(){return h(a(this,ht))}set isSearchAuthorized(e){y(a(this,ht),e,!0)}get tokenError(){return h(a(this,ut))}set tokenError(e){y(a(this,ut),e,!0)}get progressBar(){return h(a(this,gt))}set progressBar(e){y(a(this,gt),e,!0)}get progressAnimation(){return h(a(this,vt))}set progressAnimation(e){y(a(this,vt),e,!0)}get controlsTimeoutId(){return h(a(this,ft))}set controlsTimeoutId(e){y(a(this,ft),e,!0)}get progressIntervalId(){return h(a(this,mt))}set progressIntervalId(e){y(a(this,mt),e,!0)}get category(){return h(a(this,pt))}set category(e){y(a(this,pt),e,!0)}get favorites(){return h(a(this,yt))}set favorites(e){y(a(this,yt),e,!0)}get showFavorites(){return h(a(this,wt))}set showFavorites(e){y(a(this,wt),e,!0)}get likedImages(){return h(a(this,kt))}set likedImages(e){y(a(this,kt),e,!0)}get showLikedImages(){return h(a(this,It))}set showLikedImages(e){y(a(this,It),e,!0)}get previousSelectedMediaSource(){return h(a(this,_t))}set previousSelectedMediaSource(e){y(a(this,_t),e,!0)}get previousSelectedCategory(){return h(a(this,St))}set previousSelectedCategory(e){y(a(this,St),e,!0)}get archivedCuratedFeeds(){return h(a(this,bt))}set archivedCuratedFeeds(e){y(a(this,bt),e,!0)}get currentItem(){return this.items[this.currentIndex]||null}get currentCategoryName(){var e,t,r;return this.showFavorites?((e=this.currentItem)==null?void 0:e.sourceCategory)||"Favorites":this.showLikedImages?"Liked Images":this.selectedMediaSource===O?((t=this.category)==null?void 0:t.name)||"Curated Story":this.category?this.category.name:((r=this.categories.find(i=>i.id===this.selectedCategory))==null?void 0:r.name)||this.selectedCategory||"Loading..."}get currentSourceName(){var e;return((e=this.mediaSources.find(t=>t.id===this.selectedMediaSource))==null?void 0:e.name)||"Unknown Source"}}_e=new WeakMap,Se=new WeakMap,be=new WeakMap,xe=new WeakMap,Ce=new WeakMap,Te=new WeakMap,Me=new WeakMap,Fe=new WeakMap,Le=new WeakMap,Ae=new WeakMap,Ee=new WeakMap,Pe=new WeakMap,Oe=new WeakMap,De=new WeakMap,Ne=new WeakMap,Re=new WeakMap,Be=new WeakMap,Ue=new WeakMap,He=new WeakMap,$e=new WeakMap,je=new WeakMap,ze=new WeakMap,qe=new WeakMap,Ve=new WeakMap,Ye=new WeakMap,Qe=new WeakMap,Ge=new WeakMap,Xe=new WeakMap,Je=new WeakMap,Ke=new WeakMap,We=new WeakMap,Ze=new WeakMap,et=new WeakMap,tt=new WeakMap,rt=new WeakMap,st=new WeakMap,it=new WeakMap,at=new WeakMap,ot=new WeakMap,lt=new WeakMap,nt=new WeakMap,dt=new WeakMap,ct=new WeakMap,ht=new WeakMap,ut=new WeakMap,gt=new WeakMap,vt=new WeakMap,ft=new WeakMap,mt=new WeakMap,pt=new WeakMap,yt=new WeakMap,wt=new WeakMap,kt=new WeakMap,It=new WeakMap,_t=new WeakMap,St=new WeakMap,bt=new WeakMap;const ss="gallery",ji=(s=ss)=>gi(s),zi=(s=ss)=>{const e=new $i;return ui(s,e)};var qi=$('<span class="text-yellow-300">(requires token)</span>'),Vi=$('<div class="help-overlay svelte-mi25pp" role="dialog" aria-modal="true" aria-labelledby="help-dialog-title" tabindex="0"><div class="help-content svelte-mi25pp"><h2 class="mb-4 font-bold text-2xl text-center">Keyboard Shortcuts</h2> <table class="shortcuts-table svelte-mi25pp"><tbody><tr><td class="svelte-mi25pp"><span class="key svelte-mi25pp">â</span></td><td class="svelte-mi25pp">Previous image</td></tr><tr><td class="svelte-mi25pp"><span class="key svelte-mi25pp">â</span></td><td class="svelte-mi25pp">Next image</td></tr><tr><td class="svelte-mi25pp"><span class="key svelte-mi25pp">Enter</span></td><td class="svelte-mi25pp">Open current image link</td></tr><tr><td class="svelte-mi25pp"><span class="key svelte-mi25pp">â</span></td><td class="svelte-mi25pp">Previous category</td></tr><tr><td class="svelte-mi25pp"><span class="key svelte-mi25pp">â</span></td><td class="svelte-mi25pp">Next category</td></tr><tr><td class="svelte-mi25pp"><span class="key svelte-mi25pp">Page Up</span></td><td class="svelte-mi25pp">Previous media source</td></tr><tr><td class="svelte-mi25pp"><span class="key svelte-mi25pp">Page Down</span></td><td class="svelte-mi25pp">Next media source</td></tr><tr><td class="svelte-mi25pp"><span class="key svelte-mi25pp">D</span></td><td class="svelte-mi25pp">Toggle image description</td></tr><tr><td class="svelte-mi25pp"><span class="key svelte-mi25pp">P</span></td><td class="svelte-mi25pp">Pause/resume slideshow</td></tr><tr><td class="svelte-mi25pp"><span class="key svelte-mi25pp">F</span></td><td class="svelte-mi25pp">Toggle fullscreen</td></tr><tr><td class="svelte-mi25pp"><span class="key svelte-mi25pp">Esc</span></td><td class="svelte-mi25pp">Exit fullscreen</td></tr><tr><td class="svelte-mi25pp"><span class="key svelte-mi25pp">H</span></td><td class="svelte-mi25pp">Toggle help (this screen)</td></tr><tr><td class="svelte-mi25pp"><span class="key svelte-mi25pp">/</span></td><td class="svelte-mi25pp">Open search <!></td></tr><tr><td class="svelte-mi25pp"><span class="key svelte-mi25pp">S</span></td><td class="svelte-mi25pp">Toggle favorite for current category</td></tr><tr><td class="svelte-mi25pp"><span class="key svelte-mi25pp">V</span></td><td class="svelte-mi25pp">View favorites for current media source</td></tr><tr><td class="svelte-mi25pp"><span class="key svelte-mi25pp">L</span></td><td class="svelte-mi25pp">Like/unlike current image</td></tr><tr><td class="svelte-mi25pp"><span class="key svelte-mi25pp">I</span></td><td class="svelte-mi25pp">View all liked images</td></tr></tbody></table> <div class="opacity-70 mt-6 text-sm text-center">Click anywhere outside this window to close</div></div></div>'),Yi=$('<div class="relative bg-red-100 dark:bg-red-900 mb-4 px-4 py-3 border border-red-400 dark:border-red-700 rounded text-red-700 dark:text-red-300"><span> </span></div>'),Qi=s=>s.stopPropagation(),Gi=$('<div class="mt-2 text-red-400 text-sm"> </div>'),Xi=$('<div class="mb-4"><form><label class="block mb-2 text-gray-300 text-sm" for="searchToken">Enter token to access search:</label> <input type="text" id="searchToken" placeholder="Enter token" class="bg-white/90 dark:bg-gray-200/90 px-4 py-2 border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 w-full text-gray-900"></form> <!> <div class="flex justify-center mt-5"><button class="bg-blue-500 hover:bg-blue-600 px-6 py-2 rounded-md text-white transition-colors cursor-pointer"><span>Verify</span> <span>Verifying...</span></button></div></div>'),Ji=$('<div class="flex flex-row justify-center gap-4 mt-5"><input type="text" placeholder="e.g., Van Gogh starry night, story of..." class="bg-white/90 dark:bg-gray-200/90 px-4 py-2 border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 w-full text-gray-900"> <button class="bg-blue-500 hover:bg-blue-600 px-6 py-2 rounded-md text-white transition-colors cursor-pointer" title="Search or Curate" aria-label="Search or Curate gallery"><span>â¨</span> <span>Searching...</span></button></div>'),Ki=$('<div class="mt-4 text-red-400 text-center"> </div>'),Wi=$('<div class="z-[100] fixed inset-0 flex justify-center items-center bg-black/85 backdrop-blur-sm p-4" role="dialog" aria-modal="true" aria-labelledby="search-dialog-title" tabindex="0"><div class="relative bg-gray-900 dark:bg-dark-surface shadow-xl p-6 rounded-lg w-full max-w-md" role="dialog" aria-modal="true" aria-labelledby="search-dialog-title" tabindex="0"><button class="top-4 right-4 absolute text-gray-400 hover:text-white text-xl transition-colors cursor-pointer" aria-label="Close search">Ã</button> <!> <!></div></div>'),Zi=$('<div class="z-[110] fixed inset-0 flex justify-center items-center"><div class="bg-black/80 shadow-lg px-8 py-6 rounded-xl max-w-md text-white text-center"><div class="text-lg"> </div></div></div>'),ea=$('<button class="cursor-pointer exit-fullscreen-btn nav-button svelte-mi25pp" aria-label="Exit fullscreen"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),ta=$('<img width="100%" height="100%" class="transition-all duration-500 gallery-image svelte-mi25pp">'),ra=$('<a target="_blank" class="flex-1 font-semibold hover:underline basis-1/2"><h2 class="font-semibold"> </h2></a> <button aria-label="Like/unlike current image" title="Like/unlike current image (L)"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg></button>',1),sa=$('<div class="relative max-h-[10vh] overflow-y-auto text-sm hide-scrollbar svelte-mi25pp"><div><!></div></div>'),ia=$("<option> </option>"),aa=$("<option> </option>"),oa=$('<div class="gallery-wrapper svelte-mi25pp"><!> <div class="image-container svelte-mi25pp"><div><div class="border-gray-700 dark:border-gray-300 border-b-2 rounded-full w-12 h-12 animate-spin"></div></div> <div class="z-9 relative flex justify-center items-center w-full h-full"><div><div class="mb-1 font-bold text-2xl"> </div> <div class="opacity-75 text-sm"> </div></div> <!> <button class="mobile-nav-area mobile-nav-prev svelte-mi25pp" aria-label="Previous image"></button> <button class="mobile-nav-area mobile-nav-next svelte-mi25pp" aria-label="Next image"></button> <div><button class="flex items-center bg-black/50 hover:bg-black/80 px-4 py-2 rounded-full text-white transition-all duration-300 cursor-pointer" aria-label="Previous category"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg> <span class="ml-2 svelte-mi25pp"> </span></button></div> <div><button aria-label="Next category"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg> <span class="ml-2 svelte-mi25pp"> </span></button> <button title="Refresh random artist" aria-label="Refresh random artist"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button></div> <button class="bg-black/50 hover:bg-black/80 p-2 rounded-full text-white transition-all duration-300 cursor-pointer image-nav-button image-nav-prev nav-button svelte-mi25pp" aria-label="Previous image"><svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button> <button class="bg-black/50 hover:bg-black/80 p-2 rounded-full text-white transition-all duration-300 cursor-pointer image-nav-button image-nav-next nav-button svelte-mi25pp" aria-label="Next image"><svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button></div> <div class="title-overlay svelte-mi25pp"><div class="flex flex-row justify-between items-center"><!> <div><span> </span> <button aria-label="Toggle favorites" class="ml-2 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg></button></div></div>  <!></div> <div class="progress-container svelte-mi25pp"><div class="progress-bar svelte-mi25pp"></div></div></div> <div><div class="flex flex-shrink items-center space-x-1 md:space-x-2"><div class="flex justify-center items-center media-source-selector"><select class="bg-white dark:bg-dark-surface px-4 py-2 border-gray-300 border-unset dark:border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 max-w-[50vw] md:max-w-none text-gray-800 dark:text-dark-text"></select></div> <div class="flex flex-shrink justify-center items-center category-selector"><select class="bg-white dark:bg-dark-surface px-4 py-2 border-gray-300 border-unset dark:border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-full md:max-w-[30vw] xl:max-w-none text-gray-800 dark:text-dark-text"></select></div></div> <div class="flex flex-grow justify-center items-center"><span class="text-gray-600 dark:text-gray-400 text-sm"><span> </span> of <span> </span></span></div> <div class="flex justify-center items-center space-x-1 md:space-x-2"><button title="Search ( / )" aria-label="Search gallery"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path></svg></button> <button aria-label="Toggle favorites view" title="Toggle favorites view"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg></button> <button aria-label="View all liked images" title="View all liked images (I)"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg></button> <button aria-label="Toggle slideshow" title="Pause/Resume slideshow"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path></svg></button> <button aria-label="Toggle HD quality" title="Toggle HD images"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M3 3h18a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1m4.5 8.25V9H6v6h1.5v-2.25h2V15H11V9H9.5v2.25zm7-.75H16a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-1.5zM13 9v6h3a2 2 0 0 0 2-2v-2a2 2 0 0 0-2-2z"></path></svg></button> <button aria-label="Toggle fullscreen" title="Toggle fullscreen" class="hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full focus:outline-none text-gray-600 dark:text-gray-400 cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"></path></svg></button> <button aria-label="Toggle description" title="Toggle description"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg></button> <div class="flex items-center space-x-1"><span class="text-sm"><svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg></span> <label class="toggle-switch svelte-mi25pp"><input type="checkbox" class="opacity-0 w-0 h-0 svelte-mi25pp"> <span class="toggle-slider svelte-mi25pp"></span></label> <span class="text-sm"><svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg></span></div></div></div> <div>No images found in the feed.</div></div>'),la=$('<div class="bg-gray-100 dark:bg-dark-bg text-gray-900 dark:text-dark-text transition-colors duration-300 main-container svelte-mi25pp"><!> <!> <!> <!> <!></div>');function va(s,e){vi(e,!0),zi();const t=ji();fi(()=>(t.init(),()=>{t.autoSlideIntervalId&&clearInterval(t.autoSlideIntervalId),t.controlsTimeoutId&&clearTimeout(t.controlsTimeoutId),t.inactivityTimeoutId&&clearTimeout(t.inactivityTimeoutId),t.overlayTimeoutId&&clearTimeout(t.overlayTimeoutId),t.progressIntervalId&&clearInterval(t.progressIntervalId)}));var r=la(),i=v(r);{var l=w=>{var I=Vi();I.__click=L=>{L.stopPropagation(),t.showHelp=!1},I.__keydown=L=>{L.key,t.showHelp=!1};var g=v(I),_=S(v(g),2),T=v(_),D=S(v(T),12),B=S(v(D)),R=S(v(B));{var j=L=>{var E=qi();H(L,E)};Y(R,L=>{t.isSearchAuthorized||L(j)})}u(B),u(D),At(4),u(T),u(_),At(2),u(g),u(I),H(w,I)};Y(i,w=>{t.showHelp&&w(l)})}var o=S(i,2);{var d=w=>{var I=Yi(),g=v(I),_=v(g,!0);u(g),u(I),Q(()=>z(_,t.error)),H(w,I)};Y(o,w=>{t.error&&w(d)})}var c=S(o,2);{var k=w=>{var I=Wi();I.__click=()=>t.closeSearchOverlay(),I.__keydown=L=>L.key==="Escape"&&t.closeSearchOverlay();var g=v(I);g.__click=[Qi],g.__keydown=L=>L.key==="Escape"&&t.closeSearchOverlay();var _=v(g);_.__click=()=>t.closeSearchOverlay();var T=S(_,2);{var D=L=>{var E=Xi(),N=v(E),V=S(v(N),2);Zt(V),V.__keydown=X=>X.key==="Enter"&&t.verifyToken(),Rr(V),u(N);var ie=S(N,2);{var ae=X=>{var oe=Gi(),he=v(oe,!0);u(oe),Q(()=>z(he,t.tokenError)),H(X,oe)};Y(ie,X=>{t.tokenError&&X(ae)})}var de=S(ie,2),J=v(de);J.__click=()=>t.verifyToken();var G=v(J);let W;var xt=S(G,2);let ce;u(J),u(de),u(E),Q((X,oe)=>{W=P(G,1,"",null,W,X),ce=P(xt,1,"",null,ce,oe)},[()=>({hidden:t.loading}),()=>({hidden:!t.loading})]),Br("submit",N,()=>t.verifyToken()),Vr(V,()=>t.searchToken,X=>t.searchToken=X),H(L,E)},B=L=>{var E=Ji(),N=v(E);Zt(N),N.__keydown=G=>G.key==="Enter"&&t.performSearch(),Rr(N);var V=S(N,2);V.__click=()=>t.performSearch();var ie=v(V);let ae;var de=S(ie,2);let J;u(V),u(E),Q((G,W)=>{ae=P(ie,1,"",null,ae,G),J=P(de,1,"",null,J,W)},[()=>({hidden:t.loading}),()=>({hidden:!t.loading})]),Vr(N,()=>t.searchQuery,G=>t.searchQuery=G),H(L,E)};Y(T,L=>{t.isSearchAuthorized?L(B,!1):L(D)})}var R=S(T,2);{var j=L=>{var E=Ki(),N=v(E,!0);u(E),Q(()=>z(N,t.error)),H(L,E)};Y(R,L=>{t.error&&L(j)})}u(g),u(I),H(w,I)};Y(c,w=>{t.showSearchOverlay&&w(k)})}var n=S(c,2);{var C=w=>{var I=Zi(),g=v(I),_=v(g),T=v(_,!0);u(_),u(g),u(I),Q(()=>z(T,t.overlayMessage)),Pt(3,I,()=>Ot,()=>({duration:300})),H(w,I)};Y(n,w=>{t.showMessageOverlay&&w(C)})}var b=S(n,2);{var x=w=>{var I=oa(),g=v(I);{var _=M=>{var F=ea();F.__click=()=>t.exitFullscreen();var A=v(F);let U;u(F),Q(Z=>U=P(A,0,"w-5 h-5",null,U,Z),[()=>({hidden:!t.isFullscreen&&!t.hideToolbar})]),H(M,F)};Y(g,M=>{(t.hideToolbar||t.isFullscreen)&&M(_)})}var T=S(g,2),D=v(T);let B;var R=S(D,2),j=v(R);let L;var E=v(j),N=v(E,!0);u(E);var V=S(E,2),ie=v(V,!0);u(V),u(j);var ae=S(j,2);{var de=M=>{var F=ta();Q(()=>{K(F,"src",t.currentItem.image_url),K(F,"alt",t.currentItem.title)}),Br("error",F,function(...A){var U;(U=t.handleImageError)==null||U.apply(this,A)}),_i(F),Pt(3,F,()=>Ot,()=>({duration:500})),H(M,F)};Y(ae,M=>{t.currentItem&&M(de)})}var J=S(ae,2);J.__click=()=>t.prevItem(),J.__keydown=M=>M.key==="Enter"&&t.prevItem();var G=S(J,2);G.__click=()=>t.nextItem(),G.__keydown=M=>M.key==="Enter"&&t.nextItem();var W=S(G,2);let xt;var ce=v(W);ce.__click=()=>t.prevCategory();var X=S(v(ce),2),oe=v(X,!0);u(X),u(ce),u(W);var he=S(W,2);let ar;var ge=v(he);ge.__click=()=>t.nextCategory();let or;var lr=S(v(ge),2),is=v(lr,!0);u(lr),u(ge);var nr=S(ge,2);nr.__click=()=>t.refreshRandomArtist();let dr;u(he);var cr=S(he,2);cr.__click=()=>t.prevItem();var as=S(cr,2);as.__click=()=>t.nextItem(),u(R);var Nt=S(R,2),Rt=v(Nt),hr=v(Rt);{var os=M=>{var F=ra(),A=pi(F),U=v(A),Z=v(U,!0);u(U),u(A);var ue=S(A,2);ue.__click=()=>t.toggleLikeImage();let Lt;var Gt=v(ue);u(ue),Q((Xt,Jt)=>{K(A,"href",t.currentItem.link),z(Z,t.currentItem.title),Lt=P(ue,1,"hover:bg-gray-200 dark:hover:bg-gray-700 ml-2 p-2 rounded-full focus:outline-none cursor-pointer",null,Lt,Xt),K(Gt,"fill",Jt)},[()=>({"text-red-500":t.isImageLiked(),"text-gray-600":!t.isImageLiked(),"dark:text-gray-400":!t.isImageLiked()}),()=>t.isImageLiked()?"currentColor":"none"]),H(M,F)};Y(hr,M=>{t.currentItem&&M(os)})}var Bt=S(hr,2);let ur;var Ut=v(Bt),ls=v(Ut,!0);u(Ut);var Ct=S(Ut,2);Ct.__click=M=>{M.stopPropagation(),t.showFavorites&&t.currentItem?t.toggleFavorite(t.currentItem.category_id,t.currentItem.media_source):t.toggleFavorite()};var ns=v(Ct);u(Ct),u(Bt),u(Rt);var ds=S(Rt,2);{var cs=M=>{var F=sa(),A=v(F),U=v(A);Ti(U,()=>t.currentItem.description),u(A),u(F),Pt(3,F,()=>Ot),H(M,F)};Y(ds,M=>{var F;t.showDescription&&((F=t.currentItem)!=null&&F.description)&&M(cs)})}u(Nt);var gr=S(Nt,2),hs=v(gr);Si(hs,M=>t.progressBar=M,()=>t==null?void 0:t.progressBar),u(gr),u(T);var Tt=S(T,2),Ht=v(Tt),$t=v(Ht),Mt=v($t);Mt.__change=()=>t.changeMediaSource(),Hr(Mt,21,()=>t.mediaSources,M=>M.id,(M,F)=>{var A=ia(),U={},Z=v(A,!0);u(A),Q(()=>{U!==(U=h(F).id)&&(A.value=(A.__value=h(F).id)??""),z(Z,h(F).name)}),H(M,A)}),u(Mt),u($t);var vr=S($t,2),Ft=v(vr);Ft.__change=()=>t.loadCategory(),Hr(Ft,21,()=>t.categories,M=>M.id,(M,F)=>{var A=aa(),U={},Z=v(A,!0);u(A),Q(()=>{U!==(U=h(F).id)&&(A.value=(A.__value=h(F).id)??""),Ei(A,h(F).id===(t.selectedCategory||t.categories[0].id)),z(Z,h(F).name)}),H(M,A)}),u(Ft),u(vr),u(Ht);var jt=S(Ht,2),fr=v(jt),zt=v(fr),us=v(zt,!0);u(zt);var mr=S(zt,2),gs=v(mr,!0);u(mr),u(fr),u(jt);var pr=S(jt,2),qt=v(pr);qt.__click=()=>t.openSearchOverlay();let yr;var ve=S(qt,2);ve.__click=()=>t.toggleShowFavorites();let wr;var vs=v(ve);u(ve);var fe=S(ve,2);fe.__click=()=>t.toggleShowLikedImages();let kr;var fs=v(fe);u(fe);var me=S(fe,2);me.__click=()=>t.togglePause();let Ir;var _r=v(me);let Sr;var ms=S(_r,2);let br;u(me);var Vt=S(me,2);Vt.__click=()=>t.toggleHD();let xr;var Cr=S(Vt,2);Cr.__click=()=>t.toggleFullscreen();var Yt=S(Cr,2);Yt.__click=()=>t.showDescription=!t.showDescription;let Tr;var Mr=S(Yt,2),Fr=S(v(Mr),2),Qt=v(Fr);Zt(Qt),Qt.__click=()=>t.toggleDarkMode(),At(2),u(Fr),At(2),u(Mr),u(pr),u(Tt);var ps=S(Tt,2);let Lr;u(I),Q((M,F,A,U,Z,ue,Lt,Gt,Xt,Jt,ys,ws,ks,Is,_s,Ss,bs,xs,Cs,Ts)=>{B=P(D,1,"z-10 absolute flex justify-center items-center bg-black/50 w-full h-full transition-all duration-300",null,B,M),L=P(j,1,"top-1/2 left-1/2 z-9 fixed flex flex-col justify-center items-center bg-black/50 shadow-lg px-8 py-4 rounded-xl font-semibold text-white text-center transition-opacity -translate-x-1/2 -translate-y-1/2 duration-300 nav-button transform svelte-mi25pp",null,L,F),z(N,t.currentSourceName),z(ie,t.currentCategoryName),xt=P(W,1,"flex items-center category-nav-button category-up nav-button svelte-mi25pp",null,xt,A),z(oe,U),ar=P(he,1,"flex items-center category-nav-button category-down nav-button svelte-mi25pp",null,ar,Z),or=P(ge,1,"flex items-center bg-black/50 hover:bg-black/80 px-4 py-2 rounded-l-full text-white transition-all duration-300 cursor-pointer",null,or,ue),z(is,Lt),dr=P(nr,1,"bg-black/50 hover:bg-black/80 px-3 py-[10px] border-white-600 border-l rounded-r-full text-white transition-all duration-300 cursor-pointer",null,dr,Gt),ur=P(Bt,1,"flex items-center bg-black/50 ml-3 px-3 py-1 rounded-full text-sm svelte-mi25pp",null,ur,Xt),z(ls,t.currentCategoryName),K(Ct,"title",Jt),K(ns,"fill",ys),P(Tt,1,`${t.hideToolbar?"hidden":"flex"} justify-center items-center text-sm control-bar`,"svelte-mi25pp"),z(us,t.currentIndex+1),z(gs,t.items.length),yr=P(qt,1,"hover:bg-gray-200 dark:hover:bg-gray-700 p-2 rounded-full focus:outline-none text-gray-600 dark:text-gray-400 cursor-pointer",null,yr,ws),wr=P(ve,1,"hover:bg-gray-200 dark:hover:bg-gray-700 p-2 rounded-full focus:outline-none cursor-pointer",null,wr,ks),K(vs,"fill",t.showFavorites?"currentColor":"none"),kr=P(fe,1,"hover:bg-gray-200 dark:hover:bg-gray-700 p-2 rounded-full focus:outline-none cursor-pointer",null,kr,Is),K(fs,"fill",t.showLikedImages?"currentColor":"none"),Ir=P(me,1,"hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full focus:outline-none cursor-pointer",null,Ir,_s),Sr=P(_r,0,"w-5 h-5",null,Sr,Ss),br=P(ms,0,"w-5 h-5",null,br,bs),xr=P(Vt,1,"hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full focus:outline-none cursor-pointer",null,xr,xs),Tr=P(Yt,1,"hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full focus:outline-none cursor-pointer",null,Tr,Cs),Ai(Qt,t.darkMode),Lr=P(ps,1,"p-8 text-gray-600 dark:text-gray-400 text-center",null,Lr,Ts)},[()=>({hidden:!t.loading}),()=>({visible:t.showMediaSourceOverlay,"opacity-0":!t.showMediaSourceOverlay,hidden:t.isMobile}),()=>({hidden:t.categories.length<=1}),()=>t.getPrevCategoryName(),()=>({hidden:t.categories.length<=1}),()=>({"rounded-r-full":t.selectedCategory!=="random-artist"}),()=>t.getNextCategoryName(),()=>({hidden:t.selectedCategory!=="random-artist"}),()=>({hidden:!t.selectedCategory,"mobile-truncate":t.selectedMediaSource!=="wikiart"}),()=>t.showFavorites&&t.currentItem?t.isFavorite(t.currentItem.category_id,t.currentItem.media_source)?"Remove from favorites":"Add to favorites":t.isFavorite()?"Remove from favorites":"Add to favorites",()=>t.showFavorites&&t.currentItem?t.isFavorite(t.currentItem.category_id,t.currentItem.media_source)?"currentColor":"none":t.isFavorite()?"currentColor":"none",()=>({hidden:!t.isSearchAuthorized}),()=>({"text-yellow-500":t.showFavorites,"text-gray-600":!t.showFavorites,"dark:text-gray-400":!t.showFavorites}),()=>({"text-red-500":t.showLikedImages,"text-gray-600":!t.showLikedImages,"dark:text-gray-400":!t.showLikedImages}),()=>({"text-blue-500":t.isPaused,"text-gray-600":!t.isPaused,"dark:text-gray-400":!t.isPaused}),()=>({hidden:t.isPaused}),()=>({hidden:!t.isPaused}),()=>({"text-blue-500":t.isHD,"text-gray-600":!t.isHD,"dark:text-gray-400":!t.isHD}),()=>({"text-blue-500":t.showDescription,"text-gray-600":!t.showDescription,"dark:text-gray-400":!t.showDescription}),()=>({hidden:t.loading||t.items.length>0||t.error})]),Pt(3,j,()=>Ot,()=>({duration:300})),Yr(Mt,()=>t.selectedMediaSource,M=>t.selectedMediaSource=M),Yr(Ft,()=>t.selectedCategory,M=>t.selectedCategory=M),H(w,I)};Y(b,w=>{t.items.length>0&&w(x)})}u(r),H(s,r),mi()}Ii(["click","keydown","change"]);export{va as component};
