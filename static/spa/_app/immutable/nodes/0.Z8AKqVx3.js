var Cr=Object.defineProperty;var Ms=r=>{throw TypeError(r)};var Tr=(r,e,t)=>e in r?Cr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var m=(r,e,t)=>Tr(r,typeof e!="symbol"?e+"":e,t),Mr=(r,e,t)=>e.has(r)||Ms("Cannot "+t);var a=(r,e,t)=>(Mr(r,e,"read from private field"),t?t.call(r):e.get(r)),y=(r,e,t)=>e.has(r)?Ms("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t);import{b as Fs,e as Fr,t as U,a as N}from"../chunks/C0QaH9dC.js";import{s as Pt,h as G,I as pe,M as Lr,a as ts,b as Ar,w as h,a6 as Er,c as Pr,r as Ls,d as Xt,g as de,Z as Or,e as Ys,f as Qs,p as Dr,a1 as Gs,R as Rr,ab as Br,am as As,an as Jt,L as ke,ao as Nr,ap as Ur,aq as Hr,a0 as jr,ar as $r,as as zr,at as qr,au as Vr,X as Xs,C as Q,av as Yr,_ as Qr,Y as Gr,aw as Xr,ax as Jr,ay as Kr,az as Wr,aA as Zr,E as ei,aB as ti,aC as si,i as rs,u as Js,aD as ri,aE as ii,q as ai,aF as ye,N as Es,O as Ps,P as oi,aG as li,j as ni,aH as di,aI as ci,aJ as ui,aj as p,aa as w,a9 as ie,k as hi,o as gi,l as vi,D as f,G as _,F as g,aK as Ft,B as Os}from"../chunks/D4KI4Ps9.js";import{a as fi,b as mi,w as yi,l as Ks,d as pi,s as V,c as Ds,e as Rs,r as wi}from"../chunks/CkaAntYN.js";import{i as Y,b as ki}from"../chunks/COqvbv4a.js";import{r as Bs,a as Ns}from"../chunks/Da4LftP9.js";function bi(r,e,t,s){for(var i=[],l=e.length,o=0;o<l;o++)Hr(e[o].e,i,!0);var c=l>0&&i.length===0&&t!==null;if(c){var u=t.parentNode;jr(u),u.append(t),s.clear(),ae(r,e[0].prev,e[l-1].next)}$r(i,()=>{for(var v=0;v<l;v++){var d=e[v];c||(s.delete(d.k),ae(r,d.prev,d.next)),zr(d.e,!c)}})}function Us(r,e,t,s,i,l=null){var o=r,c={flags:e,items:new Map,first:null};{var u=r;o=G?Pt(pe(u)):u.appendChild(Lr())}G&&ts();var v=null,d=!1,C=Er(()=>{var b=t();return Rr(b)?b:b==null?[]:Gs(b)});Ar(()=>{var b=h(C),F=b.length;if(d&&F===0)return;d=F===0;let n=!1;if(G){var k=o.data===Pr;k!==(F===0)&&(o=Ls(),Pt(o),Xt(!1),n=!0)}if(G){for(var I=null,S,L=0;L<F;L++){if(de.nodeType===8&&de.data===Or){o=de,n=!0,Xt(!1);break}var q=b[L],H=s(q,L);S=Ws(de,c,I,null,q,H,L,i,e,t),c.items.set(H,S),I=S}F>0&&Pt(Ls())}G||Ii(b,c,o,i,e,s,t),l!==null&&(F===0?v?Ys(v):v=Qs(()=>l(o)):v!==null&&Dr(v,()=>{v=null})),n&&Xt(!0),h(C)}),G&&(o=de)}function Ii(r,e,t,s,i,l,o){var c=r.length,u=e.items,v=e.first,d=v,C,b=null,F=[],n=[],k,I,S,L;for(L=0;L<c;L+=1){if(k=r[L],I=l(k,L),S=u.get(I),S===void 0){var q=d?d.e.nodes_start:t;b=Ws(q,e,b,b===null?e.first:b.next,k,I,L,s,i,o),u.set(I,b),F=[],n=[],d=b.next;continue}if(_i(S,k,L),(S.e.f&Jt)!==0&&Ys(S.e),S!==d){if(C!==void 0&&C.has(S)){if(F.length<n.length){var H=n[0],B;b=H.prev;var $=F[0],M=F[F.length-1];for(B=0;B<F.length;B+=1)Hs(F[B],H,t);for(B=0;B<n.length;B+=1)C.delete(n[B]);ae(e,$.prev,M.next),ae(e,b,$),ae(e,M,H),d=H,b=M,L-=1,F=[],n=[]}else C.delete(S),Hs(S,d,t),ae(e,S.prev,S.next),ae(e,S,b===null?e.first:b.next),ae(e,b,S),b=S;continue}for(F=[],n=[];d!==null&&d.k!==I;)(d.e.f&Jt)===0&&(C??(C=new Set)).add(d),n.push(d),d=d.next;if(d===null)continue;S=d}F.push(S),b=S,d=S.next}if(d!==null||C!==void 0){for(var P=C===void 0?[]:Gs(C);d!==null;)(d.e.f&Jt)===0&&P.push(d),d=d.next;var D=P.length;if(D>0){var X=c===0?t:null;bi(e,P,X,u)}}ke.first=e.first&&e.first.e,ke.last=b&&b.e}function _i(r,e,t,s){Ur(r.v,e),r.i=t}function Ws(r,e,t,s,i,l,o,c,u,v){var d=(u&qr)!==0,C=(u&Vr)===0,b=d?C?Br(i):As(i):i,F=(u&Nr)===0?o:As(o),n={i:F,v:b,k:l,a:null,e:null,prev:t,next:s};try{return n.e=Qs(()=>c(r,b,F,v),G),n.e.prev=t&&t.e,n.e.next=s&&s.e,t===null?e.first=n:(t.next=n,t.e.next=n.e),s!==null&&(s.prev=n,s.e.prev=n.e),n}finally{}}function Hs(r,e,t){for(var s=r.next?r.next.e.nodes_start:t,i=e?e.e.nodes_start:t,l=r.e.nodes_start;l!==s;){var o=Xs(l);i.before(l),l=o}}function ae(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function Si(r,e,t=!1,s=!1,i=!1){var l=r,o="";Q(()=>{var c=ke;if(o===(o=e()??"")){G&&ts();return}if(c.nodes_start!==null&&(Yr(c.nodes_start,c.nodes_end),c.nodes_start=c.nodes_end=null),o!==""){if(G){de.data;for(var u=ts(),v=u;u!==null&&(u.nodeType!==8||u.data!=="");)v=u,u=Xs(u);if(u===null)throw Qr(),Gr;Fs(de,v),l=Pt(u);return}var d=o+"";t?d=`<svg>${d}</svg>`:s&&(d=`<math>${d}</math>`);var C=Fr(d);if((t||s)&&(C=pe(C)),Fs(pe(C),C.lastChild),t||s)for(;pe(C);)l.before(pe(C));else l.before(C)}})}const js=[...` 	
\r\f \v\uFEFF`];function xi(r,e,t){var s=r==null?"":""+r;if(e&&(s=s?s+" "+e:e),t){for(var i in t)if(t[i])s=s?s+" "+i:i;else if(s.length)for(var l=i.length,o=0;(o=s.indexOf(i,o))>=0;){var c=o+l;(o===0||js.includes(s[o-1]))&&(c===s.length||js.includes(s[c]))?s=(o===0?"":s.substring(0,o))+s.substring(c+1):o=c}}return s===""?null:s}function O(r,e,t,s,i,l){var o=r.__className;if(G||o!==t||o===void 0){var c=xi(t,s,l);(!G||c!==r.getAttribute("class"))&&(c==null?r.removeAttribute("class"):e?r.className=c:r.setAttribute("class",c)),r.__className=t}else if(l&&i!==l)for(var u in l){var v=!!l[u];(i==null||v!==!!i[u])&&r.classList.toggle(u,v)}return l}const Ci=Symbol("is custom element"),Ti=Symbol("is html");function Kt(r){if(G){var e=!1,t=()=>{if(!e){if(e=!0,r.hasAttribute("value")){var s=r.value;Z(r,"value",null),r.value=s}if(r.hasAttribute("checked")){var i=r.checked;Z(r,"checked",null),r.checked=i}}};r.__on_r=t,Xr(t),fi()}}function Mi(r,e){var t=Zs(r);t.checked!==(t.checked=e??void 0)&&(r.checked=e)}function Fi(r,e){e?r.hasAttribute("selected")||r.setAttribute("selected",""):r.removeAttribute("selected")}function Z(r,e,t,s){var i=Zs(r);G&&(i[e]=r.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&r.nodeName==="LINK")||i[e]!==(i[e]=t)&&(e==="loading"&&(r[Jr]=t),t==null?r.removeAttribute(e):typeof t!="string"&&Li(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function Zs(r){return r.__attributes??(r.__attributes={[Ci]:r.nodeName.includes("-"),[Ti]:r.namespaceURI===Kr})}var $s=new Map;function Li(r){var e=$s.get(r.nodeName);if(e)return e;$s.set(r.nodeName,e=[]);for(var t,s=r,i=Element.prototype;i!==s;){t=Zr(s);for(var l in t)t[l].set&&e.push(l);s=Wr(s)}return e}const Ai=()=>performance.now(),se={tick:r=>requestAnimationFrame(r),now:()=>Ai(),tasks:new Set};function er(){const r=se.now();se.tasks.forEach(e=>{e.c(r)||(se.tasks.delete(e),e.f())}),se.tasks.size!==0&&se.tick(er)}function Ei(r){let e;return se.tasks.size===0&&se.tick(er),{promise:new Promise(t=>{se.tasks.add(e={c:r,f:t})}),abort(){se.tasks.delete(e)}}}function Lt(r,e){yi(()=>{r.dispatchEvent(new CustomEvent(e))})}function Pi(r){if(r==="float")return"cssFloat";if(r==="offset")return"cssOffset";if(r.startsWith("--"))return r;const e=r.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function zs(r){const e={},t=r.split(";");for(const s of t){const[i,l]=s.split(":");if(!i||l===void 0)break;const o=Pi(i.trim());e[o]=l.trim()}return e}const Oi=r=>r;function At(r,e,t,s){var i=(r&ri)!==0,l="both",o,c=e.inert,u=e.style.overflow,v,d;function C(){var I=oi,S=ke;Es(null),Ps(null);try{return o??(o=t()(e,(s==null?void 0:s())??{},{direction:l}))}finally{Es(I),Ps(S)}}var b={is_global:i,in(){e.inert=c,Lt(e,"introstart"),v=ss(e,C(),d,1,()=>{Lt(e,"introend"),v==null||v.abort(),v=o=void 0,e.style.overflow=u})},out(I){e.inert=!0,Lt(e,"outrostart"),d=ss(e,C(),v,0,()=>{Lt(e,"outroend"),I==null||I()})},stop:()=>{v==null||v.abort(),d==null||d.abort()}},F=ke;if((F.transitions??(F.transitions=[])).push(b),mi){var n=i;if(!n){for(var k=F.parent;k&&(k.f&ei)!==0;)for(;(k=k.parent)&&(k.f&ti)===0;);n=!k||(k.f&si)!==0}n&&rs(()=>{Js(()=>b.in())})}}function ss(r,e,t,s,i){var l=s===1;if(ii(e)){var o,c=!1;return ai(()=>{if(!c){var I=e({direction:l?"in":"out"});o=ss(r,I,t,s,i)}}),{abort:()=>{c=!0,o==null||o.abort()},deactivate:()=>o.deactivate(),reset:()=>o.reset(),t:()=>o.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return i(),{abort:ye,deactivate:ye,reset:ye,t:()=>s};const{delay:u=0,css:v,tick:d,easing:C=Oi}=e;var b=[];if(l&&t===void 0&&(d&&d(0,1),v)){var F=zs(v(0,1));b.push(F,F)}var n=()=>1-s,k=r.animate(b,{duration:u});return k.onfinish=()=>{var I=(t==null?void 0:t.t())??1-s;t==null||t.abort();var S=s-I,L=e.duration*Math.abs(S),q=[];if(L>0){var H=!1;if(v)for(var B=Math.ceil(L/16.666666666666668),$=0;$<=B;$+=1){var M=I+S*C($/B),P=zs(v(M,1-M));q.push(P),H||(H=P.overflow==="hidden")}H&&(r.style.overflow="hidden"),n=()=>{var D=k.currentTime;return I+S*C(D/L)},d&&Ei(()=>{if(k.playState!=="running")return!1;var D=n();return d(D,1-D),!0})}k=r.animate(q,{duration:L,fill:"forwards"}),k.onfinish=()=>{n=()=>s,d==null||d(s,1-s),i()}},{abort:()=>{k&&(k.cancel(),k.effect=null,k.onfinish=ye)},deactivate:()=>{i=ye},reset:()=>{s===0&&(d==null||d(1,0))},t:()=>n()}}function qs(r,e,t=e){var s=li();Ks(r,"input",i=>{var l=i?r.defaultValue:r.value;if(l=Wt(r)?Zt(l):l,t(l),s&&l!==(l=e())){var o=r.selectionStart,c=r.selectionEnd;r.value=l??"",c!==null&&(r.selectionStart=o,r.selectionEnd=Math.min(c,r.value.length))}}),(G&&r.defaultValue!==r.value||Js(e)==null&&r.value)&&t(Wt(r)?Zt(r.value):r.value),ni(()=>{var i=e();Wt(r)&&i===Zt(r.value)||r.type==="date"&&!i&&!r.value||i!==r.value&&(r.value=i??"")})}function Wt(r){var e=r.type;return e==="number"||e==="range"}function Zt(r){return r===""?null:+r}function tr(r,e,t){if(r.multiple)return Ri(r,e);for(var s of r.options){var i=we(s);if(di(i,e)){s.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function Di(r,e){rs(()=>{var t=new MutationObserver(()=>{var s=r.__value;tr(r,s)});return t.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function Vs(r,e,t=e){var s=!0;Ks(r,"change",i=>{var l=i?"[selected]":":checked",o;if(r.multiple)o=[].map.call(r.querySelectorAll(l),we);else{var c=r.querySelector(l)??r.querySelector("option:not([disabled])");o=c&&we(c)}t(o)}),rs(()=>{var i=e();if(tr(r,i,s),s&&i===void 0){var l=r.querySelector(":checked");l!==null&&(i=we(l),t(i))}r.__value=i,s=!1}),Di(r)}function Ri(r,e){for(var t of r.options)t.selected=~e.indexOf(we(t))}function we(r){return"__value"in r?r.__value:r.value}const Bi=r=>r;function Et(r,{delay:e=0,duration:t=400,easing:s=Bi}={}){const i=+getComputedStyle(r).opacity;return{delay:e,duration:t,easing:s,css:l=>`opacity: ${l*i}`}}const te="favourites",K="liked",E="bijukaru",es="thisiscolossal";var be,Ie,_e,Se,xe,Ce,Te,Me,Fe,Le,Ae,Ee,Pe,Oe,De,Re,Be,Ne,Ue,He,je,$e,ze,qe,Ve,Ye,Qe,Ge,Xe,Je,Ke,We,Ze,et,tt,st,rt,it,at,ot,lt,nt,dt,ct,ut,ht,gt,vt,ft,mt,yt,pt,wt,kt,bt,It,_t;class Ni{constructor(){y(this,be,p(!0));y(this,Ie,p(null));y(this,_e,p(ie([])));y(this,Se,p(0));y(this,xe,p(null));y(this,Ce,p(1e4));y(this,Te,p(1e4));y(this,Me,p(!1));y(this,Fe,p(!1));y(this,Le,p("next"));y(this,Ae,p(!0));y(this,Ee,p(""));y(this,Pe,p(!1));y(this,Oe,p(!1));y(this,De,p(null));y(this,Re,p(null));y(this,Be,p(ie([])));y(this,Ne,p(0));y(this,Ue,p(null));y(this,He,p(ie(new Set)));y(this,je,p(2));y(this,$e,p(ie([])));y(this,ze,p(es));y(this,qe,p(!1));y(this,Ve,p(!1));y(this,Ye,p(null));y(this,Qe,p(null));y(this,Ge,p(300));y(this,Xe,p(!1));y(this,Je,p(!1));y(this,Ke,p(!1));y(this,We,p(""));y(this,Ze,p(null));y(this,et,p(null));y(this,tt,p(0));y(this,st,p(0));y(this,rt,p(ie(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))));y(this,it,p(""));y(this,at,p(!1));y(this,ot,p(""));y(this,lt,p(!1));y(this,nt,p(null));y(this,dt,p(""));y(this,ct,p(!1));y(this,ut,p(null));y(this,ht,p(null));y(this,gt,p(null));y(this,vt,p(null));y(this,ft,p(null));y(this,mt,p(void 0));y(this,yt,p(ie(new Map)));y(this,pt,p(!1));y(this,wt,p(ie([])));y(this,kt,p(!1));y(this,bt,p(null));y(this,It,p(null));y(this,_t,p(ie([])));m(this,"init",async()=>{this.applyTheme(),this.loadFavourites(),this.loadArchivedCuratedFeeds(),this.selectedMediaSource===E&&await this.loadCategories(),this.mouseX=0,this.mouseY=0,document.addEventListener("mousemove",n=>{this.mouseX=n.clientX,this.mouseY=n.clientY,document.querySelectorAll(".nav-button").forEach(I=>{I.classList.add("visible")}),this.resetInactivityTimer()});const e=new URLSearchParams(window.location.search),t=localStorage.getItem("bijukaru_message");t&&(this.showUrlMessage(t),localStorage.removeItem("bijukaru_message"));const s=e.get("message");if(s){this.showUrlMessage(decodeURIComponent(s)),e.delete("message");const n=window.location.pathname+(e.toString()?"?"+e.toString():"");Bs(n.toString(),{})}await this.loadMediaSources();const i=e.get("media_source");i&&(this.selectedMediaSource=i),await this.loadCategories();const l=e.get("category");if(l)this.selectedCategory=l,this.categoryIndex=Math.max(0,this.categories.findIndex(n=>n.id===l));else if(this.categories.length>0&&this.categories[0].id){this.selectedCategory=this.categories[0].id,this.categoryIndex=0;const n=new URL(window.location.href);n.searchParams.set("category",this.selectedCategory),Bs(n.toString(),{})}this.targetImageId=e.get("image_id");const o=e.get("interval");if(o&&!isNaN(Number(o))){const n=parseInt(o);this.slideInterval=n>0?n*1e3:0,this.originalInterval=this.slideInterval}const c=e.get("paused");(c==="true"||c==="1")&&(this.isPaused=!0,this.originalInterval=this.slideInterval,this.slideInterval=0);const u=e.get("hd");(u==="true"||u==="1")&&(this.isHD=!0);const v=e.get("prefetch");v&&!isNaN(Number(v))&&(this.nToPrefetch=Math.min(10,Math.max(0,parseInt(v))));const d=e.get("fullscreen");(d==="true"||d==="1")&&(this.hideToolbar=!0);const C=e.get("showDescription");(C==="true"||C==="1")&&(this.showDescription=!0),document.addEventListener("keydown",n=>{if(this.showSearchOverlay){n.key==="Escape"&&this.closeSearchOverlay();return}this.handleKeyDown(n)});const b=document.querySelector(".gallery-image");b&&(b.addEventListener("touchstart",()=>{this.mediaSourceOverlayTimeoutId&&clearTimeout(this.mediaSourceOverlayTimeoutId),this.mediaSourceOverlayTransitionId&&clearTimeout(this.mediaSourceOverlayTransitionId),this.showMediaSourceOverlay=!1,this.showControls(),this.resetInactivityTimer()}),b.addEventListener("click",()=>{this.resetInactivityTimer()}),b.addEventListener("mouseenter",()=>{this.showControls()}),b.addEventListener("mouseleave",n=>{const I=n.relatedTarget;I&&(I.classList.contains("category-nav-button")||I.closest(".category-nav-button"))||setTimeout(this.hideControls,1e3)}),b.addEventListener("touchstart",()=>{this.isPaused||(this.wasPlayingBeforeTouch=!0,this.togglePause())}),b.addEventListener("touchend",()=>{this.wasPlayingBeforeTouch&&(this.wasPlayingBeforeTouch=!1,this.togglePause())})),document.querySelectorAll(".category-nav-button").forEach(n=>{n.addEventListener("mouseenter",()=>{this.showControls()}),n.addEventListener("mouseleave",k=>{const S=k.relatedTarget;S&&(S.classList.contains("category-nav-button")||S.classList.contains("nav-button")||S.closest(".nav-button")||S.closest(".category-nav-button"))||setTimeout(this.hideControls,1e3)})}),await this.loadCategory();const F=e.get("token");if(F)this.verifyAndStoreToken(F);else{const n=localStorage.getItem("searchToken");n&&(this.searchToken=n,this.verifyToken(!1))}this.loadLikedImages(),this.loadArchivedCuratedFeeds()});m(this,"handleImageError",e=>{e.target.src="https://placehold.co/600x400?text=Image+Not+Available"});m(this,"updateDocumentTitle",()=>{let e="Bijukaru picture carousel";const t=this.mediaSources.find(s=>s.id===this.selectedMediaSource);t&&(e=`${t.name} - ${e}`),this.showFavourites?e=`⭐ Favourites - ${e}`:this.showLikedImages?e=`❤️ Liked Images - ${e}`:this.currentItem&&(e=`${this.currentItem.title} - ${e}`),document.title=e});m(this,"updateURL",()=>{var e,t;try{const s=new URL(window.location.href);s.searchParams.set("media_source",this.selectedMediaSource),!this.showFavourites&&this.selectedCategory?s.searchParams.set("category",this.selectedCategory):s.searchParams.delete("category"),(e=this.currentItem)!=null&&e.id?s.searchParams.set("image_id",this.currentItem.id):s.searchParams.delete("image_id"),this.slideInterval!==1e4?s.searchParams.set("interval",String(this.slideInterval/1e3)):s.searchParams.delete("interval"),this.isHD?s.searchParams.set("hd","true"):s.searchParams.delete("hd"),this.hideToolbar?s.searchParams.set("fullscreen","true"):s.searchParams.delete("fullscreen"),this.showDescription?s.searchParams.set("showDescription","true"):s.searchParams.delete("showDescription"),Ns(s.toString(),{mediaSource:this.selectedMediaSource,category:this.selectedCategory,imageId:(t=this.currentItem)==null?void 0:t.id})}catch(s){console.error("Error updating URL:",s)}});m(this,"getPrevCategoryName",()=>{var t;if(this.categories.length===0)return"";const e=(this.categoryIndex-1+this.categories.length)%this.categories.length;return((t=this.categories[e])==null?void 0:t.name)||""});m(this,"getNextCategoryName",()=>{var t;if(this.categories.length===0)return"";const e=(this.categoryIndex+1)%this.categories.length;return((t=this.categories[e])==null?void 0:t.name)||""});m(this,"getCurrentCategoryName",()=>{var t;if(this.showFavourites&&((t=this.currentItem)!=null&&t.sourceCategory))return this.currentItem.sourceCategory;if(this.category)return this.category.name;if(!this.selectedCategory||this.categories.length===0)return"";const e=this.categories.find(s=>s.id===this.selectedCategory);return e?e.name:""});m(this,"nextItem",()=>{this.direction="next",this.currentIndex=(this.currentIndex+1)%this.items.length,document.querySelectorAll(".category-nav-button").forEach(t=>{t.classList.remove("visible")}),this.showMediaSourceOverlay=!1,this.updateDocumentTitle(),this.updateURL(),this.prefetchNextImages(),this.stopAutoSlide(),this.startAutoSlide()});m(this,"prevItem",()=>{this.stopAutoSlide(),this.direction="prev",this.currentIndex=(this.currentIndex-1+this.items.length)%this.items.length,document.querySelectorAll(".category-nav-button").forEach(t=>{t.classList.remove("visible")}),this.showMediaSourceOverlay=!1,this.updateDocumentTitle(),this.updateURL(),this.prefetchNextImages(),this.startAutoSlide()});m(this,"startAutoSlide",()=>{if(this.autoSlideIntervalId&&(clearInterval(this.autoSlideIntervalId),this.autoSlideIntervalId=null),this.isPaused||this.slideInterval===0){this.progressBar&&(this.progressBar.style.width="0%",this.progressAnimation&&(cancelAnimationFrame(this.progressAnimation),this.progressAnimation=null));return}this.autoSlideIntervalId=setInterval(()=>{this.nextItem()},this.slideInterval),this.animateProgressBar()});m(this,"stopAutoSlide",()=>{this.autoSlideIntervalId&&(clearInterval(this.autoSlideIntervalId),this.autoSlideIntervalId=null),this.progressBar&&(this.progressBar.style.width="0%",this.progressAnimation&&(cancelAnimationFrame(this.progressAnimation),this.progressAnimation=null))});m(this,"animateProgressBar",()=>{if(this.progressBar){if(this.progressBar.style.width="0%",this.slideInterval===0)return;this.progressAnimation&&(cancelAnimationFrame(this.progressAnimation),this.progressAnimation=null);const e=performance.now(),t=this.slideInterval,s=i=>{const l=i-e,o=Math.min(l/t*100,100);this.progressBar&&(this.progressBar.style.width=`${o}%`),l<t&&(this.progressAnimation=requestAnimationFrame(s))};this.progressAnimation=requestAnimationFrame(s)}});m(this,"togglePause",()=>{this.isPaused=!this.isPaused,this.isPaused?(this.slideInterval>0&&(this.originalInterval=this.slideInterval),this.stopAutoSlide(),this.slideInterval=0):(this.slideInterval=this.originalInterval>0?this.originalInterval:1e4,this.startAutoSlide()),this.updateURL()});m(this,"toggleFullscreen",()=>{document.fullscreenElement?this.exitFullscreen():document.documentElement.requestFullscreen().then(()=>{this.isFullscreen=!0,this.hideToolbar=!0}).catch(e=>{console.error("Failed to enter fullscreen mode:",e),this.hideToolbar=!0}),this.updateURL()});m(this,"exitFullscreen",()=>{if(document.fullscreenElement&&document.exitFullscreen)try{document.exitFullscreen().then(()=>{this.isFullscreen=!1}).catch(e=>{console.error("Failed to exit fullscreen mode:",e),this.isFullscreen=!1})}catch(e){console.error("Error exiting fullscreen:",e),this.isFullscreen=!1}this.hideToolbar=!1,this.updateURL()});m(this,"prefetchNextImages",()=>{this.prefetchDebounceTimerId&&clearTimeout(this.prefetchDebounceTimerId),this.prefetchDebounceTimerId=setTimeout(()=>{if(this.items.length)for(let e=1;e<=this.nToPrefetch;e++){const t=(this.currentIndex+e)%this.items.length,s=this.items[t];if(s&&s.image_url&&!this.prefetchedImages.has(s.image_url)){const i=new Image;i.src=s.image_url,this.prefetchedImages.add(s.image_url),console.log("Prefetched image:",s.image_url)}}},this.prefetchDebounceDelay)});m(this,"toggleDarkMode",()=>{this.darkMode=!this.darkMode,this.applyTheme(!1),localStorage.setItem("darkMode",String(this.darkMode))});m(this,"applyTheme",(e=!0)=>{if(e){const t=localStorage.getItem("darkMode");t!==null&&(this.darkMode=t==="true")}this.darkMode?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")});m(this,"showControls",()=>{const e=document.querySelector(".exit-fullscreen-btn"),t=document.querySelectorAll(".nav-button");console.log("showControls called, found buttons:",t.length),this.isFullscreen&&e&&e.classList.add("visible"),t.forEach(s=>{s.classList.add("visible")}),this.resetInactivityTimer()});m(this,"hideControls",()=>{const e=document.querySelector(".exit-fullscreen-btn"),t=document.querySelectorAll(".nav-button");Array.from(t).some(i=>{const l=i.getBoundingClientRect(),o=this.mouseX,c=this.mouseY;return o>=l.left&&o<=l.right&&c>=l.top&&c<=l.bottom})||(e&&e.classList.remove("visible"),t.forEach(i=>{i.classList.remove("visible")}))});m(this,"resetInactivityTimer",()=>{this.inactivityTimeoutId&&clearTimeout(this.inactivityTimeoutId),this.inactivityTimeoutId=setTimeout(()=>{this.hideControls()},1e3)});m(this,"loadCategories",async()=>{this.error=null,this.loading=!0;try{if(this.selectedMediaSource===E){const e=[{id:te,name:"Favourites"},{id:K,name:"Liked Images"},...this.archivedCuratedFeeds.map(t=>({id:t.id,name:t.name}))];this.categories=e,!this.showFavourites&&!this.showLikedImages&&(!this.selectedCategory||!e.find(t=>t.id===this.selectedCategory))?this.selectedCategory=te:this.showFavourites?this.selectedCategory=te:this.showLikedImages&&(this.selectedCategory=K),this.categoryIndex=Math.max(0,this.categories.findIndex(t=>t.id===this.selectedCategory)),this.category=this.categories[this.categoryIndex]}else{const e=await fetch(`/api/${this.selectedMediaSource}/categories`);if(!e.ok)throw new Error("Failed to fetch categories");this.categories=await e.json(),this.categories.length>0&&(!this.selectedCategory||!this.categories.find(t=>t.id===this.selectedCategory))&&(this.selectedCategory=this.categories[0].id,this.categoryIndex=0,this.category=this.categories[0])}}catch(e){console.error("Error loading categories:",e),this.error=e.message||"Error loading categories",this.categories=[{id:"",name:"Error"}]}finally{this.loading=!1}});m(this,"loadCategory",async()=>{var e;if(this.error=null,this.selectedMediaSource===E){if(this.selectedCategory===te)return this.showFavourites=!0,this.showLikedImages=!1,this.loadAllFavourites();if(this.selectedCategory===K)return this.showLikedImages=!0,this.showFavourites=!1,this.loadLikedImagesView();if(this.showLikedImages=!1,this.showFavourites=!1,this.items.length===0&&((e=this.category)==null?void 0:e.id)===this.selectedCategory){const t=this.archivedCuratedFeeds.find(s=>s.id===this.selectedCategory);if(t)return console.log(`Reloading curated feed: ${t.name}`),this._loadSpecificCuratedFeed(t);console.warn(`Selected category ${this.selectedCategory} looks like a curated feed ID, but not found in archive.`),this.error=`Cannot load curated feed: ${this.selectedCategory}`,this.loading=!1;return}else if(this.selectedMediaSource===E&&![te,K].includes(this.selectedCategory)){this.showLikedImages=!1,this.showFavourites=!1;const t=this.archivedCuratedFeeds.find(s=>s.id===this.selectedCategory);if(t){console.log(`Loading archived curated feed: ${t.name}`),this._loadSpecificCuratedFeed(t);return}else{console.warn(`Selected category ${this.selectedCategory} not found in archived feeds.`),this.error=`Could not load archived feed: ${this.selectedCategory}`,this.items=[],this.loading=!1;return}}}else this.showFavourites=!1,this.showLikedImages=!1;this.loading=!0,this.stopAutoSlide(),this.prefetchedImages.clear(),this.progressBar&&(this.progressBar.style.width="0%"),this.selectedCategory||(this.selectedCategory=this.categories[0].id);try{let t=`/api/${this.selectedMediaSource}/feed`;this.selectedCategory&&(t+=`?category=${this.selectedCategory}`),this.isHD&&(t+=(t.includes("?")?"&":"?")+"hd=true");const s=await fetch(t);if(!s.ok)throw new Error("Failed to fetch RSS feed");const i=await s.json();if(this.items=i.items,this.category=i.category,["apod","reddit"].includes(this.selectedMediaSource)||this.shuffleArray(this.items),this.currentIndex=0,this.targetImageId&&this.items.length>0){const l=this.items.findIndex(o=>o.id===this.targetImageId);l!==-1&&(this.currentIndex=l),this.targetImageId=null}this.items.length===0?this.error="No images found in the feed":(this.showTemporaryMediaSourceOverlay(),this.updateDocumentTitle(),this.updateURL(),this.prefetchNextImages(),this.startAutoSlide())}catch(t){console.error("Error:",t),this.error="Failed to load gallery. Please try again later."}finally{this.loading=!1}});m(this,"showTemporaryMediaSourceOverlay",()=>{var e;this.isMobile||(this.mediaSourceOverlayTimeoutId&&clearTimeout(this.mediaSourceOverlayTimeoutId),this.mediaSourceOverlayTransitionId&&clearTimeout(this.mediaSourceOverlayTransitionId),(e=this.mediaSources.find(t=>t.id===this.selectedMediaSource))==null||e.name,this.getCurrentCategoryName(),this.mediaSourceOverlayText=`

                    `,this.showMediaSourceOverlay=!0,this.mediaSourceOverlayTimeoutId=setTimeout(()=>{this.mediaSourceOverlayTransitionId=setTimeout(()=>{this.showMediaSourceOverlay=!1},300)},2e3))});m(this,"shuffleArray",e=>{for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e});m(this,"handleKeyDown",e=>{if(this.showSearchOverlay||document.activeElement&&["input","textarea","select"].includes(document.activeElement.tagName.toLowerCase())){e.key==="Escape"&&this.showSearchOverlay&&(this.closeSearchOverlay(),e.preventDefault(),e.stopPropagation());return}if(this.showHelp&&e.key==="Escape"){this.showHelp=!1,e.preventDefault(),e.stopPropagation();return}switch(e.key){case"ArrowRight":this.nextItem();break;case"ArrowLeft":this.prevItem();break;case"Enter":this.currentItem&&this.currentItem.link&&window.open(this.currentItem.link,"_blank");break;case"ArrowUp":this.prevCategory();break;case"ArrowDown":this.nextCategory();break;case"PageUp":this.prevMediaSource();break;case"PageDown":this.nextMediaSource();break;case"h":case"H":this.showHelp=!this.showHelp;break;case"p":case"P":this.togglePause();break;case"f":case"F":this.toggleFullscreen();break;case"d":case"D":this.showDescription=!this.showDescription;break;case"Escape":this.exitFullscreen();break;case"/":this.isSearchAuthorized&&(this.openSearchOverlay(),e.preventDefault());break;case"s":case"S":this.toggleFavourite();break;case"l":case"L":this.toggleLikeImage();break}});m(this,"prevCategory",()=>{if(this.categories.length===0)return"";this.categoryIndex=(this.categoryIndex-1+this.categories.length)%this.categories.length,this.selectedCategory=this.categories[this.categoryIndex].id,this.loadCategory()});m(this,"nextCategory",()=>{if(this.categories.length===0)return"";this.categoryIndex=(this.categoryIndex+1)%this.categories.length,this.selectedCategory=this.categories[this.categoryIndex].id,this.loadCategory()});m(this,"showUrlMessage",e=>{this.overlayMessage=e,this.showMessageOverlay=!0,setTimeout(()=>{this.showMessageOverlay=!1},5e3)});m(this,"loadMediaSources",async()=>{var e,t,s;this.loading=!0,this.error=null;try{const i=await fetch("/api/media_sources");if(!i.ok)throw new Error(`Failed to load media sources: ${i.statusText}`);const l=await i.json();this.mediaSources=[...l,{id:E,name:"All Sources",hdSupported:!0}];const c=new URLSearchParams(window.location.search).get("media_source");if(c&&this.mediaSources.find(u=>u.id===c))this.selectedMediaSource=c;else if(this.mediaSources.length>0&&!this.mediaSources.find(u=>u.id===this.selectedMediaSource)){const u=this.mediaSources.find(v=>v.id==es);this.selectedMediaSource=u?u.id:((e=this.mediaSources[0])==null?void 0:e.id)||""}else if(this.mediaSources.length>0&&this.selectedMediaSource===E&&!c){const u=this.mediaSources.find(v=>v.id==es);this.selectedMediaSource=u?u.id:((t=this.mediaSources[0])==null?void 0:t.id)||""}this.hdSupported=((s=this.mediaSources.find(u=>u.id===this.selectedMediaSource))==null?void 0:s.hdSupported)||!1}catch(i){this.error=i.message,this.mediaSources=[{id:E,name:"All Sources",hdSupported:!0}]}finally{this.loading=!1}});m(this,"verifyAndStoreToken",async e=>{if(this.searchToken=e,await this.verifyToken(!0),this.isSearchAuthorized){localStorage.setItem("searchToken",e);const t=new URL(window.location.href);t.searchParams.delete("token"),window.history.replaceState({},"",t),this.overlayMessage="Search feature unlocked!",this.showMessageOverlay=!0,setTimeout(()=>{this.showMessageOverlay=!1},3e3)}});m(this,"verifyToken",async(e=!0)=>{if(!this.searchToken)return e&&(this.tokenError="Token is required"),!1;try{const t=await fetch(`/api/verify_token?token=${encodeURIComponent(this.searchToken)}`),s=await t.json();return t.ok&&s.authorized?(this.isSearchAuthorized=!0,this.tokenError=null,!0):(this.isSearchAuthorized=!1,e&&(this.tokenError=s.error||"Invalid token"),!1)}catch(t){return console.error("Token verification error:",t),this.isSearchAuthorized=!1,e&&(this.tokenError="Failed to verify token"),!1}});m(this,"openSearchOverlay",()=>{this.showSearchOverlay=!0,this.error=null,this.tokenError=null,setTimeout(()=>{const e=document.getElementById("search-input"),t=document.getElementById("token-input");this.isSearchAuthorized&&e?e.focus():t&&t.focus()},0)});m(this,"closeSearchOverlay",()=>{this.showSearchOverlay=!1,this.searchQuery="",this.error=null,this.tokenError=null});m(this,"nextMediaSource",()=>{if(this.mediaSources.length<=1)return;const t=(this.mediaSources.findIndex(s=>s.id===this.selectedMediaSource)+1)%this.mediaSources.length;this.selectedMediaSource=this.mediaSources[t].id,this.changeMediaSource()});m(this,"prevMediaSource",()=>{if(this.mediaSources.length<=1)return;const t=(this.mediaSources.findIndex(s=>s.id===this.selectedMediaSource)-1+this.mediaSources.length)%this.mediaSources.length;this.selectedMediaSource=this.mediaSources[t].id,this.changeMediaSource()});m(this,"performSearch",async()=>{if(!(!this.isSearchAuthorized&&!await this.verifyToken())&&this.searchQuery.trim()){this.loading=!0,this.error=null;try{const t=["story","narrative","curate","tell me about","life of","teach me about"].some(c=>this.searchQuery.toLowerCase().includes(c)),s=localStorage.getItem("searchToken")||this.searchToken;let i;t?(console.log("Performing curation query..."),i=`/api/curate?query=${encodeURIComponent(this.searchQuery)}&token=${encodeURIComponent(s)}`):(console.log("Performing standard search query..."),i=`/api/search?query=${encodeURIComponent(this.searchQuery)}&token=${encodeURIComponent(s)}`);const l=await fetch(i),o=await l.json();if(!l.ok)throw new Error(o.error||`HTTP error ${l.status}`);if(this.closeSearchOverlay(),t)if(console.log("Received curated feed:",o),o.items&&o.category){this.selectedMediaSource!==E&&(this.previousSelectedMediaSource=this.selectedMediaSource,this.previousSelectedCategory=this.selectedCategory),this.selectedMediaSource=E,this.items=o.items;const c=this.searchQuery,u={id:o.category.id,name:o.category.name};this.category=u,this.categories=[u],this.categoryIndex=0;const v=this.archivedCuratedFeeds.findIndex(C=>C.id===u.id),d={id:u.id,name:u.name,originalQuery:c,items:o.items,userfriendly_message:o.userfriendly_message};v>-1?this.archivedCuratedFeeds[v]=d:this.archivedCuratedFeeds.push(d),this.archivedCuratedFeeds=[...this.archivedCuratedFeeds],this.saveArchivedCuratedFeeds(),this.selectedCategory=u.id,this.showFavourites=!1,this.showLikedImages=!1,this.currentIndex=0,this.items.length===0?this.error="Curated feed is empty.":this.error=null,this.updateProgressBar(),o.userfriendly_message&&this.showUrlMessage(o.userfriendly_message),o.llm_thinking&&console.log("LLM Thinking:",o.llm_thinking),this.updateURL(),this.updateDocumentTitle(),this.prefetchNextImages(),this.startAutoSlide()}else throw new Error("Invalid curated feed response from server.");else if(console.log("Search successful, received URL:",o.url),o.url)o.userfriendly_message&&localStorage.setItem("bijukaru_message",o.userfriendly_message),window.location.href=o.url;else throw new Error("Invalid search response from server.")}catch(e){console.error("Search/Curation error:",e),this.error=e.message||"An error occurred during the search/curation."}finally{this.loading=!1}}});m(this,"changeMediaSource",async e=>{const t=e??this.selectedMediaSource,s=this.selectedMediaSource;if(s===E&&t!==E)if(console.log("Switching FROM custom source TO regular source:",t),this.showFavourites=!1,this.showLikedImages=!1,this.previousSelectedMediaSource&&this.previousSelectedCategory){console.log("Restoring previous state:",this.previousSelectedMediaSource,this.previousSelectedCategory),this.selectedMediaSource=this.previousSelectedMediaSource,this.selectedCategory=this.previousSelectedCategory,this.previousSelectedMediaSource=null,this.previousSelectedCategory=null,await this.loadCategory();return}else console.log("No previous state to restore, proceeding with target:",t),this.selectedMediaSource=t;else if(t===E&&s!==E){console.log("Switching TO custom source FROM regular source:",s),this.previousSelectedMediaSource=s,this.previousSelectedCategory=this.selectedCategory,this.selectedMediaSource=E,this.showFavourites=!1,this.showLikedImages=!1,await this.loadCategories(),await this.loadCategory(),this.updateURL();return}console.log("Proceeding with regular source change or fallthrough:",t),this.selectedMediaSource=t,this.loading=!0,this.error=null;try{const i=new URLSearchParams(window.location.search);i.delete("image_id"),i.delete("category"),i.delete("media_source"),this.selectedCategory="",this.categoryIndex=0,this.targetImageId=null;const l=this.mediaSources.find(u=>u.id===this.selectedMediaSource);this.hdSupported=(l==null?void 0:l.hdSupported)!==void 0?l.hdSupported:!1,this.slideInterval!==1e4&&i.set("interval",String(this.slideInterval/1e3)),this.isHD&&i.set("hd","true"),this.nToPrefetch!==2&&i.set("prefetch",String(this.nToPrefetch)),this.hideToolbar&&i.set("fullscreen","true"),this.showDescription&&i.set("showDescription","true");const o=`/?media_source=${t}&${i.toString()}`;Ns(o,{mediaSource:this.selectedMediaSource});const c=this.mediaSources.find(u=>u.id===this.selectedMediaSource);c&&(document.title=`${c.name} - Bijukaru picture carousel`),await this.loadCategories(),await this.loadCategory(),this.updateURL()}catch(i){console.error("Error changing media source:",i),this.error="Failed to change media source. Please try again later."}finally{this.loading=!1}});m(this,"refreshRandomArtist",()=>{this.selectedCategory==="random-artist"&&this.loadCategory()});m(this,"toggleHD",()=>{var t;const e=(t=this.currentItem)==null?void 0:t.id;this.isHD=!this.isHD,this.loadCategory().then(()=>{if(e){const s=this.items.findIndex(i=>i.id===e);s!==-1&&(this.currentIndex=s,this.updateDocumentTitle(),this.updateURL())}}),this.updateURL()});m(this,"loadFavourites",()=>{try{const e=localStorage.getItem("galleryFavourites");if(e){const t=JSON.parse(e),s=new Map;Object.keys(t).forEach(i=>{s.set(i,new Set(t[i]))}),this.favourites=s}}catch(e){console.error("Error loading favourites:",e)}});m(this,"saveFavourites",()=>{try{const e={};this.favourites.forEach((t,s)=>{e[s]=Array.from(t)}),localStorage.setItem("galleryFavourites",JSON.stringify(e))}catch(e){console.error("Error saving favourites:",e)}});m(this,"toggleFavourite",(e,t)=>{var o,c;const s=t||this.showFavourites&&((o=this.currentItem)==null?void 0:o.media_source)||this.selectedMediaSource,i=e||this.showFavourites&&((c=this.currentItem)==null?void 0:c.category_id)||this.selectedCategory;if(!i||!s){console.warn("ToggleFavourite: category or mediaSource missing",i,s);return}this.favourites.has(s)||this.favourites.set(s,new Set);const l=this.favourites.get(s);if(l.has(i)){if(l.delete(i),this.showUrlMessage("Removed from favourites"),this.showFavourites){const u=i,v=s;if(this.items=this.items.filter(d=>!(d.category_id===u&&d.media_source===v)),this.items.length===0){let d=!0;if(this.favourites.forEach(C=>{C.size>0&&(d=!1)}),d){this.showFavourites=!1,this.showLikedImages=!1;const C=this.mediaSources.find(b=>b.id!==E);C?(this.selectedMediaSource=C.id,this.selectedCategory="",this.previousSelectedMediaSource=null,this.previousSelectedCategory=null,(async()=>(await this.loadCategories(),await this.loadCategory()))()):(this.items=[],this.error="No media sources available to display.",this.loading=!1,this.updateURL(),this.updateDocumentTitle(),this.stopAutoSlide());return}else{this.toggleShowFavourites();return}}else this.currentIndex=Math.max(0,Math.min(this.currentIndex,this.items.length-1)),this.updateDocumentTitle(),this.updateURL(),this.stopAutoSlide(),this.startAutoSlide()}}else l.add(i),this.showUrlMessage("Added to favourites");this.favourites=new Map(this.favourites),this.saveFavourites()});m(this,"isFavourite",(e,t)=>{var l,o;const s=t||this.showFavourites&&((l=this.currentItem)==null?void 0:l.media_source)||this.selectedMediaSource,i=e||this.showFavourites&&((o=this.currentItem)==null?void 0:o.category_id)||this.selectedCategory;return!i||!s?!1:this.favourites.has(s)&&this.favourites.get(s).has(i)});m(this,"loadAllFavourites",async()=>{var t,s;const e=this.showFavourites;this.loading=!0,this.error=null;try{const i=Array.from(this.favourites.keys());if(i.length===0){this.showUrlMessage('No favourite categories found. Add categories to your favourites by pressing "s" key or the star icon.');return}this.showFavourites=!0,this.items=[];let l=[];for(const o of i){let c=[];if(o===E)c=[{id:K,name:"Liked"}],Array.from(this.favourites.get(E)).includes(K)&&(l=[...l,...this.likedImages.map(u=>({...u,sourceCategory:"Bijukaru - Liked",media_source:E,category_id:K}))]);else{try{const v=await fetch(`/api/${o}/categories`);v.ok?c=await v.json():console.warn(`Could not fetch categories for source ${o} during favourite loading. Status: ${v.status}`)}catch(v){console.warn(`Error fetching categories for source ${o} in loadAllFavourites:`,v)}const u=Array.from(this.favourites.get(o));for(const v of u){const d=`/api/${o}/feed?category=${v}${this.isHD?"&hd=true":""}`,C=await fetch(d);if(!C.ok){console.warn(`Failed to load favourites from ${o}/${v}: ${C.statusText}`);continue}const b=await C.json();if(b.items&&Array.isArray(b.items)){const F=((t=this.mediaSources.find(I=>I.id===o))==null?void 0:t.name)||o,n=((s=c.find(I=>I.id===v))==null?void 0:s.name)||v,k=b.items.map(I=>({...I,sourceCategory:`${F} - ${n}`,media_source:o,category_id:v}));l=[...l,...k]}}}}if(l.length===0){this.showUrlMessage('No favourite categories found. Add categories to your favourites by pressing "s" key or the star icon.'),this.showFavourites=e;return}this.items=this.shuffleArray(l),this.currentIndex=0,this.isPaused||this.startAutoSlide(),this.updateDocumentTitle()}catch(i){console.error("Error loading all favourites:",i),this.error=i.message||"Failed to load favourites",this.showFavourites=e}finally{this.loading=!1}});m(this,"toggleShowFavourites",()=>{var t,s;if(!this.showFavourites){if(!(this.favourites.size>0&&Array.from(this.favourites.values()).some(l=>l.size>0))){this.showUrlMessage('No favourite categories found. Add categories to your favourites by pressing "s" key or the star icon.');return}this.selectedMediaSource!==E&&(this.previousSelectedMediaSource=this.selectedMediaSource,this.previousSelectedCategory=this.selectedCategory),this.showFavourites=!0,this.showLikedImages=!1,this.selectedMediaSource=E,this.categories=[{id:te,name:"Favourites"}],this.selectedCategory=te,this.category=this.categories[0],this.categoryIndex=0,this.loadAllFavourites()}else this.showFavourites=!1,this.selectedMediaSource=this.previousSelectedMediaSource||((t=this.mediaSources.find(i=>i.id!==E))==null?void 0:t.id)||((s=this.mediaSources[0])==null?void 0:s.id)||"",this.selectedCategory=this.previousSelectedCategory||"",this.previousSelectedMediaSource=null,this.previousSelectedCategory=null,this.loadCategory();this.updateURL()});m(this,"loadLikedImages",()=>{try{const e=localStorage.getItem("galleryLikedImages");e&&(this.likedImages=JSON.parse(e))}catch(e){console.error("Error loading liked images:",e)}});m(this,"saveLikedImages",()=>{try{localStorage.setItem("galleryLikedImages",JSON.stringify(this.likedImages))}catch(e){console.error("Error saving liked images:",e)}});m(this,"toggleLikeImage",()=>{if(!this.currentItem)return;if(this.isImageLiked())this.likedImages=this.likedImages.filter(t=>{var s;return t.id!==((s=this.currentItem)==null?void 0:s.id)}),this.saveLikedImages(),this.showLikedImages&&(this.items=this.items.filter(t=>{var s;return t.id!==((s=this.currentItem)==null?void 0:s.id)}),this.items.length===0?(this.showLikedImages=!1,this.updateURL(),this.updateDocumentTitle()):this.currentIndex=Math.min(this.currentIndex,this.items.length-1));else if(this.currentItem){const t={...this.currentItem,sourceCategory:this.getCurrentCategoryName(),media_source:this.selectedMediaSource};this.likedImages.push(t),this.saveLikedImages()}});m(this,"isImageLiked",()=>this.currentItem?this.likedImages.some(e=>{var t;return e.id===((t=this.currentItem)==null?void 0:t.id)}):!1);m(this,"loadLikedImagesView",async()=>{const e=this.showLikedImages;this.showLikedImages=!0,this.loading=!0,this.error=null;try{if(this.likedImages.length===0)throw new Error("No liked images found");this.items=[...this.likedImages],this.currentIndex=0,this.isPaused||this.startAutoSlide(),this.updateDocumentTitle()}catch(t){console.error("Error loading liked images:",t),this.error=t.message||"Failed to load liked images",this.showLikedImages=e}finally{this.loading=!1}});m(this,"toggleShowLikedImages",()=>{var t,s;const e=!this.showLikedImages;this.showLikedImages=e,this.showFavourites=!1,e?(this.selectedMediaSource!==E&&(this.previousSelectedMediaSource=this.selectedMediaSource,this.previousSelectedCategory=this.selectedCategory),this.selectedMediaSource=E,this.categories=[{id:K,name:"Liked Images"}],this.selectedCategory=K,this.category=this.categories[0],this.categoryIndex=0,this.loadLikedImagesView()):(this.selectedMediaSource=this.previousSelectedMediaSource||((t=this.mediaSources.find(i=>i.id!==E))==null?void 0:t.id)||((s=this.mediaSources[0])==null?void 0:s.id)||"",this.selectedCategory=this.previousSelectedCategory||"",this.previousSelectedMediaSource=null,this.previousSelectedCategory=null,this.loadCategory()),this.updateURL()});m(this,"updateProgressBar",()=>{this.animateProgressBar()});m(this,"loadArchivedCuratedFeeds",()=>{const e=localStorage.getItem("galleryArchivedCuratedFeeds");if(e)try{this.archivedCuratedFeeds=JSON.parse(e)}catch(t){console.error("Failed to parse archived curated feeds",t)}});m(this,"saveArchivedCuratedFeeds",()=>{localStorage.setItem("galleryArchivedCuratedFeeds",JSON.stringify(this.archivedCuratedFeeds))});m(this,"hasFavourites",()=>this.favourites?this.favourites.size>0:!1);m(this,"hasLikedImages",()=>this.likedImages?this.likedImages.length>0:!1);m(this,"_loadSpecificCuratedFeed",e=>{console.log(`Loading archived curated feed: ${e.name} from stored items.`),this.loading=!0,this.error=null,this.items=[],this.showFavourites=!1,this.showLikedImages=!1;try{if(e.items&&e.id&&e.name){this.items=[...e.items],this.category={id:e.id,name:e.name},this.selectedCategory=this.category.id,this.currentIndex=0,this.items.length===0?this.error="Archived curated feed is empty.":this.error=null;const t=[{id:te,name:"Favourites"},{id:K,name:"Liked Images"},...this.archivedCuratedFeeds.map(s=>({id:s.id,name:s.name}))];this.categories=t,this.categoryIndex=Math.max(0,this.categories.findIndex(s=>s.id===this.selectedCategory)),this.updateProgressBar(),this.updateURL(),this.updateDocumentTitle(),this.prefetchNextImages(),this.startAutoSlide(),e.userfriendly_message&&this.showUrlMessage(e.userfriendly_message)}else throw new Error("Invalid archived curated feed data.")}catch(t){console.error("Error loading archived curated feed:",t),this.error=t.message||"An error occurred while loading the archived curated feed.",this.items=[]}finally{this.loading=!1}})}get loading(){return h(a(this,be))}set loading(e){w(a(this,be),e,!0)}get error(){return h(a(this,Ie))}set error(e){w(a(this,Ie),e,!0)}get items(){return h(a(this,_e))}set items(e){w(a(this,_e),e,!0)}get currentIndex(){return h(a(this,Se))}set currentIndex(e){w(a(this,Se),e,!0)}get autoSlideIntervalId(){return h(a(this,xe))}set autoSlideIntervalId(e){w(a(this,xe),e,!0)}get slideInterval(){return h(a(this,Ce))}set slideInterval(e){w(a(this,Ce),e,!0)}get originalInterval(){return h(a(this,Te))}set originalInterval(e){w(a(this,Te),e,!0)}get isPaused(){return h(a(this,Me))}set isPaused(e){w(a(this,Me),e,!0)}get isHD(){return h(a(this,Fe))}set isHD(e){w(a(this,Fe),e,!0)}get direction(){return h(a(this,Le))}set direction(e){w(a(this,Le),e,!0)}get darkMode(){return h(a(this,Ae))}set darkMode(e){w(a(this,Ae),e,!0)}get selectedCategory(){return h(a(this,Ee))}set selectedCategory(e){w(a(this,Ee),e,!0)}get isFullscreen(){return h(a(this,Pe))}set isFullscreen(e){w(a(this,Pe),e,!0)}get hideToolbar(){return h(a(this,Oe))}set hideToolbar(e){w(a(this,Oe),e,!0)}get exitBtnTimeoutId(){return h(a(this,De))}set exitBtnTimeoutId(e){w(a(this,De),e,!0)}get buttonsTimeoutId(){return h(a(this,Re))}set buttonsTimeoutId(e){w(a(this,Re),e,!0)}get categories(){return h(a(this,Be))}set categories(e){w(a(this,Be),e,!0)}get categoryIndex(){return h(a(this,Ne))}set categoryIndex(e){w(a(this,Ne),e,!0)}get inactivityTimeoutId(){return h(a(this,Ue))}set inactivityTimeoutId(e){w(a(this,Ue),e,!0)}get prefetchedImages(){return h(a(this,He))}set prefetchedImages(e){w(a(this,He),e,!0)}get nToPrefetch(){return h(a(this,je))}set nToPrefetch(e){w(a(this,je),e,!0)}get mediaSources(){return h(a(this,$e))}set mediaSources(e){w(a(this,$e),e,!0)}get selectedMediaSource(){return h(a(this,ze))}set selectedMediaSource(e){w(a(this,ze),e,!0)}get showHelp(){return h(a(this,qe))}set showHelp(e){w(a(this,qe),e,!0)}get showDescription(){return h(a(this,Ve))}set showDescription(e){w(a(this,Ve),e,!0)}get targetImageId(){return h(a(this,Ye))}set targetImageId(e){w(a(this,Ye),e,!0)}get prefetchDebounceTimerId(){return h(a(this,Qe))}set prefetchDebounceTimerId(e){w(a(this,Qe),e,!0)}get prefetchDebounceDelay(){return h(a(this,Ge))}set prefetchDebounceDelay(e){w(a(this,Ge),e,!0)}get wasPlayingBeforeTouch(){return h(a(this,Xe))}set wasPlayingBeforeTouch(e){w(a(this,Xe),e,!0)}get hdSupported(){return h(a(this,Je))}set hdSupported(e){w(a(this,Je),e,!0)}get showMediaSourceOverlay(){return h(a(this,Ke))}set showMediaSourceOverlay(e){w(a(this,Ke),e,!0)}get mediaSourceOverlayText(){return h(a(this,We))}set mediaSourceOverlayText(e){w(a(this,We),e,!0)}get mediaSourceOverlayTimeoutId(){return h(a(this,Ze))}set mediaSourceOverlayTimeoutId(e){w(a(this,Ze),e,!0)}get mediaSourceOverlayTransitionId(){return h(a(this,et))}set mediaSourceOverlayTransitionId(e){w(a(this,et),e,!0)}get mouseX(){return h(a(this,tt))}set mouseX(e){w(a(this,tt),e,!0)}get mouseY(){return h(a(this,st))}set mouseY(e){w(a(this,st),e,!0)}get isMobile(){return h(a(this,rt))}set isMobile(e){w(a(this,rt),e,!0)}get searchQuery(){return h(a(this,it))}set searchQuery(e){w(a(this,it),e,!0)}get showSearchOverlay(){return h(a(this,at))}set showSearchOverlay(e){w(a(this,at),e,!0)}get overlayMessage(){return h(a(this,ot))}set overlayMessage(e){w(a(this,ot),e,!0)}get showMessageOverlay(){return h(a(this,lt))}set showMessageOverlay(e){w(a(this,lt),e,!0)}get overlayTimeoutId(){return h(a(this,nt))}set overlayTimeoutId(e){w(a(this,nt),e,!0)}get searchToken(){return h(a(this,dt))}set searchToken(e){w(a(this,dt),e,!0)}get isSearchAuthorized(){return h(a(this,ct))}set isSearchAuthorized(e){w(a(this,ct),e,!0)}get tokenError(){return h(a(this,ut))}set tokenError(e){w(a(this,ut),e,!0)}get progressBar(){return h(a(this,ht))}set progressBar(e){w(a(this,ht),e,!0)}get progressAnimation(){return h(a(this,gt))}set progressAnimation(e){w(a(this,gt),e,!0)}get controlsTimeoutId(){return h(a(this,vt))}set controlsTimeoutId(e){w(a(this,vt),e,!0)}get progressIntervalId(){return h(a(this,ft))}set progressIntervalId(e){w(a(this,ft),e,!0)}get category(){return h(a(this,mt))}set category(e){w(a(this,mt),e,!0)}get favourites(){return h(a(this,yt))}set favourites(e){w(a(this,yt),e,!0)}get showFavourites(){return h(a(this,pt))}set showFavourites(e){w(a(this,pt),e,!0)}get likedImages(){return h(a(this,wt))}set likedImages(e){w(a(this,wt),e,!0)}get showLikedImages(){return h(a(this,kt))}set showLikedImages(e){w(a(this,kt),e,!0)}get previousSelectedMediaSource(){return h(a(this,bt))}set previousSelectedMediaSource(e){w(a(this,bt),e,!0)}get previousSelectedCategory(){return h(a(this,It))}set previousSelectedCategory(e){w(a(this,It),e,!0)}get archivedCuratedFeeds(){return h(a(this,_t))}set archivedCuratedFeeds(e){w(a(this,_t),e,!0)}get currentItem(){return this.items[this.currentIndex]||null}get currentCategoryName(){var e,t,s;return this.showFavourites&&((e=this.currentItem)!=null&&e.sourceCategory)?this.currentItem.sourceCategory:this.showLikedImages?"Liked Images":this.selectedMediaSource===E&&((t=this.category)!=null&&t.id)&&![te,K].includes(this.category.id)?this.category.name||"Curated Story":this.category?this.category.name:((s=this.categories.find(i=>i.id===this.selectedCategory))==null?void 0:s.name)||this.selectedCategory||"Loading..."}get currentSourceName(){var e;return((e=this.mediaSources.find(t=>t.id===this.selectedMediaSource))==null?void 0:e.name)||"Unknown Source"}}be=new WeakMap,Ie=new WeakMap,_e=new WeakMap,Se=new WeakMap,xe=new WeakMap,Ce=new WeakMap,Te=new WeakMap,Me=new WeakMap,Fe=new WeakMap,Le=new WeakMap,Ae=new WeakMap,Ee=new WeakMap,Pe=new WeakMap,Oe=new WeakMap,De=new WeakMap,Re=new WeakMap,Be=new WeakMap,Ne=new WeakMap,Ue=new WeakMap,He=new WeakMap,je=new WeakMap,$e=new WeakMap,ze=new WeakMap,qe=new WeakMap,Ve=new WeakMap,Ye=new WeakMap,Qe=new WeakMap,Ge=new WeakMap,Xe=new WeakMap,Je=new WeakMap,Ke=new WeakMap,We=new WeakMap,Ze=new WeakMap,et=new WeakMap,tt=new WeakMap,st=new WeakMap,rt=new WeakMap,it=new WeakMap,at=new WeakMap,ot=new WeakMap,lt=new WeakMap,nt=new WeakMap,dt=new WeakMap,ct=new WeakMap,ut=new WeakMap,ht=new WeakMap,gt=new WeakMap,vt=new WeakMap,ft=new WeakMap,mt=new WeakMap,yt=new WeakMap,pt=new WeakMap,wt=new WeakMap,kt=new WeakMap,bt=new WeakMap,It=new WeakMap,_t=new WeakMap;const sr="gallery",Ui=(r=sr)=>ui(r),Hi=(r=sr)=>{const e=new Ni;return ci(r,e)};var ji=U('<span class="text-yellow-300">(requires token)</span>'),$i=U('<div class="help-overlay svelte-1k4ytib" role="dialog" aria-modal="true" aria-labelledby="help-dialog-title" tabindex="0"><div class="help-content svelte-1k4ytib"><h2 class="mb-4 font-bold text-2xl text-center">Keyboard Shortcuts</h2> <table class="shortcuts-table svelte-1k4ytib"><tbody><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">←</span></td><td class="svelte-1k4ytib">Previous image</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">→</span></td><td class="svelte-1k4ytib">Next image</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">Enter</span></td><td class="svelte-1k4ytib">Open current image link</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">↑</span></td><td class="svelte-1k4ytib">Previous category</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">↓</span></td><td class="svelte-1k4ytib">Next category</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">Page Up</span></td><td class="svelte-1k4ytib">Previous media source</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">Page Down</span></td><td class="svelte-1k4ytib">Next media source</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">D</span></td><td class="svelte-1k4ytib">Toggle image description</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">P</span></td><td class="svelte-1k4ytib">Pause/resume slideshow</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">F</span></td><td class="svelte-1k4ytib">Toggle fullscreen</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">Esc</span></td><td class="svelte-1k4ytib">Exit fullscreen</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">H</span></td><td class="svelte-1k4ytib">Toggle help (this screen)</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">/</span></td><td class="svelte-1k4ytib">Open search <!></td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">S</span></td><td class="svelte-1k4ytib">Toggle favourite for current category</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">L</span></td><td class="svelte-1k4ytib">Like/unlike current image</td></tr></tbody></table> <div class="opacity-70 mt-6 text-sm text-center">Click anywhere outside this window to close</div></div></div>'),zi=U('<div class="relative bg-red-100 dark:bg-red-900 mb-4 px-4 py-3 border border-red-400 dark:border-red-700 rounded text-red-700 dark:text-red-300"><span> </span></div>'),qi=r=>r.stopPropagation(),Vi=U('<div class="mt-2 text-red-400 text-sm"> </div>'),Yi=U('<div class="mb-4"><form><label class="block mb-2 text-gray-300 text-sm" for="searchToken">Enter token to access search:</label> <input type="text" id="searchToken" placeholder="Enter token" class="bg-white/90 dark:bg-gray-200/90 px-4 py-2 border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 w-full text-gray-900"></form> <!> <div class="flex justify-center mt-5"><button class="bg-blue-500 hover:bg-blue-600 px-6 py-2 rounded-md text-white transition-colors cursor-pointer"><span>Verify</span> <span>Verifying...</span></button></div></div>'),Qi=U('<div class="flex flex-row justify-center gap-4 mt-5"><input type="text" placeholder="e.g., Van Gogh starry night, story of..." class="bg-white/90 dark:bg-gray-200/90 px-4 py-2 border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 w-full text-gray-900"> <button class="bg-blue-500 hover:bg-blue-600 px-6 py-2 rounded-md text-white transition-colors cursor-pointer" title="Search or Curate" aria-label="Search or Curate gallery"><span>✨</span> <span>Searching...</span></button></div>'),Gi=U('<div class="mt-4 text-red-400 text-center"> </div>'),Xi=U('<div class="z-[100] fixed inset-0 flex justify-center items-center bg-black/65 backdrop-blur-sm p-4" role="dialog" aria-modal="true" aria-labelledby="search-dialog-title" tabindex="0"><div class="relative bg-gray-900 dark:bg-dark-surface shadow-xl p-6 rounded-lg w-full max-w-md" role="dialog" aria-modal="true" aria-labelledby="search-dialog-title" tabindex="0"><button class="top-4 right-4 absolute text-gray-400 hover:text-white text-xl transition-colors cursor-pointer" aria-label="Close search">×</button> <!> <!></div></div>'),Ji=U('<div class="z-[110] fixed inset-0 flex justify-center items-center pointer-events-none"><div class="bg-black/80 shadow-lg px-8 py-6 rounded-xl max-w-md text-white text-center"><div class="text-lg"> </div></div></div>'),Ki=U('<button class="cursor-pointer exit-fullscreen-btn nav-button svelte-1k4ytib" aria-label="Exit fullscreen"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),Wi=U('<img width="100%" height="100%" class="transition-all duration-500 gallery-image svelte-1k4ytib">'),Zi=U('<a target="_blank" class="flex-1 font-semibold hover:underline basis-1/2"><h2 class="font-semibold"> </h2></a> <button aria-label="Like/unlike current image" title="Like/unlike current image (L)"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg></button>',1),ea=U('<div class="relative max-h-[10vh] overflow-y-auto text-sm hide-scrollbar svelte-1k4ytib"><div><!></div></div>'),ta=U("<option> </option>"),sa=U("<option> </option>"),ra=U("<span> </span> of <span> </span>",1),ia=U("<span></span>"),aa=U('<div class="gallery-wrapper svelte-1k4ytib"><!> <div class="image-container svelte-1k4ytib"><div><div class="border-gray-700 dark:border-gray-300 border-b-2 rounded-full w-12 h-12 animate-spin"></div></div> <div class="z-9 relative flex justify-center items-center w-full h-full"><div><div class="mb-1 font-bold text-2xl"> </div> <div class="opacity-75 text-sm"> </div></div> <!> <button class="mobile-nav-area mobile-nav-prev svelte-1k4ytib" aria-label="Previous image"></button> <button class="mobile-nav-area mobile-nav-next svelte-1k4ytib" aria-label="Next image"></button> <div><button class="flex items-center bg-black/50 hover:bg-black/80 px-4 py-2 rounded-full text-white transition-all duration-300 cursor-pointer" aria-label="Previous category"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg> <span class="ml-2 svelte-1k4ytib"> </span></button></div> <div><button aria-label="Next category"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg> <span class="ml-2 svelte-1k4ytib"> </span></button> <button title="Refresh random artist" aria-label="Refresh random artist"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button></div> <button class="bg-black/50 hover:bg-black/80 p-2 rounded-full text-white transition-all duration-300 cursor-pointer image-nav-button image-nav-prev nav-button svelte-1k4ytib" aria-label="Previous image"><svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button> <button class="bg-black/50 hover:bg-black/80 p-2 rounded-full text-white transition-all duration-300 cursor-pointer image-nav-button image-nav-next nav-button svelte-1k4ytib" aria-label="Next image"><svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button></div> <div class="title-overlay svelte-1k4ytib"><div class="flex flex-row justify-between items-center"><!> <div><span> </span> <button aria-label="Toggle favourites" class="ml-2 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg></button></div></div>  <!></div> <div class="progress-container svelte-1k4ytib"><div class="progress-bar svelte-1k4ytib"></div></div></div> <div><div class="flex flex-shrink items-center space-x-1 md:space-x-2"><div class="flex justify-center items-center media-source-selector"><select class="bg-white dark:bg-dark-surface px-4 py-2 border-gray-300 border-unset dark:border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 max-w-[50vw] md:max-w-none text-gray-800 dark:text-dark-text"></select></div> <div class="flex flex-shrink justify-center items-center category-selector"><select class="bg-white dark:bg-dark-surface px-4 py-2 border-gray-300 border-unset dark:border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-full md:max-w-[30vw] xl:max-w-none text-gray-800 dark:text-dark-text"></select></div></div> <div class="flex flex-grow justify-center items-center"><span class="text-gray-600 dark:text-gray-400 text-sm"><!></span></div> <div class="flex justify-between items-center space-x-1 md:space-x-2 w-full md:w-auto"><button title="Search ( / )" aria-label="Search gallery"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path></svg></button> <button aria-label="Toggle favourites view" title="Toggle favourites view"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg></button> <button aria-label="View all liked images" title="View all liked images (I)"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg></button> <button aria-label="Toggle slideshow" title="Pause/Resume slideshow"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path></svg></button> <button aria-label="Toggle HD quality" title="Toggle HD images"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M3 3h18a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1m4.5 8.25V9H6v6h1.5v-2.25h2V15H11V9H9.5v2.25zm7-.75H16a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-1.5zM13 9v6h3a2 2 0 0 0 2-2v-2a2 2 0 0 0-2-2z"></path></svg></button> <button aria-label="Toggle fullscreen" title="Toggle fullscreen" class="hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full focus:outline-none text-gray-600 dark:text-gray-400 cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"></path></svg></button> <button aria-label="Toggle description" title="Toggle description"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg></button> <div class="flex items-center space-x-1"><span class="text-sm"><svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg></span> <label class="toggle-switch svelte-1k4ytib"><input type="checkbox" class="opacity-0 w-0 h-0 svelte-1k4ytib"> <span class="toggle-slider svelte-1k4ytib"></span></label> <span class="text-sm"><svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg></span></div></div></div></div>'),oa=U('<div style="background-color: #121212" class="bg-gray-100 dark:bg-dark-bg text-gray-900 dark:text-dark-text transition-colors duration-300 main-container svelte-1k4ytib"><!> <!> <!> <!> <!></div>');function ga(r,e){hi(e,!0),Hi();const t=Ui();gi(()=>(t.init(),()=>{t.autoSlideIntervalId&&clearInterval(t.autoSlideIntervalId),t.controlsTimeoutId&&clearTimeout(t.controlsTimeoutId),t.inactivityTimeoutId&&clearTimeout(t.inactivityTimeoutId),t.overlayTimeoutId&&clearTimeout(t.overlayTimeoutId),t.progressIntervalId&&clearInterval(t.progressIntervalId)}));var s=oa(),i=f(s);{var l=n=>{var k=$i();k.__click=M=>{M.stopPropagation(),t.showHelp=!1},k.__keydown=M=>{M.key,t.showHelp=!1};var I=f(k),S=_(f(I),2),L=f(S),q=_(f(L),12),H=_(f(q)),B=_(f(H));{var $=M=>{var P=ji();N(M,P)};Y(B,M=>{t.isSearchAuthorized||M($)})}g(H),g(q),Ft(2),g(L),g(S),Ft(2),g(I),g(k),N(n,k)};Y(i,n=>{t.showHelp&&n(l)})}var o=_(i,2);{var c=n=>{var k=zi(),I=f(k),S=f(I,!0);g(I),g(k),Q(()=>V(S,t.error)),N(n,k)};Y(o,n=>{t.error&&n(c)})}var u=_(o,2);{var v=n=>{var k=Xi();k.__click=()=>t.closeSearchOverlay(),k.__keydown=M=>{M.key==="Escape"&&(M.preventDefault(),M.stopPropagation(),t.closeSearchOverlay())};var I=f(k);I.__click=[qi],I.__keydown=M=>{M.key==="Escape"&&(M.preventDefault(),M.stopPropagation(),t.closeSearchOverlay())};var S=f(I);S.__click=()=>t.closeSearchOverlay();var L=_(S,2);{var q=M=>{var P=Yi(),D=f(P),X=_(f(D),2);Kt(X),X.__keydown=j=>{j.key==="Enter"?(j.preventDefault(),t.verifyToken()):j.key==="Escape"&&(j.preventDefault(),j.stopPropagation(),t.closeSearchOverlay())},Ds(X),g(D);var oe=_(D,2);{var le=j=>{var ne=Vi(),he=f(ne,!0);g(ne),Q(()=>V(he,t.tokenError)),N(j,ne)};Y(oe,j=>{t.tokenError&&j(le)})}var ce=_(oe,2),W=f(ce);W.__click=()=>t.verifyToken();var z=f(W);let ee;var St=_(z,2);let ue;g(W),g(ce),g(P),Q((j,ne)=>{ee=O(z,1,"",null,ee,j),ue=O(St,1,"",null,ue,ne)},[()=>({hidden:t.loading}),()=>({hidden:!t.loading})]),Rs("submit",D,j=>{j.preventDefault(),t.verifyToken()}),qs(X,()=>t.searchToken,j=>t.searchToken=j),N(M,P)},H=M=>{var P=Qi(),D=f(P);Kt(D),D.__keydown=z=>{z.key==="Enter"?(z.preventDefault(),t.performSearch()):z.key==="Escape"&&(z.preventDefault(),z.stopPropagation(),t.closeSearchOverlay())},Ds(D);var X=_(D,2);X.__click=()=>t.performSearch();var oe=f(X);let le;var ce=_(oe,2);let W;g(X),g(P),Q((z,ee)=>{le=O(oe,1,"",null,le,z),W=O(ce,1,"",null,W,ee)},[()=>({hidden:t.loading}),()=>({hidden:!t.loading})]),qs(D,()=>t.searchQuery,z=>t.searchQuery=z),N(M,P)};Y(L,M=>{t.isSearchAuthorized?M(H,!1):M(q)})}var B=_(L,2);{var $=M=>{var P=Gi(),D=f(P,!0);g(P),Q(()=>V(D,t.error)),N(M,P)};Y(B,M=>{t.error&&M($)})}g(I),g(k),N(n,k)};Y(u,n=>{t.showSearchOverlay&&n(v)})}var d=_(u,2);{var C=n=>{var k=Ji(),I=f(k),S=f(I),L=f(S,!0);g(S),g(I),g(k),Q(()=>V(L,t.overlayMessage)),At(3,k,()=>Et,()=>({duration:300})),N(n,k)};Y(d,n=>{t.showMessageOverlay&&n(C)})}var b=_(d,2);{var F=n=>{var k=aa(),I=f(k);{var S=x=>{var T=Ki();T.__click=()=>t.exitFullscreen();var A=f(T);let R;g(T),Q(J=>R=O(A,0,"w-5 h-5",null,R,J),[()=>({hidden:!t.isFullscreen&&!t.hideToolbar})]),N(x,T)};Y(I,x=>{(t.hideToolbar||t.isFullscreen)&&x(S)})}var L=_(I,2),q=f(L);let H;var B=_(q,2),$=f(B);let M;var P=f($),D=f(P,!0);g(P);var X=_(P,2),oe=f(X,!0);g(X),g($);var le=_($,2);{var ce=x=>{var T=Wi();Q(()=>{Z(T,"src",t.currentItem.image_url),Z(T,"alt",t.currentItem.title)}),Rs("error",T,function(...A){var R;(R=t.handleImageError)==null||R.apply(this,A)}),wi(T),At(3,T,()=>Et,()=>({duration:500})),N(x,T)};Y(le,x=>{t.currentItem&&x(ce)})}var W=_(le,2);W.__click=()=>t.prevItem(),W.__keydown=x=>x.key==="Enter"&&t.prevItem();var z=_(W,2);z.__click=()=>t.nextItem(),z.__keydown=x=>x.key==="Enter"&&t.nextItem();var ee=_(z,2);let St;var ue=f(ee);ue.__click=()=>t.prevCategory();var j=_(f(ue),2),ne=f(j,!0);g(j),g(ue),g(ee);var he=_(ee,2);let is;var ge=f(he);ge.__click=()=>t.nextCategory();let as;var os=_(f(ge),2),rr=f(os,!0);g(os),g(ge);var ls=_(ge,2);ls.__click=()=>t.refreshRandomArtist();let ns;g(he);var ds=_(he,2);ds.__click=()=>t.prevItem();var ir=_(ds,2);ir.__click=()=>t.nextItem(),g(B);var Ot=_(B,2),Dt=f(Ot),cs=f(Dt);{var ar=x=>{var T=Zi(),A=Os(T),R=f(A),J=f(R,!0);g(R),g(A);var re=_(A,2);re.__click=()=>t.toggleLikeImage();let Mt;var Yt=f(re);g(re),Q((Qt,Gt)=>{Z(A,"href",t.currentItem.link),V(J,t.currentItem.title),Mt=O(re,1,"hover:bg-gray-200 dark:hover:bg-gray-700 ml-2 p-2 rounded-full focus:outline-none cursor-pointer",null,Mt,Qt),Z(Yt,"fill",Gt)},[()=>({"text-red-500":t.isImageLiked(),"text-gray-600":!t.isImageLiked(),"dark:text-gray-400":!t.isImageLiked()}),()=>t.isImageLiked()?"currentColor":"none"]),N(x,T)};Y(cs,x=>{t.currentItem&&x(ar)})}var Rt=_(cs,2);let us;var Bt=f(Rt),or=f(Bt,!0);g(Bt);var xt=_(Bt,2);xt.__click=x=>{x.stopPropagation(),t.showFavourites&&t.currentItem?t.toggleFavourite(t.currentItem.category_id,t.currentItem.media_source):t.toggleFavourite()};var lr=f(xt);g(xt),g(Rt),g(Dt);var nr=_(Dt,2);{var dr=x=>{var T=ea(),A=f(T),R=f(A);Si(R,()=>t.currentItem.description),g(A),g(T),At(3,T,()=>Et),N(x,T)};Y(nr,x=>{var T;t.showDescription&&((T=t.currentItem)!=null&&T.description)&&x(dr)})}g(Ot);var hs=_(Ot,2),cr=f(hs);ki(cr,x=>t.progressBar=x,()=>t==null?void 0:t.progressBar),g(hs),g(L);var Nt=_(L,2),Ut=f(Nt),Ht=f(Ut),Ct=f(Ht);Ct.__change=()=>t.changeMediaSource(),Us(Ct,21,()=>t.mediaSources,x=>x.id,(x,T)=>{var A=ta(),R={},J=f(A,!0);g(A),Q(()=>{R!==(R=h(T).id)&&(A.value=(A.__value=h(T).id)??""),V(J,h(T).name)}),N(x,A)}),g(Ct),g(Ht);var gs=_(Ht,2),Tt=f(gs);Tt.__change=()=>t.loadCategory(),Us(Tt,21,()=>t.categories,x=>x.id,(x,T)=>{var A=sa(),R={},J=f(A,!0);g(A),Q(()=>{R!==(R=h(T).id)&&(A.value=(A.__value=h(T).id)??""),Fi(A,h(T).id===(t.selectedCategory||t.categories[0].id)),V(J,h(T).name)}),N(x,A)}),g(Tt),g(gs),g(Ut);var jt=_(Ut,2),vs=f(jt),ur=f(vs);{var hr=x=>{var T=ra(),A=Os(T),R=f(A,!0);g(A);var J=_(A,2),re=f(J,!0);g(J),Q(()=>{V(R,t.currentIndex+1),V(re,t.items.length)}),N(x,T)},gr=x=>{var T=ia();N(x,T)};Y(ur,x=>{t.items.length>0?x(hr):x(gr,!1)})}g(vs),g(jt);var fs=_(jt,2),$t=f(fs);$t.__click=()=>t.openSearchOverlay();let ms;var ve=_($t,2);ve.__click=()=>t.toggleShowFavourites();let ys;var vr=f(ve);g(ve);var fe=_(ve,2);fe.__click=()=>t.toggleShowLikedImages();let ps;var fr=f(fe);g(fe);var me=_(fe,2);me.__click=()=>t.togglePause();let ws;var ks=f(me);let bs;var mr=_(ks,2);let Is;g(me);var zt=_(me,2);zt.__click=()=>t.toggleHD();let _s;var Ss=_(zt,2);Ss.__click=()=>t.toggleFullscreen();var qt=_(Ss,2);qt.__click=()=>t.showDescription=!t.showDescription;let xs;var Cs=_(qt,2),Ts=_(f(Cs),2),Vt=f(Ts);Kt(Vt),Vt.__click=()=>t.toggleDarkMode(),Ft(2),g(Ts),Ft(2),g(Cs),g(fs),g(Nt),g(k),Q((x,T,A,R,J,re,Mt,Yt,Qt,Gt,yr,pr,wr,kr,br,Ir,_r,Sr,xr)=>{H=O(q,1,"z-10 absolute flex justify-center items-center bg-black/50 w-full h-full transition-all duration-300",null,H,x),M=O($,1,"top-1/2 left-1/2 z-9 fixed flex flex-col justify-center items-center bg-black/50 shadow-lg px-8 py-4 rounded-xl font-semibold text-white text-center transition-opacity -translate-x-1/2 -translate-y-1/2 duration-300 nav-button transform svelte-1k4ytib",null,M,T),V(D,t.currentSourceName),V(oe,t.currentCategoryName),St=O(ee,1,"flex items-center category-nav-button category-up nav-button svelte-1k4ytib",null,St,A),V(ne,R),is=O(he,1,"flex items-center category-nav-button category-down nav-button svelte-1k4ytib",null,is,J),as=O(ge,1,"flex items-center bg-black/50 hover:bg-black/80 px-4 py-2 rounded-l-full text-white transition-all duration-300 cursor-pointer",null,as,re),V(rr,Mt),ns=O(ls,1,"bg-black/50 hover:bg-black/80 px-3 py-[10px] border-white-600 border-l rounded-r-full text-white transition-all duration-300 cursor-pointer",null,ns,Yt),us=O(Rt,1,"flex items-center bg-black/50 ml-3 px-3 py-1 rounded-full text-sm svelte-1k4ytib",null,us,Qt),V(or,t.currentCategoryName),Z(xt,"title",Gt),Z(lr,"fill",yr),O(Nt,1,`${t.hideToolbar?"hidden":"flex"} justify-center items-center text-sm control-bar`,"svelte-1k4ytib"),ms=O($t,1,"hover:bg-gray-200 dark:hover:bg-gray-700 p-2 rounded-full focus:outline-none text-gray-600 dark:text-gray-400 cursor-pointer",null,ms,pr),ys=O(ve,1,"hover:bg-gray-200 dark:hover:bg-gray-700 p-2 rounded-full focus:outline-none cursor-pointer",null,ys,wr),Z(vr,"fill",t.showFavourites?"currentColor":"none"),ps=O(fe,1,"hover:bg-gray-200 dark:hover:bg-gray-700 p-2 rounded-full focus:outline-none cursor-pointer",null,ps,kr),Z(fr,"fill",t.showLikedImages?"currentColor":"none"),ws=O(me,1,"hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full focus:outline-none cursor-pointer",null,ws,br),bs=O(ks,0,"w-5 h-5",null,bs,Ir),Is=O(mr,0,"w-5 h-5",null,Is,_r),_s=O(zt,1,"hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full focus:outline-none cursor-pointer",null,_s,Sr),xs=O(qt,1,"hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full focus:outline-none cursor-pointer",null,xs,xr),Mi(Vt,t.darkMode)},[()=>({hidden:!t.loading}),()=>({visible:t.showMediaSourceOverlay,"opacity-0":!t.showMediaSourceOverlay,hidden:t.isMobile}),()=>({hidden:t.categories.length<=1}),()=>t.getPrevCategoryName(),()=>({hidden:t.categories.length<=1}),()=>({"rounded-r-full":t.selectedCategory!=="random-artist"}),()=>t.getNextCategoryName(),()=>({hidden:t.selectedCategory!=="random-artist"}),()=>({hidden:!t.selectedCategory,"mobile-truncate":t.selectedMediaSource!=="wikiart"}),()=>t.showFavourites&&t.currentItem?t.isFavourite(t.currentItem.category_id,t.currentItem.media_source)?"Remove from favourites":"Add to favourites":t.isFavourite()?"Remove from favourites":"Add to favourites",()=>t.showFavourites&&t.currentItem?t.isFavourite(t.currentItem.category_id,t.currentItem.media_source)?"currentColor":"none":t.isFavourite()?"currentColor":"none",()=>({hidden:!t.isSearchAuthorized}),()=>({hidden:!t.hasFavourites(),"text-blue-500":t.showFavourites,"text-gray-600":!t.showFavourites,"dark:text-gray-400":!t.showFavourites}),()=>({hidden:!t.hasLikedImages(),"text-blue-500":t.showLikedImages,"text-gray-600":!t.showLikedImages,"dark:text-gray-400":!t.showLikedImages}),()=>({"text-blue-500":t.isPaused,"text-gray-600":!t.isPaused,"dark:text-gray-400":!t.isPaused}),()=>({hidden:t.isPaused}),()=>({hidden:!t.isPaused}),()=>({"text-blue-500":t.isHD,"text-gray-600":!t.isHD,"dark:text-gray-400":!t.isHD}),()=>({"text-blue-500":t.showDescription,"text-gray-600":!t.showDescription,"dark:text-gray-400":!t.showDescription})]),At(3,$,()=>Et,()=>({duration:300})),Vs(Ct,()=>t.selectedMediaSource,x=>t.selectedMediaSource=x),Vs(Tt,()=>t.selectedCategory,x=>t.selectedCategory=x),N(n,k)};Y(b,n=>{t.items.length>=0&&n(F)})}g(s),N(r,s),vi()}pi(["click","keydown","change"]);export{ga as component};
