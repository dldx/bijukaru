var Hr=Object.defineProperty;var Gs=r=>{throw TypeError(r)};var jr=(r,e,t)=>e in r?Hr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var l=(r,e,t)=>jr(r,typeof e!="symbol"?e+"":e,t),$r=(r,e,t)=>e.has(r)||Gs("Cannot "+t);var a=(r,e,t)=>($r(r,e,"read from private field"),t?t.call(r):e.get(r)),m=(r,e,t)=>e.has(r)?Gs("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t);import{b as Vs,e as qr,t as R,a as P}from"../chunks/C0QaH9dC.js";import{s as Kt,h as te,I as Fe,M as Gr,a as _s,b as Vr,w as u,a6 as Yr,c as Qr,r as Ys,d as ms,g as ke,Z as Wr,e as or,f as nr,p as Xr,a1 as lr,R as Jr,ab as Kr,am as Qs,an as ys,L as Ae,ao as Zr,ap as ei,aq as ti,a0 as si,ar as ri,as as ii,at as ai,au as oi,X as cr,C as Y,av as ni,_ as li,Y as ci,aw as di,ax as ui,ay as hi,az as vi,aA as gi,E as fi,aB as mi,aC as yi,i as xs,u as dr,aD as pi,aE as ki,q as wi,aF as Ce,N as Ws,O as Xs,P as bi,aG as Si,j as _i,aH as Ii,aI as xi,aJ as Ti,aj as y,aa as p,a9 as ge,k as Ci,o as Mi,l as Fi,D as d,G as k,F as c,aK as Me,B as ps}from"../chunks/D4KI4Ps9.js";import{a as Ei,b as Ai,w as Li,l as ur,d as Di,s as J,e as ks,c as Js,r as Oi}from"../chunks/CkaAntYN.js";import{i as q,b as Pi}from"../chunks/COqvbv4a.js";import{r as Ks,a as Zs}from"../chunks/Dcrd0H1f.js";function Ri(r,e,t,s){for(var i=[],n=e.length,o=0;o<n;o++)ti(e[o].e,i,!0);var h=n>0&&i.length===0&&t!==null;if(h){var v=t.parentNode;si(v),v.append(t),s.clear(),fe(r,e[0].prev,e[n-1].next)}ri(i,()=>{for(var w=0;w<n;w++){var g=e[w];h||(s.delete(g.k),fe(r,g.prev,g.next)),ii(g.e,!h)}})}function er(r,e,t,s,i,n=null){var o=r,h={flags:e,items:new Map,first:null};{var v=r;o=te?Kt(Fe(v)):v.appendChild(Gr())}te&&_s();var w=null,g=!1,C=Yr(()=>{var _=t();return Jr(_)?_:_==null?[]:lr(_)});Vr(()=>{var _=u(C),E=_.length;if(g&&E===0)return;g=E===0;let b=!1;if(te){var A=o.data===Qr;A!==(E===0)&&(o=Ys(),Kt(o),ms(!1),b=!0)}if(te){for(var S=null,f,x=0;x<E;x++){if(ke.nodeType===8&&ke.data===Wr){o=ke,b=!0,ms(!1);break}var z=_[x],O=s(z,x);f=hr(ke,h,S,null,z,O,x,i,e,t),h.items.set(O,f),S=f}E>0&&Kt(Ys())}te||Ni(_,h,o,i,e,s,t),n!==null&&(E===0?w?or(w):w=nr(()=>n(o)):w!==null&&Xr(w,()=>{w=null})),b&&ms(!0),u(C)}),te&&(o=ke)}function Ni(r,e,t,s,i,n,o){var h=r.length,v=e.items,w=e.first,g=w,C,_=null,E=[],b=[],A,S,f,x;for(x=0;x<h;x+=1){if(A=r[x],S=n(A,x),f=v.get(S),f===void 0){var z=g?g.e.nodes_start:t;_=hr(z,e,_,_===null?e.first:_.next,A,S,x,s,i,o),v.set(S,_),E=[],b=[],g=_.next;continue}if(Bi(f,A,x),(f.e.f&ys)!==0&&or(f.e),f!==g){if(C!==void 0&&C.has(f)){if(E.length<b.length){var O=b[0],H;_=O.prev;var Q=E[0],W=E[E.length-1];for(H=0;H<E.length;H+=1)tr(E[H],O,t);for(H=0;H<b.length;H+=1)C.delete(b[H]);fe(e,Q.prev,W.next),fe(e,_,Q),fe(e,W,O),g=O,_=W,x-=1,E=[],b=[]}else C.delete(f),tr(f,g,t),fe(e,f.prev,f.next),fe(e,f,_===null?e.first:_.next),fe(e,_,f),_=f;continue}for(E=[],b=[];g!==null&&g.k!==S;)(g.e.f&ys)===0&&(C??(C=new Set)).add(g),b.push(g),g=g.next;if(g===null)continue;f=g}E.push(f),_=f,g=f.next}if(g!==null||C!==void 0){for(var G=C===void 0?[]:lr(C);g!==null;)(g.e.f&ys)===0&&G.push(g),g=g.next;var M=G.length;if(M>0){var j=h===0?t:null;Ri(e,G,j,v)}}Ae.first=e.first&&e.first.e,Ae.last=_&&_.e}function Bi(r,e,t,s){ei(r.v,e),r.i=t}function hr(r,e,t,s,i,n,o,h,v,w){var g=(v&ai)!==0,C=(v&oi)===0,_=g?C?Kr(i):Qs(i):i,E=(v&Zr)===0?o:Qs(o),b={i:E,v:_,k:n,a:null,e:null,prev:t,next:s};try{return b.e=nr(()=>h(r,_,E,w),te),b.e.prev=t&&t.e,b.e.next=s&&s.e,t===null?e.first=b:(t.next=b,t.e.next=b.e),s!==null&&(s.prev=b,s.e.prev=b.e),b}finally{}}function tr(r,e,t){for(var s=r.next?r.next.e.nodes_start:t,i=e?e.e.nodes_start:t,n=r.e.nodes_start;n!==s;){var o=cr(n);i.before(n),n=o}}function fe(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function zi(r,e,t=!1,s=!1,i=!1){var n=r,o="";Y(()=>{var h=Ae;if(o===(o=e()??"")){te&&_s();return}if(h.nodes_start!==null&&(ni(h.nodes_start,h.nodes_end),h.nodes_start=h.nodes_end=null),o!==""){if(te){ke.data;for(var v=_s(),w=v;v!==null&&(v.nodeType!==8||v.data!=="");)w=v,v=cr(v);if(v===null)throw li(),ci;Vs(ke,w),n=Kt(v);return}var g=o+"";t?g=`<svg>${g}</svg>`:s&&(g=`<math>${g}</math>`);var C=qr(g);if((t||s)&&(C=Fe(C)),Vs(Fe(C),C.lastChild),t||s)for(;Fe(C);)n.before(Fe(C));else n.before(C)}})}const sr=[...` 	
\r\fÂ \v\uFEFF`];function Ui(r,e,t){var s=r==null?"":""+r;if(e&&(s=s?s+" "+e:e),t){for(var i in t)if(t[i])s=s?s+" "+i:i;else if(s.length)for(var n=i.length,o=0;(o=s.indexOf(i,o))>=0;){var h=o+n;(o===0||sr.includes(s[o-1]))&&(h===s.length||sr.includes(s[h]))?s=(o===0?"":s.substring(0,o))+s.substring(h+1):o=h}}return s===""?null:s}function D(r,e,t,s,i,n){var o=r.__className;if(te||o!==t||o===void 0){var h=Ui(t,s,n);(!te||h!==r.getAttribute("class"))&&(h==null?r.removeAttribute("class"):e?r.className=h:r.setAttribute("class",h)),r.__className=t}else if(n&&i!==n)for(var v in n){var w=!!n[v];(i==null||w!==!!i[v])&&r.classList.toggle(v,w)}return n}const Hi=Symbol("is custom element"),ji=Symbol("is html");function Yt(r){if(te){var e=!1,t=()=>{if(!e){if(e=!0,r.hasAttribute("value")){var s=r.value;ne(r,"value",null),r.value=s}if(r.hasAttribute("checked")){var i=r.checked;ne(r,"checked",null),r.checked=i}}};r.__on_r=t,di(t),Ei()}}function $i(r,e){var t=vr(r);t.checked!==(t.checked=e??void 0)&&(r.checked=e)}function qi(r,e){e?r.hasAttribute("selected")||r.setAttribute("selected",""):r.removeAttribute("selected")}function ne(r,e,t,s){var i=vr(r);te&&(i[e]=r.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&r.nodeName==="LINK")||i[e]!==(i[e]=t)&&(e==="loading"&&(r[ui]=t),t==null?r.removeAttribute(e):typeof t!="string"&&Gi(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function vr(r){return r.__attributes??(r.__attributes={[Hi]:r.nodeName.includes("-"),[ji]:r.namespaceURI===hi})}var rr=new Map;function Gi(r){var e=rr.get(r.nodeName);if(e)return e;rr.set(r.nodeName,e=[]);for(var t,s=r,i=Element.prototype;i!==s;){t=gi(s);for(var n in t)t[n].set&&e.push(n);s=vi(s)}return e}const Vi=()=>performance.now(),ue={tick:r=>requestAnimationFrame(r),now:()=>Vi(),tasks:new Set};function gr(){const r=ue.now();ue.tasks.forEach(e=>{e.c(r)||(ue.tasks.delete(e),e.f())}),ue.tasks.size!==0&&ue.tick(gr)}function Yi(r){let e;return ue.tasks.size===0&&ue.tick(gr),{promise:new Promise(t=>{ue.tasks.add(e={c:r,f:t})}),abort(){ue.tasks.delete(e)}}}function Qt(r,e){Li(()=>{r.dispatchEvent(new CustomEvent(e))})}function Qi(r){if(r==="float")return"cssFloat";if(r==="offset")return"cssOffset";if(r.startsWith("--"))return r;const e=r.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(t=>t[0].toUpperCase()+t.slice(1)).join("")}function ir(r){const e={},t=r.split(";");for(const s of t){const[i,n]=s.split(":");if(!i||n===void 0)break;const o=Qi(i.trim());e[o]=n.trim()}return e}const Wi=r=>r;function Wt(r,e,t,s){var i=(r&pi)!==0,n="both",o,h=e.inert,v=e.style.overflow,w,g;function C(){var S=bi,f=Ae;Ws(null),Xs(null);try{return o??(o=t()(e,(s==null?void 0:s())??{},{direction:n}))}finally{Ws(S),Xs(f)}}var _={is_global:i,in(){e.inert=h,Qt(e,"introstart"),w=Is(e,C(),g,1,()=>{Qt(e,"introend"),w==null||w.abort(),w=o=void 0,e.style.overflow=v})},out(S){e.inert=!0,Qt(e,"outrostart"),g=Is(e,C(),w,0,()=>{Qt(e,"outroend"),S==null||S()})},stop:()=>{w==null||w.abort(),g==null||g.abort()}},E=Ae;if((E.transitions??(E.transitions=[])).push(_),Ai){var b=i;if(!b){for(var A=E.parent;A&&(A.f&fi)!==0;)for(;(A=A.parent)&&(A.f&mi)===0;);b=!A||(A.f&yi)!==0}b&&xs(()=>{dr(()=>_.in())})}}function Is(r,e,t,s,i){var n=s===1;if(ki(e)){var o,h=!1;return wi(()=>{if(!h){var S=e({direction:n?"in":"out"});o=Is(r,S,t,s,i)}}),{abort:()=>{h=!0,o==null||o.abort()},deactivate:()=>o.deactivate(),reset:()=>o.reset(),t:()=>o.t()}}if(t==null||t.deactivate(),!(e!=null&&e.duration))return i(),{abort:Ce,deactivate:Ce,reset:Ce,t:()=>s};const{delay:v=0,css:w,tick:g,easing:C=Wi}=e;var _=[];if(n&&t===void 0&&(g&&g(0,1),w)){var E=ir(w(0,1));_.push(E,E)}var b=()=>1-s,A=r.animate(_,{duration:v});return A.onfinish=()=>{var S=(t==null?void 0:t.t())??1-s;t==null||t.abort();var f=s-S,x=e.duration*Math.abs(f),z=[];if(x>0){var O=!1;if(w)for(var H=Math.ceil(x/16.666666666666668),Q=0;Q<=H;Q+=1){var W=S+f*C(Q/H),G=ir(w(W,1-W));z.push(G),O||(O=G.overflow==="hidden")}O&&(r.style.overflow="hidden"),b=()=>{var M=A.currentTime;return S+f*C(M/x)},g&&Yi(()=>{if(A.playState!=="running")return!1;var M=b();return g(M,1-M),!0})}A=r.animate(z,{duration:x,fill:"forwards"}),A.onfinish=()=>{b=()=>s,g==null||g(s,1-s),i()}},{abort:()=>{A&&(A.cancel(),A.effect=null,A.onfinish=Ce)},deactivate:()=>{i=Ce},reset:()=>{s===0&&(g==null||g(1,0))},t:()=>b()}}function ws(r,e,t=e){var s=Si();ur(r,"input",i=>{var n=i?r.defaultValue:r.value;if(n=bs(r)?Ss(n):n,t(n),s&&n!==(n=e())){var o=r.selectionStart,h=r.selectionEnd;r.value=n??"",h!==null&&(r.selectionStart=o,r.selectionEnd=Math.min(h,r.value.length))}}),(te&&r.defaultValue!==r.value||dr(e)==null&&r.value)&&t(bs(r)?Ss(r.value):r.value),_i(()=>{var i=e();bs(r)&&i===Ss(r.value)||r.type==="date"&&!i&&!r.value||i!==r.value&&(r.value=i??"")})}function bs(r){var e=r.type;return e==="number"||e==="range"}function Ss(r){return r===""?null:+r}function fr(r,e,t){if(r.multiple)return Ji(r,e);for(var s of r.options){var i=Ee(s);if(Ii(i,e)){s.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function Xi(r,e){xs(()=>{var t=new MutationObserver(()=>{var s=r.__value;fr(r,s)});return t.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),()=>{t.disconnect()}})}function ar(r,e,t=e){var s=!0;ur(r,"change",i=>{var n=i?"[selected]":":checked",o;if(r.multiple)o=[].map.call(r.querySelectorAll(n),Ee);else{var h=r.querySelector(n)??r.querySelector("option:not([disabled])");o=h&&Ee(h)}t(o)}),xs(()=>{var i=e();if(fr(r,i,s),s&&i===void 0){var n=r.querySelector(":checked");n!==null&&(i=Ee(n),t(i))}r.__value=i,s=!1}),Xi(r)}function Ji(r,e){for(var t of r.options)t.selected=~e.indexOf(Ee(t))}function Ee(r){return"__value"in r?r.__value:r.value}const Ki=r=>r;function Xt(r,{delay:e=0,duration:t=400,easing:s=Ki}={}){const i=+getComputedStyle(r).opacity;return{delay:e,duration:t,easing:s,css:n=>`opacity: ${n*i}`}}class Zi{constructor(){l(this,"ws",null);l(this,"isConnected",!1);l(this,"currentToken",null);l(this,"syncListeners",[]);l(this,"wsUrl");l(this,"localData",{favourites:{},likedImages:[]});l(this,"reconnectTimeout",null);l(this,"reconnectAttempts",0);l(this,"maxReconnectAttempts",5);this.wsUrl=this.getWebSocketUrl()}getWebSocketUrl(){return typeof window<"u"?"ws://bijukaru-sync-worker.durand.workers.dev/ws":"ws://localhost:8787/ws"}async initializeSync(e){try{if(this.isConnected&&this.currentToken===e)return!0;await this.disconnect(),this.currentToken=e,this.reconnectAttempts=0;const t=`${this.wsUrl}?token=${encodeURIComponent(e)}`;return this.ws=new WebSocket(t),new Promise(s=>{if(!this.ws){s(!1);return}const i=setTimeout(()=>{this.isConnected||(console.warn("WebSocket connection timeout"),s(!1))},1e4);this.ws.onopen=()=>{console.log("Sync connection opened"),this.isConnected=!0,this.reconnectAttempts=0,clearTimeout(i),s(!0)},this.ws.onclose=n=>{console.log("Sync connection closed:",n.code,n.reason),this.isConnected=!1,clearTimeout(i),this.scheduleReconnect(),this.isConnected||s(!1)},this.ws.onerror=n=>{console.error("Sync connection error:",n),this.isConnected=!1,clearTimeout(i),s(!1)},this.ws.onmessage=n=>{try{const o=JSON.parse(n.data);this.handleSyncMessage(o)}catch(o){console.error("Error parsing sync message:",o)}}})}catch(t){return console.error("Failed to initialize sync:",t),this.isConnected=!1,!1}}scheduleReconnect(){if(this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.reconnectAttempts>=this.maxReconnectAttempts){console.log("Max reconnection attempts reached, giving up");return}const e=Math.min(1e3*Math.pow(2,this.reconnectAttempts),3e4);this.reconnectAttempts++,this.reconnectTimeout=window.setTimeout(()=>{this.currentToken&&!this.isConnected&&(console.log(`Attempting to reconnect (attempt ${this.reconnectAttempts}/${this.maxReconnectAttempts})...`),this.initializeSync(this.currentToken))},e)}handleSyncMessage(e){this.localData=e,this.notifySyncListeners()}async disconnect(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.ws&&(this.ws.close(),this.ws=null),this.isConnected=!1,this.currentToken=null,this.reconnectAttempts=0}isConnectedToSync(){return this.isConnected&&this.ws!==null&&this.ws.readyState===WebSocket.OPEN}addSyncListener(e){this.syncListeners.push(e)}removeSyncListener(e){const t=this.syncListeners.indexOf(e);t>-1&&this.syncListeners.splice(t,1)}notifySyncListeners(){this.syncListeners.forEach(e=>{try{e()}catch(t){console.error("Error in sync listener:",t)}})}updateFavourites(e){try{const t={};e.forEach((s,i)=>{t[i]=Array.from(s)}),this.localData.favourites=t,this.sendToServer({favourites:t,likedImages:this.localData.likedImages})}catch(t){console.error("Error updating favourites:",t)}}updateLikedImages(e){try{this.localData.likedImages=e,this.sendToServer({favourites:this.localData.favourites,likedImages:e})}catch(t){console.error("Error updating liked images:",t)}}sendToServer(e){if(this.ws&&this.isConnectedToSync())try{this.ws.send(JSON.stringify(e))}catch(t){console.error("Error sending data to server:",t)}else console.warn("Cannot send data: WebSocket not connected")}getFavourites(){try{const e=new Map;return Object.entries(this.localData.favourites).forEach(([t,s])=>{e.set(t,new Set(s))}),e}catch(e){return console.error("Error getting favourites:",e),new Map}}getLikedImages(){try{return this.localData.likedImages||[]}catch(e){return console.error("Error getting liked images:",e),[]}}async forceSync(){if(this.ws&&this.isConnectedToSync())try{this.sendToServer(this.localData)}catch(e){console.error("Error forcing sync:",e)}}getSyncStats(){return{isConnected:this.isConnectedToSync(),currentToken:this.currentToken,favouritesCount:Object.keys(this.localData.favourites).length,likedImagesCount:this.localData.likedImages.length,reconnectAttempts:this.reconnectAttempts,wsUrl:this.wsUrl}}resetReconnection(){this.reconnectAttempts=0,this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null)}}const K=new Zi,pe="favourites",de="liked",N="bijukaru",Jt="thisiscolossal";var Le,De,Oe,Pe,Re,Ne,Be,ze,Ue,He,je,$e,qe,Ge,Ve,Ye,Qe,We,Xe,Je,Ke,Ze,et,tt,st,rt,it,at,ot,nt,lt,ct,dt,ut,ht,vt,gt,ft,mt,yt,pt,kt,wt,bt,St,_t,It,xt,Tt,Ct,Mt,Ft,Et,At,Lt,Dt,Ot,Pt,Rt,Nt,Bt,zt,Ut,Ht;class ea{constructor(){m(this,Le,y(!0));m(this,De,y(null));m(this,Oe,y(ge([])));m(this,Pe,y(0));m(this,Re,y(null));m(this,Ne,y(1e4));m(this,Be,y(1e4));m(this,ze,y(!1));m(this,Ue,y(!1));m(this,He,y("next"));m(this,je,y(!0));m(this,$e,y(""));m(this,qe,y(!1));m(this,Ge,y(!1));m(this,Ve,y(null));m(this,Ye,y(null));m(this,Qe,y(ge([])));m(this,We,y(0));m(this,Xe,y(null));m(this,Je,y(ge(new Set)));m(this,Ke,y(2));m(this,Ze,y(ge([])));m(this,et,y(Jt));m(this,tt,y(!1));m(this,st,y(!1));m(this,rt,y(null));m(this,it,y(null));m(this,at,y(300));m(this,ot,y(!1));m(this,nt,y(!1));m(this,lt,y(!1));m(this,ct,y(""));m(this,dt,y(null));m(this,ut,y(null));m(this,ht,y(0));m(this,vt,y(0));m(this,gt,y(ge(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))));m(this,ft,y(""));m(this,mt,y(!1));m(this,yt,y(""));m(this,pt,y(!1));m(this,kt,y(null));m(this,wt,y(""));m(this,bt,y(!1));m(this,St,y(null));m(this,_t,y(null));m(this,It,y(null));m(this,xt,y(null));m(this,Tt,y(null));m(this,Ct,y(void 0));m(this,Mt,y(ge(new Map)));m(this,Ft,y(!1));m(this,Et,y(ge([])));m(this,At,y(!1));m(this,Lt,y(!1));m(this,Dt,y(""));m(this,Ot,y(!1));m(this,Pt,y(!1));m(this,Rt,y(null));m(this,Nt,y(!1));m(this,Bt,y(null));m(this,zt,y(null));m(this,Ut,y(null));m(this,Ht,y(ge([])));l(this,"init",async()=>{{this.applyTheme(),this.loadFavourites(),this.loadArchivedCuratedFeeds(),await this.initializeSync(),this.selectedMediaSource===N&&await this.loadCategories(),this.mouseX=0,this.mouseY=0,document.addEventListener("mousemove",b=>{this.mouseX=b.clientX,this.mouseY=b.clientY,document.querySelectorAll(".nav-button").forEach(S=>{S.classList.add("visible")}),this.resetInactivityTimer()});const e=new URLSearchParams(window.location.search),t=localStorage.getItem("bijukaru_message");t&&(this.showUrlMessage(t),localStorage.removeItem("bijukaru_message"));const s=e.get("message");if(s){this.showUrlMessage(decodeURIComponent(s)),e.delete("message");const b=window.location.pathname+(e.toString()?"?"+e.toString():"");Ks(b.toString(),{})}await this.loadMediaSources();const i=e.get("media_source");i&&(this.selectedMediaSource=i),await this.loadCategories();const n=e.get("category");if(n)this.selectedCategory=n,this.categoryIndex=Math.max(0,this.categories.findIndex(b=>b.id===n));else if(this.categories.length>0&&this.categories[0].id){this.selectedCategory=this.categories[0].id,this.categoryIndex=0;const b=new URL(window.location.href);b.searchParams.set("category",this.selectedCategory),Ks(b.toString(),{})}this.targetImageId=e.get("image_id");const o=e.get("interval");if(o&&!isNaN(Number(o))){const b=parseInt(o);this.slideInterval=b>0?b*1e3:0,this.originalInterval=this.slideInterval}const h=e.get("paused");(h==="true"||h==="1")&&(this.isPaused=!0,this.originalInterval=this.slideInterval,this.slideInterval=0);const v=e.get("hd");(v==="true"||v==="1")&&(this.isHD=!0);const w=e.get("prefetch");w&&!isNaN(Number(w))&&(this.nToPrefetch=Math.min(10,Math.max(0,parseInt(w))));const g=e.get("fullscreen");(g==="true"||g==="1")&&(this.hideToolbar=!0);const C=e.get("showDescription");(C==="true"||C==="1")&&(this.showDescription=!0),document.addEventListener("keydown",b=>{if(this.showSearchOverlay){b.key==="Escape"&&this.closeSearchOverlay();return}this.handleKeyDown(b)});const _=document.querySelector(".gallery-image");_&&(_.addEventListener("touchstart",()=>{this.mediaSourceOverlayTimeoutId&&clearTimeout(this.mediaSourceOverlayTimeoutId),this.mediaSourceOverlayTransitionId&&clearTimeout(this.mediaSourceOverlayTransitionId),this.showMediaSourceOverlay=!1,this.showControls(),this.resetInactivityTimer()}),_.addEventListener("click",()=>{this.resetInactivityTimer()}),_.addEventListener("mouseenter",()=>{this.showControls()}),_.addEventListener("mouseleave",b=>{const S=b.relatedTarget;S&&(S.classList.contains("category-nav-button")||S.closest(".category-nav-button"))||setTimeout(this.hideControls,1e3)}),_.addEventListener("touchstart",()=>{this.isPaused||(this.wasPlayingBeforeTouch=!0,this.togglePause())}),_.addEventListener("touchend",()=>{this.wasPlayingBeforeTouch&&(this.wasPlayingBeforeTouch=!1,this.togglePause())})),document.querySelectorAll(".category-nav-button").forEach(b=>{b.addEventListener("mouseenter",()=>{this.showControls()}),b.addEventListener("mouseleave",A=>{const f=A.relatedTarget;f&&(f.classList.contains("category-nav-button")||f.classList.contains("nav-button")||f.closest(".nav-button")||f.closest(".category-nav-button"))||setTimeout(this.hideControls,1e3)})}),await this.loadCategory();const E=e.get("token");if(E)this.verifyAndStoreToken(E);else{const b=localStorage.getItem("searchToken");b&&(this.searchToken=b,this.verifyToken(!1))}this.loadLikedImages(),this.loadArchivedCuratedFeeds()}});l(this,"handleImageError",e=>{e.target.src="https://placehold.co/600x400?text=Image+Not+Available"});l(this,"updateDocumentTitle",()=>{let e="Bijukaru picture carousel";const t=this.mediaSources.find(s=>s.id===this.selectedMediaSource);t&&(e=`${t.name} - ${e}`),this.showFavourites?e=`â­ Favourites - ${e}`:this.showLikedImages?e=`â¤ï¸ Liked Images - ${e}`:this.currentItem&&(e=`${this.currentItem.title} - ${e}`),document.title=e});l(this,"updateURL",()=>{var e,t;try{const s=new URL(window.location.href);s.searchParams.set("media_source",this.selectedMediaSource),!this.showFavourites&&this.selectedCategory?s.searchParams.set("category",this.selectedCategory):s.searchParams.delete("category"),(e=this.currentItem)!=null&&e.id?s.searchParams.set("image_id",this.currentItem.id):s.searchParams.delete("image_id"),this.slideInterval!==1e4?s.searchParams.set("interval",String(this.slideInterval/1e3)):s.searchParams.delete("interval"),this.isHD?s.searchParams.set("hd","true"):s.searchParams.delete("hd"),this.hideToolbar?s.searchParams.set("fullscreen","true"):s.searchParams.delete("fullscreen"),this.showDescription?s.searchParams.set("showDescription","true"):s.searchParams.delete("showDescription"),Zs(s.toString(),{mediaSource:this.selectedMediaSource,category:this.selectedCategory,imageId:(t=this.currentItem)==null?void 0:t.id})}catch(s){console.error("Error updating URL:",s)}});l(this,"getPrevCategoryName",()=>{var t;if(this.categories.length===0)return"";const e=(this.categoryIndex-1+this.categories.length)%this.categories.length;return((t=this.categories[e])==null?void 0:t.name)||""});l(this,"getNextCategoryName",()=>{var t;if(this.categories.length===0)return"";const e=(this.categoryIndex+1)%this.categories.length;return((t=this.categories[e])==null?void 0:t.name)||""});l(this,"getCurrentCategoryName",()=>{var t;if(this.showFavourites&&((t=this.currentItem)!=null&&t.sourceCategory))return this.currentItem.sourceCategory;if(this.category)return this.category.name;if(!this.selectedCategory||this.categories.length===0)return"";const e=this.categories.find(s=>s.id===this.selectedCategory);return e?e.name:""});l(this,"nextItem",()=>{this.direction="next",this.currentIndex=(this.currentIndex+1)%this.items.length,document.querySelectorAll(".category-nav-button").forEach(t=>{t.classList.remove("visible")}),this.showMediaSourceOverlay=!1,this.updateDocumentTitle(),this.updateURL(),this.prefetchNextImages(),this.stopAutoSlide(),this.startAutoSlide()});l(this,"prevItem",()=>{this.stopAutoSlide(),this.direction="prev",this.currentIndex=(this.currentIndex-1+this.items.length)%this.items.length,document.querySelectorAll(".category-nav-button").forEach(t=>{t.classList.remove("visible")}),this.showMediaSourceOverlay=!1,this.updateDocumentTitle(),this.updateURL(),this.prefetchNextImages(),this.startAutoSlide()});l(this,"startAutoSlide",()=>{if(this.autoSlideIntervalId&&(clearInterval(this.autoSlideIntervalId),this.autoSlideIntervalId=null),this.isPaused||this.slideInterval===0){this.progressBar&&(this.progressBar.style.width="0%",this.progressAnimation&&(cancelAnimationFrame(this.progressAnimation),this.progressAnimation=null));return}this.autoSlideIntervalId=setInterval(()=>{this.nextItem()},this.slideInterval),this.animateProgressBar()});l(this,"stopAutoSlide",()=>{this.autoSlideIntervalId&&(clearInterval(this.autoSlideIntervalId),this.autoSlideIntervalId=null),this.progressBar&&(this.progressBar.style.width="0%",this.progressAnimation&&(cancelAnimationFrame(this.progressAnimation),this.progressAnimation=null))});l(this,"animateProgressBar",()=>{if(this.progressBar){if(this.progressBar.style.width="0%",this.slideInterval===0)return;this.progressAnimation&&(cancelAnimationFrame(this.progressAnimation),this.progressAnimation=null);const e=performance.now(),t=this.slideInterval,s=i=>{const n=i-e,o=Math.min(n/t*100,100);this.progressBar&&(this.progressBar.style.width=`${o}%`),n<t&&(this.progressAnimation=requestAnimationFrame(s))};this.progressAnimation=requestAnimationFrame(s)}});l(this,"togglePause",()=>{this.isPaused=!this.isPaused,this.isPaused?(this.slideInterval>0&&(this.originalInterval=this.slideInterval),this.stopAutoSlide(),this.slideInterval=0):(this.slideInterval=this.originalInterval>0?this.originalInterval:1e4,this.startAutoSlide()),this.updateURL()});l(this,"toggleFullscreen",()=>{document.fullscreenElement?this.exitFullscreen():document.documentElement.requestFullscreen().then(()=>{this.isFullscreen=!0,this.hideToolbar=!0}).catch(e=>{console.error("Failed to enter fullscreen mode:",e),this.hideToolbar=!0}),this.updateURL()});l(this,"exitFullscreen",()=>{if(document.fullscreenElement&&document.exitFullscreen)try{document.exitFullscreen().then(()=>{this.isFullscreen=!1}).catch(e=>{console.error("Failed to exit fullscreen mode:",e),this.isFullscreen=!1})}catch(e){console.error("Error exiting fullscreen:",e),this.isFullscreen=!1}this.hideToolbar=!1,this.updateURL()});l(this,"prefetchNextImages",()=>{this.prefetchDebounceTimerId&&clearTimeout(this.prefetchDebounceTimerId),this.prefetchDebounceTimerId=setTimeout(()=>{if(this.items.length)for(let e=1;e<=this.nToPrefetch;e++){const t=(this.currentIndex+e)%this.items.length,s=this.items[t];if(s&&s.image_url&&!this.prefetchedImages.has(s.image_url)){const i=new Image;i.src=s.image_url,this.prefetchedImages.add(s.image_url),console.log("Prefetched image:",s.image_url)}}},this.prefetchDebounceDelay)});l(this,"toggleDarkMode",()=>{this.darkMode=!this.darkMode,this.applyTheme(!1),localStorage.setItem("darkMode",String(this.darkMode))});l(this,"applyTheme",(e=!0)=>{if(e){const t=localStorage.getItem("darkMode");t!==null&&(this.darkMode=t==="true")}this.darkMode?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")});l(this,"showControls",()=>{const e=document.querySelector(".exit-fullscreen-btn"),t=document.querySelectorAll(".nav-button");console.log("showControls called, found buttons:",t.length),this.isFullscreen&&e&&e.classList.add("visible"),t.forEach(s=>{s.classList.add("visible")}),this.resetInactivityTimer()});l(this,"hideControls",()=>{const e=document.querySelector(".exit-fullscreen-btn"),t=document.querySelectorAll(".nav-button");Array.from(t).some(i=>{const n=i.getBoundingClientRect(),o=this.mouseX,h=this.mouseY;return o>=n.left&&o<=n.right&&h>=n.top&&h<=n.bottom})||(e&&e.classList.remove("visible"),t.forEach(i=>{i.classList.remove("visible")}))});l(this,"resetInactivityTimer",()=>{this.inactivityTimeoutId&&clearTimeout(this.inactivityTimeoutId),this.inactivityTimeoutId=setTimeout(()=>{this.hideControls()},1e3)});l(this,"loadCategories",async()=>{this.error=null,this.loading=!0;try{if(this.selectedMediaSource===N){const e=[{id:pe,name:"Favourites"},{id:de,name:"Liked Images"},...this.archivedCuratedFeeds.map(t=>({id:t.id,name:t.name}))];this.categories=e,!this.showFavourites&&!this.showLikedImages&&(!this.selectedCategory||!e.find(t=>t.id===this.selectedCategory))?this.selectedCategory=pe:this.showFavourites?this.selectedCategory=pe:this.showLikedImages&&(this.selectedCategory=de),this.categoryIndex=Math.max(0,this.categories.findIndex(t=>t.id===this.selectedCategory)),this.category=this.categories[this.categoryIndex]}else{const e=await fetch(`/api/${this.selectedMediaSource}/categories`);if(!e.ok)throw new Error("Failed to fetch categories");this.categories=await e.json(),this.categories.length>0&&(!this.selectedCategory||!this.categories.find(t=>t.id===this.selectedCategory))&&(this.selectedCategory=this.categories[0].id,this.categoryIndex=0,this.category=this.categories[0])}}catch(e){console.error("Error loading categories:",e),this.error=e.message||"Error loading categories",this.categories=[{id:"",name:"Error"}]}finally{this.loading=!1}});l(this,"loadCategory",async()=>{var e;if(this.error=null,this.selectedMediaSource===N){if(this.selectedCategory===pe)return this.showFavourites=!0,this.showLikedImages=!1,this.loadAllFavourites();if(this.selectedCategory===de)return this.showLikedImages=!0,this.showFavourites=!1,this.loadLikedImagesView();if(this.showLikedImages=!1,this.showFavourites=!1,this.items.length===0&&((e=this.category)==null?void 0:e.id)===this.selectedCategory){const t=this.archivedCuratedFeeds.find(s=>s.id===this.selectedCategory);if(t)return console.log(`Reloading curated feed: ${t.name}`),this._loadSpecificCuratedFeed(t);console.warn(`Selected category ${this.selectedCategory} looks like a curated feed ID, but not found in archive.`),this.error=`Cannot load curated feed: ${this.selectedCategory}`,this.loading=!1;return}else if(this.selectedMediaSource===N&&![pe,de].includes(this.selectedCategory)){this.showLikedImages=!1,this.showFavourites=!1;const t=this.archivedCuratedFeeds.find(s=>s.id===this.selectedCategory);if(t){console.log(`Loading archived curated feed: ${t.name}`),this._loadSpecificCuratedFeed(t);return}else{console.warn(`Selected category ${this.selectedCategory} not found in archived feeds.`),this.error=`Could not load archived feed: ${this.selectedCategory}`,this.items=[],this.loading=!1;return}}}else this.showFavourites=!1,this.showLikedImages=!1;this.loading=!0,this.stopAutoSlide(),this.prefetchedImages.clear(),this.progressBar&&(this.progressBar.style.width="0%"),this.selectedCategory||(this.selectedCategory=this.categories[0].id);try{let t=`/api/${this.selectedMediaSource}/feed`;this.selectedCategory&&(t+=`?category=${this.selectedCategory}`),this.isHD&&(t+=(t.includes("?")?"&":"?")+"hd=true");const s=await fetch(t);if(!s.ok)throw new Error("Failed to fetch RSS feed");const i=await s.json();if(this.items=i.items,this.category=i.category,["apod","reddit"].includes(this.selectedMediaSource)||this.shuffleArray(this.items),this.currentIndex=0,this.targetImageId&&this.items.length>0){const n=this.items.findIndex(o=>o.id===this.targetImageId);n!==-1&&(this.currentIndex=n),this.targetImageId=null}this.items.length===0?this.error="No images found in the feed":(this.showTemporaryMediaSourceOverlay(),this.updateDocumentTitle(),this.updateURL(),this.prefetchNextImages(),this.startAutoSlide())}catch(t){console.error("Error:",t),this.error="Failed to load gallery. Please try again later."}finally{this.loading=!1}});l(this,"showTemporaryMediaSourceOverlay",()=>{var e;this.isMobile||(this.mediaSourceOverlayTimeoutId&&clearTimeout(this.mediaSourceOverlayTimeoutId),this.mediaSourceOverlayTransitionId&&clearTimeout(this.mediaSourceOverlayTransitionId),(e=this.mediaSources.find(t=>t.id===this.selectedMediaSource))==null||e.name,this.getCurrentCategoryName(),this.mediaSourceOverlayText=`

                    `,this.showMediaSourceOverlay=!0,this.mediaSourceOverlayTimeoutId=setTimeout(()=>{this.mediaSourceOverlayTransitionId=setTimeout(()=>{this.showMediaSourceOverlay=!1},300)},2e3))});l(this,"shuffleArray",e=>{for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e});l(this,"handleKeyDown",e=>{if(this.showSearchOverlay||document.activeElement&&["input","textarea","select"].includes(document.activeElement.tagName.toLowerCase())){e.key==="Escape"&&this.showSearchOverlay&&(this.closeSearchOverlay(),e.preventDefault(),e.stopPropagation());return}if(this.showHelp&&e.key==="Escape"){this.showHelp=!1,e.preventDefault(),e.stopPropagation();return}switch(e.key){case"ArrowRight":this.nextItem();break;case"ArrowLeft":this.prevItem();break;case"Enter":this.currentItem&&this.currentItem.link&&window.open(this.currentItem.link,"_blank");break;case"ArrowUp":this.prevCategory();break;case"ArrowDown":this.nextCategory();break;case"PageUp":this.prevMediaSource();break;case"PageDown":this.nextMediaSource();break;case"h":case"H":this.showHelp=!this.showHelp;break;case"p":case"P":this.togglePause();break;case"f":case"F":this.toggleFullscreen();break;case"d":case"D":this.showDescription=!this.showDescription;break;case"Escape":this.exitFullscreen();break;case"/":this.isSearchAuthorized&&(this.openSearchOverlay(),e.preventDefault());break;case"s":case"S":this.toggleFavourite();break;case"l":case"L":this.toggleLikeImage();break;case"y":case"Y":this.openSyncOverlay();break}});l(this,"prevCategory",()=>{if(this.categories.length===0)return"";this.categoryIndex=(this.categoryIndex-1+this.categories.length)%this.categories.length,this.selectedCategory=this.categories[this.categoryIndex].id,this.loadCategory()});l(this,"nextCategory",()=>{if(this.categories.length===0)return"";this.categoryIndex=(this.categoryIndex+1)%this.categories.length,this.selectedCategory=this.categories[this.categoryIndex].id,this.loadCategory()});l(this,"showUrlMessage",e=>{this.overlayMessage=e,this.showMessageOverlay=!0,setTimeout(()=>{this.showMessageOverlay=!1},5e3)});l(this,"loadMediaSources",async()=>{var e,t,s;this.loading=!0,this.error=null;try{const i=await fetch("/api/media_sources");if(!i.ok)throw new Error(`Failed to load media sources: ${i.statusText}`);const n=await i.json();this.mediaSources=[...n,{id:N,name:"All Sources",hdSupported:!0}];const h=new URLSearchParams(window.location.search).get("media_source");if(h&&this.mediaSources.find(v=>v.id===h))this.selectedMediaSource=h;else if(this.mediaSources.length>0&&!this.mediaSources.find(v=>v.id===this.selectedMediaSource)){const v=this.mediaSources.find(w=>w.id==Jt);this.selectedMediaSource=v?v.id:((e=this.mediaSources[0])==null?void 0:e.id)||""}else if(this.mediaSources.length>0&&this.selectedMediaSource===N&&!h){const v=this.mediaSources.find(w=>w.id==Jt);this.selectedMediaSource=v?v.id:((t=this.mediaSources[0])==null?void 0:t.id)||""}this.hdSupported=((s=this.mediaSources.find(v=>v.id===this.selectedMediaSource))==null?void 0:s.hdSupported)||!1}catch(i){this.error=i.message,this.mediaSources=[{id:N,name:"All Sources",hdSupported:!0}]}finally{this.loading=!1}});l(this,"verifyAndStoreToken",async e=>{if(this.searchToken=e,await this.verifyToken(!0),this.isSearchAuthorized){localStorage.setItem("searchToken",e);const t=new URL(window.location.href);t.searchParams.delete("token"),window.history.replaceState({},"",t),this.overlayMessage="Search feature unlocked!",this.showMessageOverlay=!0,setTimeout(()=>{this.showMessageOverlay=!1},3e3)}});l(this,"verifyToken",async(e=!0)=>{if(!this.searchToken)return e&&(this.tokenError="Token is required"),!1;try{const t=await fetch(`/api/verify_token?token=${encodeURIComponent(this.searchToken)}`),s=await t.json();return t.ok&&s.authorized?(this.isSearchAuthorized=!0,this.tokenError=null,!0):(this.isSearchAuthorized=!1,e&&(this.tokenError=s.error||"Invalid token"),!1)}catch(t){return console.error("Token verification error:",t),this.isSearchAuthorized=!1,e&&(this.tokenError="Failed to verify token"),!1}});l(this,"openSearchOverlay",()=>{this.showSearchOverlay=!0,this.error=null,this.tokenError=null,setTimeout(()=>{const e=document.getElementById("search-input"),t=document.getElementById("token-input");this.isSearchAuthorized&&e?e.focus():t&&t.focus()},0)});l(this,"closeSearchOverlay",()=>{this.showSearchOverlay=!1,this.searchQuery="",this.error=null,this.tokenError=null});l(this,"nextMediaSource",()=>{if(this.mediaSources.length<=1)return;const t=(this.mediaSources.findIndex(s=>s.id===this.selectedMediaSource)+1)%this.mediaSources.length;this.selectedMediaSource=this.mediaSources[t].id,this.changeMediaSource()});l(this,"prevMediaSource",()=>{if(this.mediaSources.length<=1)return;const t=(this.mediaSources.findIndex(s=>s.id===this.selectedMediaSource)-1+this.mediaSources.length)%this.mediaSources.length;this.selectedMediaSource=this.mediaSources[t].id,this.changeMediaSource()});l(this,"performSearch",async()=>{if(!(!this.isSearchAuthorized&&!await this.verifyToken())&&this.searchQuery.trim()){this.loading=!0,this.error=null;try{const t=["story","narrative","curate","tell me about","life of","teach me about"].some(h=>this.searchQuery.toLowerCase().includes(h)),s=localStorage.getItem("searchToken")||this.searchToken;let i;t?(console.log("Performing curation query..."),i=`/api/curate?query=${encodeURIComponent(this.searchQuery)}&token=${encodeURIComponent(s)}`):(console.log("Performing standard search query..."),i=`/api/search?query=${encodeURIComponent(this.searchQuery)}&token=${encodeURIComponent(s)}`);const n=await fetch(i),o=await n.json();if(!n.ok)throw new Error(o.error||`HTTP error ${n.status}`);if(this.closeSearchOverlay(),t)if(console.log("Received curated feed:",o),o.items&&o.category){this.selectedMediaSource!==N&&(this.previousSelectedMediaSource=this.selectedMediaSource,this.previousSelectedCategory=this.selectedCategory),this.selectedMediaSource=N,this.items=o.items;const h=this.searchQuery,v={id:o.category.id,name:o.category.name};this.category=v,this.categories=[v],this.categoryIndex=0;const w=this.archivedCuratedFeeds.findIndex(C=>C.id===v.id),g={id:v.id,name:v.name,originalQuery:h,items:o.items,userfriendly_message:o.userfriendly_message};w>-1?this.archivedCuratedFeeds[w]=g:this.archivedCuratedFeeds.push(g),this.archivedCuratedFeeds=[...this.archivedCuratedFeeds],this.saveArchivedCuratedFeeds(),this.selectedCategory=v.id,this.showFavourites=!1,this.showLikedImages=!1,this.currentIndex=0,this.items.length===0?this.error="Curated feed is empty.":this.error=null,this.updateProgressBar(),o.userfriendly_message&&this.showUrlMessage(o.userfriendly_message),o.llm_thinking&&console.log("LLM Thinking:",o.llm_thinking),this.updateURL(),this.updateDocumentTitle(),this.prefetchNextImages(),this.startAutoSlide()}else throw new Error("Invalid curated feed response from server.");else if(console.log("Search successful, received URL:",o.url),o.url)o.userfriendly_message&&localStorage.setItem("bijukaru_message",o.userfriendly_message),window.location.href=o.url;else throw new Error("Invalid search response from server.")}catch(e){console.error("Search/Curation error:",e),this.error=e.message||"An error occurred during the search/curation."}finally{this.loading=!1}}});l(this,"changeMediaSource",async e=>{const t=e??this.selectedMediaSource,s=this.selectedMediaSource;if(s===N&&t!==N)if(console.log("Switching FROM custom source TO regular source:",t),this.showFavourites=!1,this.showLikedImages=!1,this.previousSelectedMediaSource&&this.previousSelectedCategory){console.log("Restoring previous state:",this.previousSelectedMediaSource,this.previousSelectedCategory),this.selectedMediaSource=this.previousSelectedMediaSource,this.selectedCategory=this.previousSelectedCategory,this.previousSelectedMediaSource=null,this.previousSelectedCategory=null,await this.loadCategory();return}else console.log("No previous state to restore, proceeding with target:",t),this.selectedMediaSource=t;else if(t===N&&s!==N){console.log("Switching TO custom source FROM regular source:",s),this.previousSelectedMediaSource=s,this.previousSelectedCategory=this.selectedCategory,this.selectedMediaSource=N,this.showFavourites=!1,this.showLikedImages=!1,await this.loadCategories(),await this.loadCategory(),this.updateURL();return}console.log("Proceeding with regular source change or fallthrough:",t),this.selectedMediaSource=t,this.loading=!0,this.error=null;try{const i=new URLSearchParams(window.location.search);i.delete("image_id"),i.delete("category"),i.delete("media_source"),this.selectedCategory="",this.categoryIndex=0,this.targetImageId=null;const n=this.mediaSources.find(v=>v.id===this.selectedMediaSource);this.hdSupported=(n==null?void 0:n.hdSupported)!==void 0?n.hdSupported:!1,this.slideInterval!==1e4&&i.set("interval",String(this.slideInterval/1e3)),this.isHD&&i.set("hd","true"),this.nToPrefetch!==2&&i.set("prefetch",String(this.nToPrefetch)),this.hideToolbar&&i.set("fullscreen","true"),this.showDescription&&i.set("showDescription","true");const o=`/?media_source=${t}&${i.toString()}`;Zs(o,{mediaSource:this.selectedMediaSource});const h=this.mediaSources.find(v=>v.id===this.selectedMediaSource);h&&(document.title=`${h.name} - Bijukaru picture carousel`),await this.loadCategories(),await this.loadCategory(),this.updateURL()}catch(i){console.error("Error changing media source:",i),this.error="Failed to change media source. Please try again later."}finally{this.loading=!1}});l(this,"refreshRandomArtist",()=>{this.selectedCategory==="random-artist"&&this.loadCategory()});l(this,"toggleHD",()=>{var t;const e=(t=this.currentItem)==null?void 0:t.id;this.isHD=!this.isHD,this.loadCategory().then(()=>{if(e){const s=this.items.findIndex(i=>i.id===e);s!==-1&&(this.currentIndex=s,this.updateDocumentTitle(),this.updateURL())}}),this.updateURL()});l(this,"loadFavourites",()=>{try{const e=localStorage.getItem("galleryFavourites");if(e){const t=JSON.parse(e),s=new Map;Object.keys(t).forEach(i=>{s.set(i,new Set(t[i]))}),this.favourites=s}}catch(e){console.error("Error loading favourites:",e)}});l(this,"saveFavourites",()=>{try{const e={};this.favourites.forEach((t,s)=>{e[s]=Array.from(t)}),localStorage.setItem("galleryFavourites",JSON.stringify(e))}catch(e){console.error("Error saving favourites:",e)}});l(this,"toggleFavourite",(e,t)=>{var o,h;const s=t||this.showFavourites&&((o=this.currentItem)==null?void 0:o.media_source)||this.selectedMediaSource,i=e||this.showFavourites&&((h=this.currentItem)==null?void 0:h.category_id)||this.selectedCategory;if(!i||!s){console.warn("Cannot toggle favourite: missing category or media source");return}this.favourites.has(s)||this.favourites.set(s,new Set);const n=this.favourites.get(s);if(n.has(i)){if(n.delete(i),this.showUrlMessage("Removed from favourites"),n.size===0&&this.favourites.delete(s),this.showFavourites)if(this.loadAllFavourites(),this.hasFavourites())this.currentIndex=Math.max(0,Math.min(this.currentIndex,this.items.length-1)),this.updateDocumentTitle(),this.updateURL(),this.stopAutoSlide(),this.startAutoSlide();else{this.showFavourites=!1,this.selectedMediaSource=this.previousSelectedMediaSource||Jt,this.selectedCategory=this.previousSelectedCategory||"",this.previousSelectedMediaSource=null,this.previousSelectedCategory=null,this.loadCategory(),this.showUrlMessage("No more favourites. Returning to main gallery."),this.updateDocumentTitle(),this.stopAutoSlide();return}}else n.add(i),this.showUrlMessage("Added to favourites");this.favourites=new Map(this.favourites),this.saveFavourites(),this.syncInitialized&&K.updateFavourites(this.favourites)});l(this,"isFavourite",(e,t)=>{var n,o;const s=t||this.showFavourites&&((n=this.currentItem)==null?void 0:n.media_source)||this.selectedMediaSource,i=e||this.showFavourites&&((o=this.currentItem)==null?void 0:o.category_id)||this.selectedCategory;return!i||!s?!1:this.favourites.has(s)&&this.favourites.get(s).has(i)});l(this,"loadAllFavourites",async()=>{var t,s;const e=this.showFavourites;this.loading=!0,this.error=null;try{const i=Array.from(this.favourites.keys());if(i.length===0){this.showUrlMessage('No favourite categories found. Add categories to your favourites by pressing "s" key or the star icon.');return}this.showFavourites=!0,this.items=[];let n=[];for(const o of i){let h=[];if(o===N)h=[{id:de,name:"Liked"}],Array.from(this.favourites.get(N)).includes(de)&&(n=[...n,...this.likedImages.map(v=>({...v,sourceCategory:"Bijukaru - Liked",media_source:N,category_id:de}))]);else{try{const w=await fetch(`/api/${o}/categories`);w.ok?h=await w.json():console.warn(`Could not fetch categories for source ${o} during favourite loading. Status: ${w.status}`)}catch(w){console.warn(`Error fetching categories for source ${o} in loadAllFavourites:`,w)}const v=Array.from(this.favourites.get(o));for(const w of v){const g=`/api/${o}/feed?category=${w}${this.isHD?"&hd=true":""}`,C=await fetch(g);if(!C.ok){console.warn(`Failed to load favourites from ${o}/${w}: ${C.statusText}`);continue}const _=await C.json();if(_.items&&Array.isArray(_.items)){const E=((t=this.mediaSources.find(S=>S.id===o))==null?void 0:t.name)||o,b=((s=h.find(S=>S.id===w))==null?void 0:s.name)||w,A=_.items.map(S=>({...S,sourceCategory:`${E} - ${b}`,media_source:o,category_id:w}));n=[...n,...A]}}}}if(n.length===0){this.showUrlMessage('No favourite categories found. Add categories to your favourites by pressing "s" key or the star icon.'),this.showFavourites=e;return}this.items=this.shuffleArray(n),this.currentIndex=0,this.isPaused||this.startAutoSlide(),this.updateDocumentTitle()}catch(i){console.error("Error loading all favourites:",i),this.error=i.message||"Failed to load favourites",this.showFavourites=e}finally{this.loading=!1}});l(this,"toggleShowFavourites",()=>{var t,s;if(!this.showFavourites){if(!(this.favourites.size>0&&Array.from(this.favourites.values()).some(n=>n.size>0))){this.showUrlMessage('No favourite categories found. Add categories to your favourites by pressing "s" key or the star icon.');return}this.selectedMediaSource!==N&&(this.previousSelectedMediaSource=this.selectedMediaSource,this.previousSelectedCategory=this.selectedCategory),this.showFavourites=!0,this.showLikedImages=!1,this.selectedMediaSource=N,this.categories=[{id:pe,name:"Favourites"}],this.selectedCategory=pe,this.category=this.categories[0],this.categoryIndex=0,this.loadAllFavourites()}else this.showFavourites=!1,this.selectedMediaSource=this.previousSelectedMediaSource||((t=this.mediaSources.find(i=>i.id!==N))==null?void 0:t.id)||((s=this.mediaSources[0])==null?void 0:s.id)||"",this.selectedCategory=this.previousSelectedCategory||"",this.previousSelectedMediaSource=null,this.previousSelectedCategory=null,this.loadCategory();this.updateURL()});l(this,"loadLikedImages",()=>{try{const e=localStorage.getItem("galleryLikedImages");e&&(this.likedImages=JSON.parse(e))}catch(e){console.error("Error loading liked images:",e)}});l(this,"saveLikedImages",()=>{try{localStorage.setItem("galleryLikedImages",JSON.stringify(this.likedImages))}catch(e){console.error("Error saving liked images:",e)}});l(this,"toggleLikeImage",()=>{const e=this.currentItem;if(!e)return;const t=this.likedImages.findIndex(s=>s.id===e.id);t!==-1?(this.likedImages.splice(t,1),this.showUrlMessage("Removed from liked images")):(this.likedImages.push(e),this.showUrlMessage("Added to liked images")),this.saveLikedImages(),this.syncInitialized&&K.updateLikedImages(this.likedImages)});l(this,"isImageLiked",()=>this.currentItem?this.likedImages.some(e=>{var t;return e.id===((t=this.currentItem)==null?void 0:t.id)}):!1);l(this,"loadLikedImagesView",async()=>{const e=this.showLikedImages;this.showLikedImages=!0,this.loading=!0,this.error=null;try{if(this.likedImages.length===0)throw new Error("No liked images found");this.items=[...this.likedImages],this.currentIndex=0,this.isPaused||this.startAutoSlide(),this.updateDocumentTitle()}catch(t){console.error("Error loading liked images:",t),this.error=t.message||"Failed to load liked images",this.showLikedImages=e}finally{this.loading=!1}});l(this,"toggleShowLikedImages",()=>{var t,s;const e=!this.showLikedImages;this.showLikedImages=e,this.showFavourites=!1,e?(this.selectedMediaSource!==N&&(this.previousSelectedMediaSource=this.selectedMediaSource,this.previousSelectedCategory=this.selectedCategory),this.selectedMediaSource=N,this.categories=[{id:de,name:"Liked Images"}],this.selectedCategory=de,this.category=this.categories[0],this.categoryIndex=0,this.loadLikedImagesView()):(this.selectedMediaSource=this.previousSelectedMediaSource||((t=this.mediaSources.find(i=>i.id!==N))==null?void 0:t.id)||((s=this.mediaSources[0])==null?void 0:s.id)||"",this.selectedCategory=this.previousSelectedCategory||"",this.previousSelectedMediaSource=null,this.previousSelectedCategory=null,this.loadCategory()),this.updateURL()});l(this,"updateProgressBar",()=>{this.animateProgressBar()});l(this,"loadArchivedCuratedFeeds",()=>{const e=localStorage.getItem("galleryArchivedCuratedFeeds");if(e)try{this.archivedCuratedFeeds=JSON.parse(e)}catch(t){console.error("Failed to parse archived curated feeds",t)}});l(this,"saveArchivedCuratedFeeds",()=>{localStorage.setItem("galleryArchivedCuratedFeeds",JSON.stringify(this.archivedCuratedFeeds))});l(this,"hasFavourites",()=>this.favourites?this.favourites.size>0:!1);l(this,"hasLikedImages",()=>this.likedImages?this.likedImages.length>0:!1);l(this,"_loadSpecificCuratedFeed",e=>{this.loading=!0,this.error=null,this.selectedMediaSource!==N&&(this.previousSelectedMediaSource=this.selectedMediaSource,this.previousSelectedCategory=this.selectedCategory),this.selectedMediaSource=N,this.showFavourites=!1,this.showLikedImages=!1,this.categories=[{id:e.id,name:e.name}],this.selectedCategory=e.id,this.category=this.categories[0],this.categoryIndex=0,this.items=e.items||[],this.currentIndex=0,this.isPaused||this.startAutoSlide(),this.updateDocumentTitle(),this.updateURL(),this.loading=!1,e.userfriendly_message&&this.showUrlMessage(e.userfriendly_message)});l(this,"loadFavouritesCategory",async()=>{await this.loadAllFavourites()});l(this,"generateAndConnectDeviceToken",async()=>{try{const e=this.generateDeviceToken();return localStorage.setItem("deviceToken",e),this.deviceToken=e,await K.initializeSync(e)?(this.syncInitialized=!0,this.setupSyncListeners(),await this.pushToSync(),console.log("New device token generated and sync initialized:",e),e):(console.error("Failed to initialize sync with new token"),null)}catch(e){return console.error("Failed to generate device token:",e),null}});l(this,"connectWithDeviceToken",async e=>{try{if(e.length!==8)throw new Error("Invalid token format");return await K.initializeSync(e)?(localStorage.setItem("deviceToken",e),this.deviceToken=e,this.syncInitialized=!0,this.setupSyncListeners(),await this.pushToSync(),console.log("Connected with device token:",e),!0):(console.error("Failed to connect with device token"),!1)}catch(t){return console.error("Error connecting with device token:",t),!1}});l(this,"disconnectSync",async()=>{try{await K.disconnect(),this.syncInitialized=!1,this.deviceToken=null,localStorage.removeItem("deviceToken"),console.log("Disconnected from sync")}catch(e){console.error("Error disconnecting from sync:",e)}});l(this,"getSyncStatus",()=>({connected:this.syncInitialized&&K.isConnectedToSync(),deviceToken:this.deviceToken,hasToken:!!this.deviceToken}));l(this,"openSyncOverlay",()=>{this.showSyncOverlay=!0,this.syncError=null});l(this,"closeSyncOverlay",()=>{this.showSyncOverlay=!1,this.syncTokenInput="",this.syncError=null,this.syncGenerating=!1,this.syncConnecting=!1});l(this,"handleGenerateToken",async()=>{this.syncGenerating=!0,this.syncError=null;try{const e=await this.generateAndConnectDeviceToken();e?(this.showUrlMessage(`Device token generated: ${e}`),this.closeSyncOverlay()):this.syncError="Failed to generate token"}catch(e){console.error("Error generating token:",e),this.syncError="Failed to generate token"}finally{this.syncGenerating=!1}});l(this,"handleConnectWithToken",async()=>{if(!this.syncTokenInput||this.syncTokenInput.length!==8){this.syncError="Token must be exactly 8 characters";return}this.syncConnecting=!0,this.syncError=null;try{await this.connectWithDeviceToken(this.syncTokenInput)?(this.showUrlMessage(`Connected with token: ${this.syncTokenInput}`),this.closeSyncOverlay()):this.syncError="Failed to connect with token"}catch(e){console.error("Error connecting with token:",e),this.syncError="Failed to connect with token"}finally{this.syncConnecting=!1}});l(this,"handleDisconnectSync",async()=>{try{await this.disconnectSync(),this.showUrlMessage("Disconnected from sync"),this.closeSyncOverlay()}catch(e){console.error("Error disconnecting from sync:",e),this.syncError="Failed to disconnect from sync"}})}get loading(){return u(a(this,Le))}set loading(e){p(a(this,Le),e,!0)}get error(){return u(a(this,De))}set error(e){p(a(this,De),e,!0)}get items(){return u(a(this,Oe))}set items(e){p(a(this,Oe),e,!0)}get currentIndex(){return u(a(this,Pe))}set currentIndex(e){p(a(this,Pe),e,!0)}get autoSlideIntervalId(){return u(a(this,Re))}set autoSlideIntervalId(e){p(a(this,Re),e,!0)}get slideInterval(){return u(a(this,Ne))}set slideInterval(e){p(a(this,Ne),e,!0)}get originalInterval(){return u(a(this,Be))}set originalInterval(e){p(a(this,Be),e,!0)}get isPaused(){return u(a(this,ze))}set isPaused(e){p(a(this,ze),e,!0)}get isHD(){return u(a(this,Ue))}set isHD(e){p(a(this,Ue),e,!0)}get direction(){return u(a(this,He))}set direction(e){p(a(this,He),e,!0)}get darkMode(){return u(a(this,je))}set darkMode(e){p(a(this,je),e,!0)}get selectedCategory(){return u(a(this,$e))}set selectedCategory(e){p(a(this,$e),e,!0)}get isFullscreen(){return u(a(this,qe))}set isFullscreen(e){p(a(this,qe),e,!0)}get hideToolbar(){return u(a(this,Ge))}set hideToolbar(e){p(a(this,Ge),e,!0)}get exitBtnTimeoutId(){return u(a(this,Ve))}set exitBtnTimeoutId(e){p(a(this,Ve),e,!0)}get buttonsTimeoutId(){return u(a(this,Ye))}set buttonsTimeoutId(e){p(a(this,Ye),e,!0)}get categories(){return u(a(this,Qe))}set categories(e){p(a(this,Qe),e,!0)}get categoryIndex(){return u(a(this,We))}set categoryIndex(e){p(a(this,We),e,!0)}get inactivityTimeoutId(){return u(a(this,Xe))}set inactivityTimeoutId(e){p(a(this,Xe),e,!0)}get prefetchedImages(){return u(a(this,Je))}set prefetchedImages(e){p(a(this,Je),e,!0)}get nToPrefetch(){return u(a(this,Ke))}set nToPrefetch(e){p(a(this,Ke),e,!0)}get mediaSources(){return u(a(this,Ze))}set mediaSources(e){p(a(this,Ze),e,!0)}get selectedMediaSource(){return u(a(this,et))}set selectedMediaSource(e){p(a(this,et),e,!0)}get showHelp(){return u(a(this,tt))}set showHelp(e){p(a(this,tt),e,!0)}get showDescription(){return u(a(this,st))}set showDescription(e){p(a(this,st),e,!0)}get targetImageId(){return u(a(this,rt))}set targetImageId(e){p(a(this,rt),e,!0)}get prefetchDebounceTimerId(){return u(a(this,it))}set prefetchDebounceTimerId(e){p(a(this,it),e,!0)}get prefetchDebounceDelay(){return u(a(this,at))}set prefetchDebounceDelay(e){p(a(this,at),e,!0)}get wasPlayingBeforeTouch(){return u(a(this,ot))}set wasPlayingBeforeTouch(e){p(a(this,ot),e,!0)}get hdSupported(){return u(a(this,nt))}set hdSupported(e){p(a(this,nt),e,!0)}get showMediaSourceOverlay(){return u(a(this,lt))}set showMediaSourceOverlay(e){p(a(this,lt),e,!0)}get mediaSourceOverlayText(){return u(a(this,ct))}set mediaSourceOverlayText(e){p(a(this,ct),e,!0)}get mediaSourceOverlayTimeoutId(){return u(a(this,dt))}set mediaSourceOverlayTimeoutId(e){p(a(this,dt),e,!0)}get mediaSourceOverlayTransitionId(){return u(a(this,ut))}set mediaSourceOverlayTransitionId(e){p(a(this,ut),e,!0)}get mouseX(){return u(a(this,ht))}set mouseX(e){p(a(this,ht),e,!0)}get mouseY(){return u(a(this,vt))}set mouseY(e){p(a(this,vt),e,!0)}get isMobile(){return u(a(this,gt))}set isMobile(e){p(a(this,gt),e,!0)}get searchQuery(){return u(a(this,ft))}set searchQuery(e){p(a(this,ft),e,!0)}get showSearchOverlay(){return u(a(this,mt))}set showSearchOverlay(e){p(a(this,mt),e,!0)}get overlayMessage(){return u(a(this,yt))}set overlayMessage(e){p(a(this,yt),e,!0)}get showMessageOverlay(){return u(a(this,pt))}set showMessageOverlay(e){p(a(this,pt),e,!0)}get overlayTimeoutId(){return u(a(this,kt))}set overlayTimeoutId(e){p(a(this,kt),e,!0)}get searchToken(){return u(a(this,wt))}set searchToken(e){p(a(this,wt),e,!0)}get isSearchAuthorized(){return u(a(this,bt))}set isSearchAuthorized(e){p(a(this,bt),e,!0)}get tokenError(){return u(a(this,St))}set tokenError(e){p(a(this,St),e,!0)}get progressBar(){return u(a(this,_t))}set progressBar(e){p(a(this,_t),e,!0)}get progressAnimation(){return u(a(this,It))}set progressAnimation(e){p(a(this,It),e,!0)}get controlsTimeoutId(){return u(a(this,xt))}set controlsTimeoutId(e){p(a(this,xt),e,!0)}get progressIntervalId(){return u(a(this,Tt))}set progressIntervalId(e){p(a(this,Tt),e,!0)}get category(){return u(a(this,Ct))}set category(e){p(a(this,Ct),e,!0)}get favourites(){return u(a(this,Mt))}set favourites(e){p(a(this,Mt),e,!0)}get showFavourites(){return u(a(this,Ft))}set showFavourites(e){p(a(this,Ft),e,!0)}get likedImages(){return u(a(this,Et))}set likedImages(e){p(a(this,Et),e,!0)}get showLikedImages(){return u(a(this,At))}set showLikedImages(e){p(a(this,At),e,!0)}get showSyncOverlay(){return u(a(this,Lt))}set showSyncOverlay(e){p(a(this,Lt),e,!0)}get syncTokenInput(){return u(a(this,Dt))}set syncTokenInput(e){p(a(this,Dt),e,!0)}get syncGenerating(){return u(a(this,Ot))}set syncGenerating(e){p(a(this,Ot),e,!0)}get syncConnecting(){return u(a(this,Pt))}set syncConnecting(e){p(a(this,Pt),e,!0)}get syncError(){return u(a(this,Rt))}set syncError(e){p(a(this,Rt),e,!0)}get syncInitialized(){return u(a(this,Nt))}set syncInitialized(e){p(a(this,Nt),e,!0)}get deviceToken(){return u(a(this,Bt))}set deviceToken(e){p(a(this,Bt),e,!0)}get previousSelectedMediaSource(){return u(a(this,zt))}set previousSelectedMediaSource(e){p(a(this,zt),e,!0)}get previousSelectedCategory(){return u(a(this,Ut))}set previousSelectedCategory(e){p(a(this,Ut),e,!0)}get archivedCuratedFeeds(){return u(a(this,Ht))}set archivedCuratedFeeds(e){p(a(this,Ht),e,!0)}get currentItem(){return this.items[this.currentIndex]||null}get currentCategoryName(){if(this.showFavourites)return"Favourites";if(this.showLikedImages)return"Liked Images";{const e=this.categories[this.categoryIndex];return e?e.name:""}}get currentSourceName(){const e=this.mediaSources.find(t=>t.id===this.selectedMediaSource);return e?e.name:""}async initializeSync(){try{const e=localStorage.getItem("deviceToken");e&&(this.deviceToken=e,await K.initializeSync(e)?(this.syncInitialized=!0,this.setupSyncListeners(),console.log("Sync connected with existing token:",e)):console.warn("Failed to connect with saved token, will create new one if needed"))}catch(e){console.error("Failed to initialize sync:",e)}}setupSyncListeners(){K.addSyncListener(()=>{try{const e=K.getFavourites(),t=K.getLikedImages(),s=new Map(this.favourites);e.forEach((o,h)=>{const v=s.get(h)||new Set;o.forEach(w=>v.add(w)),s.set(h,v)}),this.favourites=s;const i=new Set(this.likedImages.map(o=>o.id)),n=t.filter(o=>!i.has(o.id));this.likedImages=[...this.likedImages,...n],this.saveFavourites(),this.saveLikedImages(),console.log("Synced data merged")}catch(e){console.error("Error handling sync update:",e)}})}async generateAndConnectDeviceToken(){try{const e=this.generateDeviceToken();return localStorage.setItem("deviceToken",e),this.deviceToken=e,await K.initializeSync(e)?(this.syncInitialized=!0,this.setupSyncListeners(),await this.pushToSync(),console.log("New device token generated and sync initialized:",e),e):(console.error("Failed to initialize sync with new token"),null)}catch(e){return console.error("Failed to generate device token:",e),null}}async connectWithDeviceToken(e){try{if(e.length!==8)throw new Error("Invalid token format");return await K.initializeSync(e)?(localStorage.setItem("deviceToken",e),this.deviceToken=e,this.syncInitialized=!0,this.setupSyncListeners(),await this.pushToSync(),console.log("Connected with device token:",e),!0):(console.error("Failed to connect with device token"),!1)}catch(t){return console.error("Error connecting with device token:",t),!1}}async pushToSync(){if(this.syncInitialized)try{K.updateFavourites(this.favourites),K.updateLikedImages(this.likedImages),console.log("Local data pushed to sync")}catch(e){console.error("Failed to push data to sync:",e)}}async disconnectSync(){try{await K.disconnect(),this.syncInitialized=!1,this.deviceToken=null,localStorage.removeItem("deviceToken"),console.log("Disconnected from sync")}catch(e){console.error("Error disconnecting from sync:",e)}}getSyncStatus(){return{connected:this.syncInitialized&&K.isConnectedToSync(),deviceToken:this.deviceToken,hasToken:!!this.deviceToken}}generateDeviceToken(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let t="";for(let s=0;s<8;s++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}}Le=new WeakMap,De=new WeakMap,Oe=new WeakMap,Pe=new WeakMap,Re=new WeakMap,Ne=new WeakMap,Be=new WeakMap,ze=new WeakMap,Ue=new WeakMap,He=new WeakMap,je=new WeakMap,$e=new WeakMap,qe=new WeakMap,Ge=new WeakMap,Ve=new WeakMap,Ye=new WeakMap,Qe=new WeakMap,We=new WeakMap,Xe=new WeakMap,Je=new WeakMap,Ke=new WeakMap,Ze=new WeakMap,et=new WeakMap,tt=new WeakMap,st=new WeakMap,rt=new WeakMap,it=new WeakMap,at=new WeakMap,ot=new WeakMap,nt=new WeakMap,lt=new WeakMap,ct=new WeakMap,dt=new WeakMap,ut=new WeakMap,ht=new WeakMap,vt=new WeakMap,gt=new WeakMap,ft=new WeakMap,mt=new WeakMap,yt=new WeakMap,pt=new WeakMap,kt=new WeakMap,wt=new WeakMap,bt=new WeakMap,St=new WeakMap,_t=new WeakMap,It=new WeakMap,xt=new WeakMap,Tt=new WeakMap,Ct=new WeakMap,Mt=new WeakMap,Ft=new WeakMap,Et=new WeakMap,At=new WeakMap,Lt=new WeakMap,Dt=new WeakMap,Ot=new WeakMap,Pt=new WeakMap,Rt=new WeakMap,Nt=new WeakMap,Bt=new WeakMap,zt=new WeakMap,Ut=new WeakMap,Ht=new WeakMap;const mr="gallery-state",ta=(r=mr)=>Ti(r),sa=(r=mr)=>xi(r,new ea);var ra=R('<span class="text-yellow-300">(requires token)</span>'),ia=R('<div class="help-overlay svelte-1k4ytib" role="dialog" aria-modal="true" aria-labelledby="help-dialog-title" tabindex="0"><div class="help-content svelte-1k4ytib"><h2 class="mb-4 font-bold text-2xl text-center">Keyboard Shortcuts</h2> <table class="shortcuts-table svelte-1k4ytib"><tbody><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">â</span></td><td class="svelte-1k4ytib">Previous image</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">â</span></td><td class="svelte-1k4ytib">Next image</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">Enter</span></td><td class="svelte-1k4ytib">Open current image link</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">â</span></td><td class="svelte-1k4ytib">Previous category</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">â</span></td><td class="svelte-1k4ytib">Next category</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">Page Up</span></td><td class="svelte-1k4ytib">Previous media source</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">Page Down</span></td><td class="svelte-1k4ytib">Next media source</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">D</span></td><td class="svelte-1k4ytib">Toggle image description</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">P</span></td><td class="svelte-1k4ytib">Pause/resume slideshow</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">F</span></td><td class="svelte-1k4ytib">Toggle fullscreen</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">Esc</span></td><td class="svelte-1k4ytib">Exit fullscreen</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">H</span></td><td class="svelte-1k4ytib">Toggle help (this screen)</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">/</span></td><td class="svelte-1k4ytib">Open search <!></td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">S</span></td><td class="svelte-1k4ytib">Toggle favourite for current category</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">L</span></td><td class="svelte-1k4ytib">Like/unlike current image</td></tr><tr><td class="svelte-1k4ytib"><span class="key svelte-1k4ytib">Y</span></td><td class="svelte-1k4ytib">Open sync settings</td></tr></tbody></table> <div class="opacity-70 mt-6 text-sm text-center">Click anywhere outside this window to close</div></div></div>'),aa=R('<div class="relative bg-red-100 dark:bg-red-900 mb-4 px-4 py-3 border border-red-400 dark:border-red-700 rounded text-red-700 dark:text-red-300"><span> </span></div>'),oa=r=>r.stopPropagation(),na=R('<div class="flex items-center text-green-400 text-sm"><svg class="mr-2 w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg> </div>'),la=R('<div class="flex items-center text-gray-400 text-sm"><svg class="mr-2 w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg> Not connected</div>'),ca=R('<div class="mt-2 text-red-400 text-sm"> </div>'),da=R('<div class="mb-6"><h3 class="mb-2 font-semibold text-gray-300">Generate New Device Token</h3> <p class="mb-4 text-gray-400 text-sm">Create a new 8-character token to share with your other devices</p> <button class="bg-blue-500 hover:bg-blue-600 disabled:bg-blue-700 px-4 py-2 rounded-md w-full text-white transition-colors cursor-pointer disabled:cursor-not-allowed"><span>Generate New Token</span> <span>Generating...</span></button></div> <div class="mb-6"><h3 class="mb-2 font-semibold text-gray-300">Connect with Existing Token</h3> <p class="mb-4 text-gray-400 text-sm">Enter an 8-character token from another device</p> <form><input type="text" placeholder="Enter 8-character token" maxlength="8" class="bg-white/90 dark:bg-gray-200/90 mb-3 px-4 py-2 border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 w-full text-gray-900"> <button type="submit" class="bg-green-500 hover:bg-green-600 disabled:bg-green-700 px-4 py-2 rounded-md w-full text-white transition-colors cursor-pointer disabled:cursor-not-allowed"><span>Connect</span> <span>Connecting...</span></button></form> <!></div>',1),ua=R('<div class="mb-6"><h3 class="mb-2 font-semibold text-gray-300">Sync Actions</h3> <button class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-md w-full text-white transition-colors cursor-pointer">Disconnect from Sync</button></div>'),ha=R('<div class="z-[100] fixed inset-0 flex justify-center items-center bg-black/65 backdrop-blur-sm p-4" role="dialog" aria-modal="true" aria-labelledby="sync-dialog-title" tabindex="0"><div class="relative bg-gray-900 dark:bg-dark-surface shadow-xl p-6 rounded-lg w-full max-w-md" role="dialog" aria-modal="true" aria-labelledby="sync-dialog-title" tabindex="0"><button class="top-4 right-4 absolute text-gray-400 hover:text-white text-xl transition-colors cursor-pointer" aria-label="Close sync settings">Ã</button> <h2 id="sync-dialog-title" class="mb-6 font-bold text-white text-xl">Sync Settings</h2> <div class="mb-6"><!></div> <!> <div class="pt-4 border-gray-700 border-t"><h3 class="mb-2 font-semibold text-gray-300 text-sm">How Sync Works</h3> <ul class="space-y-1 text-gray-400 text-xs"><li>â¢ Generate a token or use an existing one</li> <li>â¢ All devices with the same token sync automatically</li> <li>â¢ Favorites and liked images sync in real-time</li> <li>â¢ Data is stored locally as backup</li></ul></div></div></div>'),va=r=>r.stopPropagation(),ga=R('<div class="mt-2 text-red-400 text-sm"> </div>'),fa=R('<div class="mb-4"><form><label class="block mb-2 text-gray-300 text-sm" for="searchToken">Enter token to access search:</label> <input type="text" id="searchToken" placeholder="Enter token" class="bg-white/90 dark:bg-gray-200/90 px-4 py-2 border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 w-full text-gray-900"></form> <!> <div class="flex justify-center mt-5"><button class="bg-blue-500 hover:bg-blue-600 px-6 py-2 rounded-md text-white transition-colors cursor-pointer"><span>Verify</span> <span>Verifying...</span></button></div></div>'),ma=R('<div class="flex flex-row justify-center gap-4 mt-5"><input type="text" placeholder="e.g., Van Gogh starry night, story of..." class="bg-white/90 dark:bg-gray-200/90 px-4 py-2 border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 w-full text-gray-900"> <button class="bg-blue-500 hover:bg-blue-600 px-6 py-2 rounded-md text-white transition-colors cursor-pointer" title="Search or Curate" aria-label="Search or Curate gallery"><span>â¨</span> <span>Searching...</span></button></div>'),ya=R('<div class="mt-4 text-red-400 text-center"> </div>'),pa=R('<div class="z-[100] fixed inset-0 flex justify-center items-center bg-black/65 backdrop-blur-sm p-4" role="dialog" aria-modal="true" aria-labelledby="search-dialog-title" tabindex="0"><div class="relative bg-gray-900 dark:bg-dark-surface shadow-xl p-6 rounded-lg w-full max-w-md" role="dialog" aria-modal="true" aria-labelledby="search-dialog-title" tabindex="0"><button class="top-4 right-4 absolute text-gray-400 hover:text-white text-xl transition-colors cursor-pointer" aria-label="Close search">Ã</button> <!> <!></div></div>'),ka=R('<div class="z-[110] fixed inset-0 flex justify-center items-center pointer-events-none"><div class="bg-black/80 shadow-lg px-8 py-6 rounded-xl max-w-md text-white text-center"><div class="text-lg"> </div></div></div>'),wa=R('<button class="cursor-pointer exit-fullscreen-btn nav-button svelte-1k4ytib" aria-label="Exit fullscreen"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>'),ba=R('<img width="100%" height="100%" class="transition-all duration-500 gallery-image svelte-1k4ytib">'),Sa=R('<a target="_blank" class="flex-1 font-semibold hover:underline basis-1/2"><h2 class="font-semibold"> </h2></a> <button aria-label="Like/unlike current image" title="Like/unlike current image (L)"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg></button>',1),_a=R('<div class="relative max-h-[10vh] overflow-y-auto text-sm hide-scrollbar svelte-1k4ytib"><div><!></div></div>'),Ia=R("<option> </option>"),xa=R("<option> </option>"),Ta=R("<span> </span> of <span> </span>",1),Ca=R("<span></span>"),Ma=R('<div class="top-1 right-1 absolute bg-green-400 rounded-full w-2 h-2"></div>'),Fa=R('<div class="gallery-wrapper svelte-1k4ytib"><!> <div class="image-container svelte-1k4ytib"><div><div class="border-gray-700 dark:border-gray-300 border-b-2 rounded-full w-12 h-12 animate-spin"></div></div> <div class="z-9 relative flex justify-center items-center w-full h-full"><div><div class="mb-1 font-bold text-2xl"> </div> <div class="opacity-75 text-sm"> </div></div> <!> <button class="mobile-nav-area mobile-nav-prev svelte-1k4ytib" aria-label="Previous image"></button> <button class="mobile-nav-area mobile-nav-next svelte-1k4ytib" aria-label="Next image"></button> <div><button class="flex items-center bg-black/50 hover:bg-black/80 px-4 py-2 rounded-full text-white transition-all duration-300 cursor-pointer" aria-label="Previous category"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg> <span class="ml-2 svelte-1k4ytib"> </span></button></div> <div><button aria-label="Next category"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg> <span class="ml-2 svelte-1k4ytib"> </span></button> <button title="Refresh random artist" aria-label="Refresh random artist"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg></button></div> <button class="bg-black/50 hover:bg-black/80 p-2 rounded-full text-white transition-all duration-300 cursor-pointer image-nav-button image-nav-prev nav-button svelte-1k4ytib" aria-label="Previous image"><svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button> <button class="bg-black/50 hover:bg-black/80 p-2 rounded-full text-white transition-all duration-300 cursor-pointer image-nav-button image-nav-next nav-button svelte-1k4ytib" aria-label="Next image"><svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button></div> <div class="title-overlay svelte-1k4ytib"><div class="flex flex-row justify-between items-center"><!> <div><span> </span> <button aria-label="Toggle favourites" class="ml-2 focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg></button></div></div>  <!></div> <div class="progress-container svelte-1k4ytib"><div class="progress-bar svelte-1k4ytib"></div></div></div> <div><div class="flex flex-shrink items-center space-x-1 md:space-x-2"><div class="flex justify-center items-center media-source-selector"><select class="bg-white dark:bg-dark-surface px-4 py-2 border-gray-300 border-unset dark:border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 max-w-[50vw] md:max-w-none text-gray-800 dark:text-dark-text"></select></div> <div class="flex flex-shrink justify-center items-center category-selector"><select class="bg-white dark:bg-dark-surface px-4 py-2 border-gray-300 border-unset dark:border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 w-full md:max-w-[30vw] xl:max-w-none text-gray-800 dark:text-dark-text"></select></div></div> <div class="flex flex-grow justify-center items-center"><span class="text-gray-600 dark:text-gray-400 text-sm"><!></span></div> <div class="flex justify-between items-center space-x-1 md:space-x-2 w-full md:w-auto"><button title="Search ( / )" aria-label="Search gallery"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"></path></svg></button> <button aria-label="Sync settings" title="Sync settings"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path></svg> <!></button> <button aria-label="Toggle favourites view" title="Toggle favourites view"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path></svg></button> <button aria-label="View all liked images" title="View all liked images (I)"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path></svg></button> <button aria-label="Toggle slideshow" title="Pause/Resume slideshow"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6"></path></svg> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path></svg></button> <button aria-label="Toggle HD quality" title="Toggle HD images"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M3 3h18a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1m4.5 8.25V9H6v6h1.5v-2.25h2V15H11V9H9.5v2.25zm7-.75H16a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-1.5zM13 9v6h3a2 2 0 0 0 2-2v-2a2 2 0 0 0-2-2z"></path></svg></button> <button aria-label="Toggle fullscreen" title="Toggle fullscreen" class="hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full focus:outline-none text-gray-600 dark:text-gray-400 cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"></path></svg></button> <button aria-label="Toggle description" title="Toggle description"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg></button> <div class="flex items-center space-x-1"><span class="text-sm"><svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg></span> <label class="toggle-switch svelte-1k4ytib"><input type="checkbox" class="opacity-0 w-0 h-0 svelte-1k4ytib"> <span class="toggle-slider svelte-1k4ytib"></span></label> <span class="text-sm"><svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg></span></div></div></div></div>'),Ea=R('<div class="bg-gray-100 dark:bg-dark-bg text-gray-900 dark:text-dark-text transition-colors duration-300 main-container svelte-1k4ytib"><!> <!> <!> <!> <!> <!></div>');function Na(r,e){Ci(e,!0),sa();const t=ta();Mi(()=>(t.init(),()=>{t.autoSlideIntervalId&&clearInterval(t.autoSlideIntervalId),t.controlsTimeoutId&&clearTimeout(t.controlsTimeoutId),t.inactivityTimeoutId&&clearTimeout(t.inactivityTimeoutId),t.overlayTimeoutId&&clearTimeout(t.overlayTimeoutId),t.progressIntervalId&&clearInterval(t.progressIntervalId)}));var s=Ea(),i=d(s);{var n=S=>{var f=ia();f.__click=M=>{M.stopPropagation(),t.showHelp=!1},f.__keydown=M=>{M.key,t.showHelp=!1};var x=d(f),z=k(d(x),2),O=d(z),H=k(d(O),12),Q=k(d(H)),W=k(d(Q));{var G=M=>{var j=ra();P(M,j)};q(W,M=>{t.isSearchAuthorized||M(G)})}c(Q),c(H),Me(3),c(O),c(z),Me(2),c(x),c(f),P(S,f)};q(i,S=>{t.showHelp&&S(n)})}var o=k(i,2);{var h=S=>{var f=aa(),x=d(f),z=d(x,!0);c(x),c(f),Y(()=>J(z,t.error)),P(S,f)};q(o,S=>{t.error&&S(h)})}var v=k(o,2);{var w=S=>{var f=ha();f.__click=()=>t.closeSyncOverlay(),f.__keydown=F=>{F.key==="Escape"&&(F.preventDefault(),F.stopPropagation(),t.closeSyncOverlay())};var x=d(f);x.__click=[oa],x.__keydown=F=>{F.key==="Escape"&&(F.preventDefault(),F.stopPropagation(),t.closeSyncOverlay())};var z=d(x);z.__click=()=>t.closeSyncOverlay();var O=k(z,4),H=d(O);{var Q=F=>{var B=na(),Z=k(d(B));c(B),Y(ee=>J(Z,` Connected - Token: ${ee??""}`),[()=>t.getSyncStatus().deviceToken]),P(F,B)},W=F=>{var B=la();P(F,B)};q(H,F=>{t.getSyncStatus().connected?F(Q):F(W,!1)})}c(O);var G=k(O,2);{var M=F=>{var B=da(),Z=ps(B),ee=k(d(Z),4);ee.__click=()=>t.handleGenerateToken();var le=d(ee);let se;var V=k(le,2);let re;c(ee),c(Z);var me=k(Z,2),ae=k(d(me),4),U=d(ae);Yt(U),U.__keydown=X=>{X.key==="Escape"&&(X.preventDefault(),X.stopPropagation(),t.closeSyncOverlay())};var oe=k(U,2),ce=d(oe);let be;var ye=k(ce,2);let Se;c(oe),c(ae);var jt=k(ae,2);{var Zt=X=>{var he=ca(),we=d(he,!0);c(he),Y(()=>J(we,t.syncError)),P(X,he)};q(jt,X=>{t.syncError&&X(Zt)})}c(me),Y((X,he,we,es)=>{ee.disabled=t.syncGenerating,se=D(le,1,"",null,se,X),re=D(V,1,"",null,re,he),oe.disabled=t.syncConnecting||t.syncTokenInput.length!==8,be=D(ce,1,"",null,be,we),Se=D(ye,1,"",null,Se,es)},[()=>({hidden:t.syncGenerating}),()=>({hidden:!t.syncGenerating}),()=>({hidden:t.syncConnecting}),()=>({hidden:!t.syncConnecting})]),ks("submit",ae,X=>{X.preventDefault(),t.handleConnectWithToken()}),ws(U,()=>t.syncTokenInput,X=>t.syncTokenInput=X),P(F,B)},j=F=>{var B=ua(),Z=k(d(B),2);Z.__click=()=>t.handleDisconnectSync(),c(B),P(F,B)};q(G,F=>{t.getSyncStatus().connected?F(j,!1):F(M)})}Me(2),c(x),c(f),P(S,f)};q(v,S=>{t.showSyncOverlay&&S(w)})}var g=k(v,2);{var C=S=>{var f=pa();f.__click=()=>t.closeSearchOverlay(),f.__keydown=M=>{M.key==="Escape"&&(M.preventDefault(),M.stopPropagation(),t.closeSearchOverlay())};var x=d(f);x.__click=[va],x.__keydown=M=>{M.key==="Escape"&&(M.preventDefault(),M.stopPropagation(),t.closeSearchOverlay())};var z=d(x);z.__click=()=>t.closeSearchOverlay();var O=k(z,2);{var H=M=>{var j=fa(),F=d(j),B=k(d(F),2);Yt(B),B.__keydown=U=>{U.key==="Enter"?(U.preventDefault(),t.verifyToken()):U.key==="Escape"&&(U.preventDefault(),U.stopPropagation(),t.closeSearchOverlay())},Js(B),c(F);var Z=k(F,2);{var ee=U=>{var oe=ga(),ce=d(oe,!0);c(oe),Y(()=>J(ce,t.tokenError)),P(U,oe)};q(Z,U=>{t.tokenError&&U(ee)})}var le=k(Z,2),se=d(le);se.__click=()=>t.verifyToken();var V=d(se);let re;var me=k(V,2);let ae;c(se),c(le),c(j),Y((U,oe)=>{re=D(V,1,"",null,re,U),ae=D(me,1,"",null,ae,oe)},[()=>({hidden:t.loading}),()=>({hidden:!t.loading})]),ks("submit",F,U=>{U.preventDefault(),t.verifyToken()}),ws(B,()=>t.searchToken,U=>t.searchToken=U),P(M,j)},Q=M=>{var j=ma(),F=d(j);Yt(F),F.__keydown=V=>{V.key==="Enter"?(V.preventDefault(),t.performSearch()):V.key==="Escape"&&(V.preventDefault(),V.stopPropagation(),t.closeSearchOverlay())},Js(F);var B=k(F,2);B.__click=()=>t.performSearch();var Z=d(B);let ee;var le=k(Z,2);let se;c(B),c(j),Y((V,re)=>{ee=D(Z,1,"",null,ee,V),se=D(le,1,"",null,se,re)},[()=>({hidden:t.loading}),()=>({hidden:!t.loading})]),ws(F,()=>t.searchQuery,V=>t.searchQuery=V),P(M,j)};q(O,M=>{t.isSearchAuthorized?M(Q,!1):M(H)})}var W=k(O,2);{var G=M=>{var j=ya(),F=d(j,!0);c(j),Y(()=>J(F,t.error)),P(M,j)};q(W,M=>{t.error&&M(G)})}c(x),c(f),P(S,f)};q(g,S=>{t.showSearchOverlay&&S(C)})}var _=k(g,2);{var E=S=>{var f=ka(),x=d(f),z=d(x),O=d(z,!0);c(z),c(x),c(f),Y(()=>J(O,t.overlayMessage)),Wt(3,f,()=>Xt,()=>({duration:300})),P(S,f)};q(_,S=>{t.showMessageOverlay&&S(E)})}var b=k(_,2);{var A=S=>{var f=Fa(),x=d(f);{var z=I=>{var T=wa();T.__click=()=>t.exitFullscreen();var L=d(T);let $;c(T),Y(ie=>$=D(L,0,"w-5 h-5",null,$,ie),[()=>({hidden:!t.isFullscreen&&!t.hideToolbar})]),P(I,T)};q(x,I=>{(t.hideToolbar||t.isFullscreen)&&I(z)})}var O=k(x,2),H=d(O);let Q;var W=k(H,2),G=d(W);let M;var j=d(G),F=d(j,!0);c(j);var B=k(j,2),Z=d(B,!0);c(B),c(G);var ee=k(G,2);{var le=I=>{var T=ba();Y(()=>{ne(T,"src",t.currentItem.image_url),ne(T,"alt",t.currentItem.title)}),ks("error",T,function(...L){var $;($=t.handleImageError)==null||$.apply(this,L)}),Oi(T),Wt(3,T,()=>Xt,()=>({duration:500})),P(I,T)};q(ee,I=>{t.currentItem&&I(le)})}var se=k(ee,2);se.__click=()=>t.prevItem(),se.__keydown=I=>I.key==="Enter"&&t.prevItem();var V=k(se,2);V.__click=()=>t.nextItem(),V.__keydown=I=>I.key==="Enter"&&t.nextItem();var re=k(V,2);let me;var ae=d(re);ae.__click=()=>t.prevCategory();var U=k(d(ae),2),oe=d(U,!0);c(U),c(ae),c(re);var ce=k(re,2);let be;var ye=d(ce);ye.__click=()=>t.nextCategory();let Se;var jt=k(d(ye),2),Zt=d(jt,!0);c(jt),c(ye);var X=k(ye,2);X.__click=()=>t.refreshRandomArtist();let he;c(ce);var we=k(ce,2);we.__click=()=>t.prevItem();var es=k(we,2);es.__click=()=>t.nextItem(),c(W);var ts=k(W,2),ss=d(ts),Ts=d(ss);{var yr=I=>{var T=Sa(),L=ps(T),$=d(L),ie=d($,!0);c($),c(L);var ve=k(L,2);ve.__click=()=>t.toggleLikeImage();let Vt;var vs=d(ve);c(ve),Y((gs,fs)=>{ne(L,"href",t.currentItem.link),J(ie,t.currentItem.title),Vt=D(ve,1,"hover:bg-gray-200 dark:hover:bg-gray-700 ml-2 p-2 rounded-full focus:outline-none cursor-pointer",null,Vt,gs),ne(vs,"fill",fs)},[()=>({"text-red-500":t.isImageLiked(),"text-gray-600":!t.isImageLiked(),"dark:text-gray-400":!t.isImageLiked()}),()=>t.isImageLiked()?"currentColor":"none"]),P(I,T)};q(Ts,I=>{t.currentItem&&I(yr)})}var rs=k(Ts,2);let Cs;var is=d(rs),pr=d(is,!0);c(is);var $t=k(is,2);$t.__click=I=>{I.stopPropagation(),t.showFavourites&&t.currentItem?t.toggleFavourite(t.currentItem.category_id,t.currentItem.media_source):t.toggleFavourite()};var kr=d($t);c($t),c(rs),c(ss);var wr=k(ss,2);{var br=I=>{var T=_a(),L=d(T),$=d(L);zi($,()=>t.currentItem.description),c(L),c(T),Wt(3,T,()=>Xt),P(I,T)};q(wr,I=>{var T;t.showDescription&&((T=t.currentItem)!=null&&T.description)&&I(br)})}c(ts);var Ms=k(ts,2),Sr=d(Ms);Pi(Sr,I=>t.progressBar=I,()=>t==null?void 0:t.progressBar),c(Ms),c(O);var as=k(O,2),os=d(as),ns=d(os),qt=d(ns);qt.__change=()=>t.changeMediaSource(),er(qt,21,()=>t.mediaSources,I=>I.id,(I,T)=>{var L=Ia(),$={},ie=d(L,!0);c(L),Y(()=>{$!==($=u(T).id)&&(L.value=(L.__value=u(T).id)??""),J(ie,u(T).name)}),P(I,L)}),c(qt),c(ns);var Fs=k(ns,2),Gt=d(Fs);Gt.__change=()=>t.loadCategory(),er(Gt,21,()=>t.categories,I=>I.id,(I,T)=>{var L=xa(),$={},ie=d(L,!0);c(L),Y(()=>{$!==($=u(T).id)&&(L.value=(L.__value=u(T).id)??""),qi(L,u(T).id===(t.selectedCategory||t.categories[0].id)),J(ie,u(T).name)}),P(I,L)}),c(Gt),c(Fs),c(os);var ls=k(os,2),Es=d(ls),_r=d(Es);{var Ir=I=>{var T=Ta(),L=ps(T),$=d(L,!0);c(L);var ie=k(L,2),ve=d(ie,!0);c(ie),Y(()=>{J($,t.currentIndex+1),J(ve,t.items.length)}),P(I,T)},xr=I=>{var T=Ca();P(I,T)};q(_r,I=>{t.items.length>0?I(Ir):I(xr,!1)})}c(Es),c(ls);var As=k(ls,2),cs=d(As);cs.__click=()=>t.openSearchOverlay();let Ls;var _e=k(cs,2);_e.__click=()=>t.openSyncOverlay();let Ds;var Tr=k(d(_e),2);{var Cr=I=>{var T=Ma();P(I,T)};q(Tr,I=>{t.getSyncStatus().connected&&I(Cr)})}c(_e);var Ie=k(_e,2);Ie.__click=()=>t.toggleShowFavourites();let Os;var Mr=d(Ie);c(Ie);var xe=k(Ie,2);xe.__click=()=>t.toggleShowLikedImages();let Ps;var Fr=d(xe);c(xe);var Te=k(xe,2);Te.__click=()=>t.togglePause();let Rs;var Ns=d(Te);let Bs;var Er=k(Ns,2);let zs;c(Te);var ds=k(Te,2);ds.__click=()=>t.toggleHD();let Us;var Hs=k(ds,2);Hs.__click=()=>t.toggleFullscreen();var us=k(Hs,2);us.__click=()=>t.showDescription=!t.showDescription;let js;var $s=k(us,2),qs=k(d($s),2),hs=d(qs);Yt(hs),hs.__click=()=>t.toggleDarkMode(),Me(2),c(qs),Me(2),c($s),c(As),c(as),c(f),Y((I,T,L,$,ie,ve,Vt,vs,gs,fs,Ar,Lr,Dr,Or,Pr,Rr,Nr,Br,zr,Ur)=>{Q=D(H,1,"z-10 absolute flex justify-center items-center bg-black/50 w-full h-full transition-all duration-300",null,Q,I),M=D(G,1,"top-1/2 left-1/2 z-9 fixed flex flex-col justify-center items-center bg-black/50 shadow-lg px-8 py-4 rounded-xl font-semibold text-white text-center transition-opacity -translate-x-1/2 -translate-y-1/2 duration-300 nav-button transform svelte-1k4ytib",null,M,T),J(F,t.currentSourceName),J(Z,t.currentCategoryName),me=D(re,1,"flex items-center category-nav-button category-up nav-button svelte-1k4ytib",null,me,L),J(oe,$),be=D(ce,1,"flex items-center category-nav-button category-down nav-button svelte-1k4ytib",null,be,ie),Se=D(ye,1,"flex items-center bg-black/50 hover:bg-black/80 px-4 py-2 rounded-l-full text-white transition-all duration-300 cursor-pointer",null,Se,ve),J(Zt,Vt),he=D(X,1,"bg-black/50 hover:bg-black/80 px-3 py-[10px] border-white-600 border-l rounded-r-full text-white transition-all duration-300 cursor-pointer",null,he,vs),Cs=D(rs,1,"flex items-center bg-black/50 ml-3 px-3 py-1 rounded-full text-sm svelte-1k4ytib",null,Cs,gs),J(pr,t.currentCategoryName),ne($t,"title",fs),ne(kr,"fill",Ar),D(as,1,`${t.hideToolbar?"hidden":"flex"} justify-center items-center text-sm control-bar`,"svelte-1k4ytib"),Ls=D(cs,1,"hover:bg-gray-200 dark:hover:bg-gray-700 p-2 rounded-full focus:outline-none text-gray-600 dark:text-gray-400 cursor-pointer",null,Ls,Lr),Ds=D(_e,1,"relative hover:bg-gray-200 dark:hover:bg-gray-700 p-2 rounded-full focus:outline-none cursor-pointer",null,Ds,Dr),Os=D(Ie,1,"hover:bg-gray-200 dark:hover:bg-gray-700 p-2 rounded-full focus:outline-none cursor-pointer",null,Os,Or),ne(Mr,"fill",t.showFavourites?"currentColor":"none"),Ps=D(xe,1,"hover:bg-gray-200 dark:hover:bg-gray-700 p-2 rounded-full focus:outline-none cursor-pointer",null,Ps,Pr),ne(Fr,"fill",t.showLikedImages?"currentColor":"none"),Rs=D(Te,1,"hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full focus:outline-none cursor-pointer",null,Rs,Rr),Bs=D(Ns,0,"w-5 h-5",null,Bs,Nr),zs=D(Er,0,"w-5 h-5",null,zs,Br),Us=D(ds,1,"hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full focus:outline-none cursor-pointer",null,Us,zr),js=D(us,1,"hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full focus:outline-none cursor-pointer",null,js,Ur),$i(hs,t.darkMode)},[()=>({hidden:!t.loading}),()=>({visible:t.showMediaSourceOverlay,"opacity-0":!t.showMediaSourceOverlay,hidden:t.isMobile}),()=>({hidden:t.categories.length<=1}),()=>t.getPrevCategoryName(),()=>({hidden:t.categories.length<=1}),()=>({"rounded-r-full":t.selectedCategory!=="random-artist"}),()=>t.getNextCategoryName(),()=>({hidden:t.selectedCategory!=="random-artist"}),()=>({hidden:!t.selectedCategory,"mobile-truncate":t.selectedMediaSource!=="wikiart"}),()=>t.showFavourites&&t.currentItem?t.isFavourite(t.currentItem.category_id,t.currentItem.media_source)?"Remove from favourites":"Add to favourites":t.isFavourite()?"Remove from favourites":"Add to favourites",()=>t.showFavourites&&t.currentItem?t.isFavourite(t.currentItem.category_id,t.currentItem.media_source)?"currentColor":"none":t.isFavourite()?"currentColor":"none",()=>({hidden:!t.isSearchAuthorized}),()=>({"text-green-500":t.getSyncStatus().connected,"text-gray-600":!t.getSyncStatus().connected,"dark:text-gray-400":!t.getSyncStatus().connected}),()=>({hidden:!t.hasFavourites(),"text-blue-500":t.showFavourites,"text-gray-600":!t.showFavourites,"dark:text-gray-400":!t.showFavourites}),()=>({hidden:!t.hasLikedImages(),"text-blue-500":t.showLikedImages,"text-gray-600":!t.showLikedImages,"dark:text-gray-400":!t.showLikedImages}),()=>({"text-blue-500":t.isPaused,"text-gray-600":!t.isPaused,"dark:text-gray-400":!t.isPaused}),()=>({hidden:t.isPaused}),()=>({hidden:!t.isPaused}),()=>({"text-blue-500":t.isHD,"text-gray-600":!t.isHD,"dark:text-gray-400":!t.isHD}),()=>({"text-blue-500":t.showDescription,"text-gray-600":!t.showDescription,"dark:text-gray-400":!t.showDescription})]),Wt(3,G,()=>Xt,()=>({duration:300})),ar(qt,()=>t.selectedMediaSource,I=>t.selectedMediaSource=I),ar(Gt,()=>t.selectedCategory,I=>t.selectedCategory=I),P(S,f)};q(b,S=>{t.items.length>=0&&S(A)})}c(s),P(r,s),Fi()}Di(["click","keydown","change"]);export{Na as component};
